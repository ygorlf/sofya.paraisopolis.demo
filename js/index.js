var Sofya=function(){"use strict";var L,z=new Uint8Array(16);function N(){if(L=L||"undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto))return L(z);throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}var U=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var n,p,s,i=[],q=0;q<256;++q)i.push((q+256).toString(16).substr(1));function F(e,t){var t=1<arguments.length&&void 0!==t?t:0,e=(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase();if("string"==typeof(t=e)&&U.test(t))return e;throw TypeError("Stringified UUID is invalid")}const j=()=>{var e=void 0,t=void 0,i=void 0,r=(e=e||{}).random||(e.rng||N)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){i=i||0;for(var n=0;n<16;++n)t[i+n]=r[n];return t}return F(r)},l=()=>j().replace(new RegExp("-","g"),"").toUpperCase();(e=n=n||{})[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error",e[e.None=4]="None";class K{constructor(e,t){this.privName=e,this.privEventId=l(),this.privEventTime=(new Date).toISOString(),this.privEventType=t,this.privMetadata={}}get name(){return this.privName}get eventId(){return this.privEventId}get eventTime(){return this.privEventTime}get eventType(){return this.privEventType}get metadata(){return this.privMetadata}}class H extends K{constructor(e,t,i=n.Info){super(e,i),this.privAudioSourceId=t}get audioSourceId(){return this.privAudioSourceId}}class W extends H{constructor(e){super("AudioSourceInitializingEvent",e)}}class V extends H{constructor(e){super("AudioSourceReadyEvent",e)}}class G extends H{constructor(e){super("AudioSourceOffEvent",e)}}class J extends H{constructor(e,t){super("AudioSourceErrorEvent",e,n.Error),this.privError=t}get error(){return this.privError}}class Y extends H{constructor(e,t,i){super(e,t),this.privAudioNodeId=i}get audioNodeId(){return this.privAudioNodeId}}class Z extends Y{constructor(e,t){super("AudioStreamNodeAttachingEvent",e,t)}}class $ extends Y{constructor(e,t){super("AudioStreamNodeAttachedEvent",e,t)}}class X extends Y{constructor(e,t){super("AudioStreamNodeDetachedEvent",e,t)}}class Q extends Y{constructor(e,t,i){super("AudioStreamNodeErrorEvent",e,t),this.privError=i}get error(){return this.privError}}class ee extends K{constructor(e,t,i=n.Info){super(e,i),this.privJsonResult=t}get jsonString(){return this.privJsonResult}}class te extends K{constructor(e,t,i=n.Info){super(e,i),this.privConnectionId=t}get connectionId(){return this.privConnectionId}}class ie extends te{constructor(e,t,i){super("ConnectionStartEvent",e),this.privUri=t,this.privHeaders=i}get uri(){return this.privUri}get headers(){return this.privHeaders}}class re extends te{constructor(e){super("ConnectionEstablishedEvent",e)}}class ne extends te{constructor(e,t,i){super("ConnectionClosedEvent",e,n.Debug),this.privReason=i,this.privStatusCode=t}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}}class oe extends te{constructor(e,t,i){super("ConnectionErrorEvent",e,n.Debug),this.privMessage=t,this.privType=i}get message(){return this.privMessage}get type(){return this.privType}}class se extends te{constructor(e,t,i){super("ConnectionMessageReceivedEvent",e),this.privNetworkReceivedTime=t,this.privMessage=i}get networkReceivedTime(){return this.privNetworkReceivedTime}get message(){return this.privMessage}}class ae extends te{constructor(e,t,i){super("ConnectionMessageSentEvent",e),this.privNetworkSentTime=t,this.privMessage=i}get networkSentTime(){return this.privNetworkSentTime}get message(){return this.privMessage}}class f extends Error{constructor(e){super(e),this.name="ArgumentNull",this.message=e}}class he extends Error{constructor(e){super(e),this.name="InvalidOperation",this.message=e}}class ue extends Error{constructor(e,t){super(t),this.name=e+"ObjectDisposed",this.message=t}}(e=p=p||{})[e.Text=0]="Text",e[e.Binary=1]="Binary";class ce{constructor(e,t,i,r){if(this.privBody=null,e===p.Text&&t&&"string"!=typeof t)throw new he("Payload must be a string");if(e===p.Binary&&t&&!(t instanceof ArrayBuffer))throw new he("Payload must be ArrayBuffer");switch(this.privMessageType=e,this.privBody=t,this.privHeaders=i||{},this.privId=r||l(),this.messageType){case p.Binary:this.privSize=null!==this.binaryBody?this.binaryBody.byteLength:0;break;case p.Text:this.privSize=this.textBody.length}}get messageType(){return this.privMessageType}get headers(){return this.privHeaders}get body(){return this.privBody}get textBody(){if(this.privMessageType===p.Binary)throw new he("Not supported for binary message");return this.privBody}get binaryBody(){if(this.privMessageType===p.Text)throw new he("Not supported for text message");return this.privBody}get id(){return this.privId}}class pe{constructor(e,t){this.privStatusCode=e,this.privReason=t}get statusCode(){return this.privStatusCode}get reason(){return this.privReason}}class de{constructor(e){this.privEventListeners={},this.privIsDisposed=!1,this.privConsoleListener=void 0,this.privMetadata=e}onEvent(e){if(this.isDisposed())throw new ue("EventSource");if(this.metadata)for(const t in this.metadata)!t||e.metadata&&!e.metadata[t]&&(e.metadata[t]=this.metadata[t]);for(const i in this.privEventListeners)i&&this.privEventListeners[i]&&this.privEventListeners[i](e)}attach(e){const t=l();return this.privEventListeners[t]=e,{detach:()=>(delete this.privEventListeners[t],Promise.resolve())}}attachListener(t){return this.attach(e=>t.onEvent(e))}attachConsoleListener(t){return this.privConsoleListener&&this.privConsoleListener.detach(),this.privConsoleListener=this.attach(e=>t.onEvent(e)),this.privConsoleListener}isDisposed(){return this.privIsDisposed}dispose(){this.privEventListeners=null,this.privIsDisposed=!0}get metadata(){return this.privMetadata}}class o{static setEventSource(e){if(!e)throw new f("eventSource");o.privInstance=e}static get instance(){return o.privInstance}}o.privInstance=new de,(e=s=s||{})[e.None=0]="None",e[e.Connected=1]="Connected",e[e.Connecting=2]="Connecting",e[e.Disconnected=3]="Disconnected";class le{constructor(e){if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.privList=[],e)for(const t of e)this.privList.push(t)}get(e){return this.throwIfDisposed(),this.privList[e]}first(){return this.get(0)}last(){return this.get(this.length()-1)}add(e){this.throwIfDisposed(),this.insertAt(this.privList.length,e)}insertAt(e,t){this.throwIfDisposed(),0===e?this.privList.unshift(t):e===this.privList.length?this.privList.push(t):this.privList.splice(e,0,t),this.triggerSubscriptions(this.privAddSubscriptions)}removeFirst(){return this.throwIfDisposed(),this.removeAt(0)}removeLast(){return this.throwIfDisposed(),this.removeAt(this.length()-1)}removeAt(e){return this.throwIfDisposed(),this.remove(e,1)[0]}remove(e,t){this.throwIfDisposed();e=this.privList.splice(e,t);return this.triggerSubscriptions(this.privRemoveSubscriptions),e}clear(){this.throwIfDisposed(),this.remove(0,this.length())}length(){return this.throwIfDisposed(),this.privList.length}onAdded(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privAddSubscriptions[t]=e,{detach:()=>(delete this.privAddSubscriptions[t],Promise.resolve())}}onRemoved(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privRemoveSubscriptions[t]=e,{detach:()=>(delete this.privRemoveSubscriptions[t],Promise.resolve())}}onDisposed(e){this.throwIfDisposed();const t=this.privSubscriptionIdCounter++;return this.privDisposedSubscriptions[t]=e,{detach:()=>(delete this.privDisposedSubscriptions[t],Promise.resolve())}}join(e){return this.throwIfDisposed(),this.privList.join(e)}toArray(){const t=Array();return this.privList.forEach(e=>{t.push(e)}),t}any(e){return this.throwIfDisposed(),e?0<this.where(e).length():0<this.length()}all(e){return this.throwIfDisposed(),this.where(e).length()===this.length()}forEach(t){this.throwIfDisposed();for(let e=0;e<this.length();e++)t(this.privList[e],e)}select(t){this.throwIfDisposed();var i=[];for(let e=0;e<this.privList.length;e++)i.push(t(this.privList[e],e));return new le(i)}where(t){this.throwIfDisposed();var i=new le;for(let e=0;e<this.privList.length;e++)t(this.privList[e],e)&&i.add(this.privList[e]);return i}orderBy(e){this.throwIfDisposed();e=this.toArray().sort(e);return new le(e)}orderByDesc(i){return this.throwIfDisposed(),this.orderBy((e,t)=>i(t,e))}clone(){return this.throwIfDisposed(),new le(this.toArray())}concat(e){return this.throwIfDisposed(),new le(this.privList.concat(e.toArray()))}concatArray(e){return this.throwIfDisposed(),new le(this.privList.concat(e))}isDisposed(){return null==this.privList}dispose(e){this.isDisposed()||(this.privDisposeReason=e,this.privList=null,this.privAddSubscriptions=null,this.privRemoveSubscriptions=null,this.triggerSubscriptions(this.privDisposedSubscriptions))}throwIfDisposed(){if(this.isDisposed())throw new ue("List",this.privDisposeReason)}triggerSubscriptions(e){if(e)for(const t in e)t&&e[t]()}}class d{constructor(){this.resolve=e=>(this.privResolve(e),this),this.reject=e=>(this.privReject(e),this),this.privPromise=new Promise((e,t)=>{this.privResolve=e,this.privReject=t})}get promise(){return this.privPromise}}function fe(e,t,i){e.then(e=>{try{t&&t(e)}catch(e){if(i)try{e instanceof Error?i(e.name+": "+e.message):i(e)}catch(e){}}},e=>{if(i)try{e instanceof Error?i(e.name+": "+e.message):i(e)}catch(e){}})}var ve,ge=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};(e=ve=ve||{})[e.Dequeue=0]="Dequeue",e[e.Peek=1]="Peek";class me{constructor(e){this.privPromiseStore=new le,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.privList=e||new le,this.privDetachables=[],this.privSubscribers=new le,this.privDetachables.push(this.privList.onAdded(()=>this.drain()))}enqueue(t){this.throwIfDispose(),this.enqueueFromPromise(new Promise(e=>e(t)))}enqueueFromPromise(e){this.throwIfDispose(),e.then(e=>{this.privList.add(e)},()=>{})}dequeue(){this.throwIfDispose();var e=new d;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:ve.Dequeue}),this.drain()),e.promise}peek(){this.throwIfDispose();var e=new d;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:ve.Peek}),this.drain()),e.promise}length(){return this.throwIfDispose(),this.privList.length()}isDisposed(){return null==this.privSubscribers}drainAndDispose(r,n){return ge(this,void 0,void 0,function*(){if(!this.isDisposed()&&!this.privIsDisposing){this.privDisposeReason=n,this.privIsDisposing=!0;var e=this.privSubscribers;if(e){for(;0<e.length();)e.removeFirst().deferral.resolve(void 0);this.privSubscribers===e&&(this.privSubscribers=e)}for(const t of this.privDetachables)yield t.detach();if(0<this.privPromiseStore.length()&&r){const i=[];return this.privPromiseStore.toArray().forEach(e=>{i.push(e)}),Promise.all(i).finally(()=>{this.privSubscribers=null,this.privList.forEach(e=>{r(e)}),this.privList=null}).then()}this.privSubscribers=null,this.privList=null}})}dispose(e){return ge(this,void 0,void 0,function*(){yield this.drainAndDispose(null,e)})}drain(){if(!this.privIsDrainInProgress&&!this.privIsDisposing){this.privIsDrainInProgress=!0;var e=this.privSubscribers,t=this.privList;if(e&&t){for(;0<t.length()&&0<e.length()&&!this.privIsDisposing;){var i,r=e.removeFirst();r.type===ve.Peek?r.deferral.resolve(t.first()):(i=t.removeFirst(),r.deferral.resolve(i))}this.privSubscribers===e&&(this.privSubscribers=e),this.privList===t&&(this.privList=t)}this.privIsDrainInProgress=!1}}throwIfDispose(){if(this.isDisposed()){if(this.privDisposeReason)throw new he(this.privDisposeReason);throw new ue("Queue")}if(this.privIsDisposing)throw new he("Queue disposing")}}class ye{constructor(e,t,i){if(this.privPayload=null,!t)throw new f("payload");if(e===p.Binary&&"ArrayBuffer"!==t.__proto__.constructor.name)throw new he("Payload must be ArrayBuffer");if(e===p.Text&&"string"!=typeof t)throw new he("Payload must be a string");this.privMessageType=e,this.privPayload=t,this.privId=i||l()}get messageType(){return this.privMessageType}get payload(){return this.privPayload}get textContent(){if(this.privMessageType===p.Binary)throw new he("Not supported for binary message");return this.privPayload}get binaryContent(){if(this.privMessageType===p.Text)throw new he("Not supported for text message");return this.privPayload}get id(){return this.privId}}class Se{constructor(e,t){this.privActualSampleRate=e,this.privDesiredSampleRate=t}encode(e){var t,i,e=this.downSampleAudioFrame(e,this.privActualSampleRate,this.privDesiredSampleRate);return e?(t=2*e.length,t=new ArrayBuffer(t),i=new DataView(t),this.floatTo16BitPCM(i,0,e),t):null}setString(t,i,r){for(let e=0;e<r.length;e++)t.setUint8(i+e,r.charCodeAt(e))}floatTo16BitPCM(t,i,r){for(let e=0;e<r.length;e++,i+=2){var n=Math.max(-1,Math.min(1,r[e]));t.setInt16(i,n<0?32768*n:32767*n,!0)}}downSampleAudioFrame(i,e,t){if(!i)return null;if(t===e||e<t)return i;var r=e/t,n=Math.round(i.length/r),o=new Float32Array(n);let s=0,a=0;for(;a<n;){var h=Math.round((a+1)*r);let e=0,t=0;for(;s<h&&s<i.length;)e+=i[s++],t++;o[a++]=e/t}return o}}var we=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};let be=class{constructor(e){this.privIsWriteEnded=!1,this.privIsReadEnded=!1,this.privId=e||l(),this.privReaderQueue=new me}get isClosed(){return this.privIsWriteEnded}get isReadEnded(){return this.privIsReadEnded}get id(){return this.privId}close(){this.privIsWriteEnded||(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),this.privIsWriteEnded=!0)}writeStreamChunk(e){if(this.throwIfClosed(),!this.privReaderQueue.isDisposed())try{this.privReaderQueue.enqueue(e)}catch(e){}}read(){if(this.privIsReadEnded)throw new he("Stream read has already finished");return this.privReaderQueue.dequeue().then(e=>we(this,void 0,void 0,function*(){return void 0!==e&&!e.isEnd||(yield this.privReaderQueue.dispose("End of stream reached")),e}))}readEnded(){this.privIsReadEnded||(this.privIsReadEnded=!0,this.privReaderQueue=new me)}throwIfClosed(){if(this.privIsWriteEnded)throw new he("Stream closed")}};class Ce extends be{constructor(e,t){super(t),this.privTargetChunkSize=e,this.privNextBufferReadyBytes=0}writeStreamChunk(t){if(t.isEnd||0===this.privNextBufferReadyBytes&&t.buffer.byteLength===this.privTargetChunkSize)super.writeStreamChunk(t);else{let e=0;for(;e<t.buffer.byteLength;){void 0===this.privNextBufferToWrite&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=t.timeReceived);var i=Math.min(t.buffer.byteLength-e,this.privTargetChunkSize-this.privNextBufferReadyBytes),r=new Uint8Array(this.privNextBufferToWrite),n=new Uint8Array(t.buffer.slice(e,i+e));r.set(n,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=i,e+=i,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(super.writeStreamChunk({buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}}}close(){0===this.privNextBufferReadyBytes||this.isClosed||super.writeStreamChunk({buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),super.close()}}class Re{static load(){const n=new Map([[0,()=>{}]]),o=new Map;var e="data:text/javascript;base64,"+btoa(`!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return d}));const r=new Map,o=new Map,i=e=>{const t=r.get(e);if(void 0===t)throw new Error('There is no interval scheduled with the given id "'.concat(e,'".'));clearTimeout(t),r.delete(e)},u=e=>{const t=o.get(e);if(void 0===t)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(t),o.delete(e)},f=(e,t)=>{let n,r;if("performance"in self){const o=performance.now();n=o,r=e-Math.max(0,o-t)}else n=Date.now(),r=e;return{expected:n+r,remainingDelay:r}},c=(e,t,n,r)=>{const o="performance"in self?performance.now():Date.now();o>n?postMessage({id:null,method:"call",params:{timerId:t}}):e.set(t,setTimeout(c,n-o,e,t,n))},a=(e,t,n)=>{const{expected:o,remainingDelay:i}=f(e,n);r.set(t,setTimeout(c,i,r,t,o))},d=(e,t,n)=>{const{expected:r,remainingDelay:i}=f(e,n);o.set(t,setTimeout(c,i,o,t,r))}},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(3);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(4);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);var f=n(5);for(var o in f)"default"!==o&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var c=n(6);for(var o in c)"default"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var a=n(7);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var d=n(8);for(var o in d)"default"!==o&&function(e){n.d(t,e,(function(){return d[e]}))}(o);var s=n(9);for(var o in s)"default"!==o&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(11);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(12);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(13);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var u=n(10);for(var i in u)"default"!==i&&function(e){n.d(t,e,(function(){return u[e]}))}(i);addEventListener("message",({data:e})=>{try{if("clear"===e.method){const{id:t,params:{timerId:n}}=e;Object(r.b)(n),postMessage({error:null,id:t})}else{if("set"!==e.method)throw new Error('The given method "'.concat(e.method,'" is not supported'));{const{params:{delay:t,now:n,timerId:o}}=e;Object(r.d)(t,o,n)}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);`);const r=new Worker(e);r.addEventListener("message",({data:e})=>{if(Re.isCallNotification(e)){var t=e["params"]["timerId"],i=n.get(t);if("number"==typeof i){var r=o.get(i);if(void 0===r||r!==t)throw new Error("The timer is in an undefined state.")}else{if(void 0===i)throw new Error("The timer is in an undefined state.");i(),n.delete(t)}}else{if(!Re.isClearResponse(e))throw{message:r}=e["error"],new Error(r);i=e["id"],t=o.get(i);if(void 0===t)throw new Error("The timer is in an undefined state.");o.delete(i),n.delete(t)}});return{clearTimeout:e=>{var t=Math.random();o.set(t,e),n.set(e,t),r.postMessage({id:t,method:"clear",params:{timerId:e}})},setTimeout:(e,t)=>{var i=Math.random();return n.set(i,e),r.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:i}}),i}}}static loadWorkerTimers(){return()=>(null===Re.workerTimers&&(Re.workerTimers=Re.load()),Re.workerTimers)}static isCallNotification(e){return void 0!==e.method&&"call"===e.method}static isClearResponse(e){return null===e.error&&"number"==typeof e.id}}Re.workerTimers=null,Re.clearTimeout=e=>Re.timers().clearTimeout(e),Re.setTimeout=(e,t)=>Re.timers().setTimeout(e,t),Re.timers=Re.loadWorkerTimers();class Me extends K{constructor(e,t,i){super(e,t),this.privSignature=i}}class Ee extends Me{constructor(e){super("OCSPMemoryCacheHitEvent",n.Debug,e)}}class Pe extends Me{constructor(e){super("OCSPCacheMissEvent",n.Debug,e)}}class Ae extends Me{constructor(e){super("OCSPDiskCacheHitEvent",n.Debug,e)}}class Ie extends Me{constructor(e){super("OCSPCacheUpdateNeededEvent",n.Debug,e)}}class _e extends Me{constructor(e){super("OCSPMemoryCacheStoreEvent",n.Debug,e)}}class Te extends Me{constructor(e){super("OCSPDiskCacheStoreEvent",n.Debug,e)}}class Oe extends Me{constructor(e){super("OCSPCacheUpdateCompleteEvent",n.Debug,e)}}class ke extends Me{constructor(){super("OCSPStapleReceivedEvent",n.Debug,"")}}class xe extends Me{constructor(e,t){super("OCSPCacheEntryExpiredEvent",n.Debug,e),this.privExpireTime=t}}class De extends Me{constructor(e,t,i){super("OCSPCacheEntryNeedsRefreshEvent",n.Debug,e),this.privExpireTime=i,this.privStartTime=t}}class Be extends Me{constructor(e,t,i){super("OCSPCacheHitEvent",n.Debug,e),this.privExpireTime=i,this.privExpireTimeString=new Date(i).toLocaleDateString(),this.privStartTime=t,this.privStartTimeString=new Date(t).toLocaleTimeString()}}class Le extends Me{constructor(e,t){super("OCSPVerificationFailedEvent",n.Debug,e),this.privError=t}}class ze extends Me{constructor(e,t){super("OCSPCacheFetchErrorEvent",n.Debug,e),this.privError=t}}class Ne extends Me{constructor(e){super("OCSPResponseRetrievedEvent",n.Debug,e)}}class Ue extends Me{constructor(e,t){super("OCSPCacheUpdateErrorEvent",n.Debug,e),this.privError=t}}class qe extends K{constructor(e){super("BackgroundEvent",n.Error),this.privError=e}get error(){return this.privError}}class r{static throwIfNullOrUndefined(e,t){if(null==e)throw new Error("throwIfNullOrUndefined:"+t)}static throwIfNull(e,t){if(null===e)throw new Error("throwIfNull:"+t)}static throwIfNullOrWhitespace(e,t){if(r.throwIfNullOrUndefined(e,t),(""+e).trim().length<1)throw new Error("throwIfNullOrWhitespace:"+t)}static throwIfDisposed(e){if(e)throw new Error("the object is already disposed")}static throwIfArrayEmptyOrWhitespace(e,t){if(r.throwIfNullOrUndefined(e,t),0===e.length)throw new Error("throwIfArrayEmptyOrWhitespace:"+t);for(const i of e)r.throwIfNullOrWhitespace(i,t)}static throwIfFileDoesNotExist(e,t){r.throwIfNullOrWhitespace(e,t)}static throwIfNotUndefined(e,t){if(void 0!==e)throw new Error("throwIfNotUndefined:"+t)}}class c{}c.AuthKey="Ocp-Apim-Subscription-Key",c.Authorization="Authorization",c.ConnectionId="X-ConnectionId",c.ContentType="Content-Type",c.CustomCommandsAppId="X-CommandsAppId",c.Path="Path",c.RequestId="X-RequestId",c.RequestStreamId="X-StreamId",c.RequestTimestamp="X-Timestamp";class Fe{constructor(e,t){this.privHeaderName=e,this.privToken=t}get headerName(){return this.privHeaderName}get token(){return this.privToken}}class je{constructor(e){if(!e)throw new f("subscriptionKey");this.privAuthInfo=new Fe(c.AuthKey,e)}fetch(e){return Promise.resolve(this.privAuthInfo)}fetchOnExpiry(e){return Promise.resolve(this.privAuthInfo)}}class Ke{constructor(e,t){if(!e)throw new f("fetchCallback");if(!t)throw new f("fetchOnExpiryCallback");this.privFetchCallback=e,this.privFetchOnExpiryCallback=t}fetch(e){return this.privFetchCallback(e).then(e=>new Fe(c.Authorization,void 0===e?void 0:Ke.privTokenPrefix+e))}fetchOnExpiry(e){return this.privFetchOnExpiryCallback(e).then(e=>new Fe(c.Authorization,void 0===e?void 0:Ke.privTokenPrefix+e))}}Ke.privTokenPrefix="bearer ";class He{constructor(e){r.throwIfNullOrUndefined(void 0,"\nFile System access not available, please use Push or PullAudioOutputStream"),this.privFd=(void 0)(e,"w")}set format(e){r.throwIfNotUndefined(this.privAudioFormat,"format is already set"),this.privAudioFormat=e;let t=0;this.privAudioFormat.hasHeader&&(t=this.privAudioFormat.header.byteLength),void 0!==this.privFd&&(this.privWriteStream=(void 0)("",{fd:this.privFd,start:t,autoClose:!1}))}write(e){r.throwIfNullOrUndefined(this.privAudioFormat,"must set format before writing."),void 0!==this.privWriteStream&&this.privWriteStream.write(new Uint8Array(e.slice(0)))}close(){void 0!==this.privFd&&(this.privWriteStream.on("finish",()=>{this.privAudioFormat.hasHeader&&(this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten),(void 0)(this.privFd,new Int8Array(this.privAudioFormat.header),0,this.privAudioFormat.header.byteLength,0)),(void 0)(this.privFd),this.privFd=void 0}),this.privWriteStream.end())}id(){return this.privId}}var a="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},We=[],Ve=[],Ge="undefined"!=typeof Uint8Array?Uint8Array:Array,Je=!1;function Ye(){Je=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,i=e.length;t<i;++t)We[t]=e[t],Ve[e.charCodeAt(t)]=t;Ve["-".charCodeAt(0)]=62,Ve["_".charCodeAt(0)]=63}function Ze(e,t,i){for(var r,n=[],o=t;o<i;o+=3)r=(e[o]<<16)+(e[o+1]<<8)+e[o+2],n.push(We[r>>18&63]+We[r>>12&63]+We[r>>6&63]+We[63&r]);return n.join("")}function $e(e){Je||Ye();for(var t,i=e.length,r=i%3,n="",o=[],s=0,a=i-r;s<a;s+=16383)o.push(Ze(e,s,a<s+16383?a:s+16383));return 1==r?(t=e[i-1],n=(n+=We[t>>2])+We[t<<4&63]+"=="):2==r&&(t=(e[i-2]<<8)+e[i-1],n=(n=(n+=We[t>>10])+We[t>>4&63])+We[t<<2&63]+"="),o.push(n),o.join("")}function Xe(e,t,i,r,n){var o,s,a=8*n-r-1,h=(1<<a)-1,u=h>>1,c=-7,p=i?n-1:0,d=i?-1:1,n=e[t+p];for(p+=d,o=n&(1<<-c)-1,n>>=-c,c+=a;0<c;o=256*o+e[t+p],p+=d,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=r;0<c;s=256*s+e[t+p],p+=d,c-=8);if(0===o)o=1-u;else{if(o===h)return s?NaN:1/0*(n?-1:1);s+=Math.pow(2,r),o-=u}return(n?-1:1)*s*Math.pow(2,o-r)}function Qe(e,t,i,r,n,o){var s,a,h=8*o-n-1,u=(1<<h)-1,c=u>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,l=r?1:-1,o=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(r=Math.pow(2,-s))<1&&(s--,r*=2),2<=(t+=1<=s+c?p/r:p*Math.pow(2,1-c))*r&&(s++,r/=2),u<=s+c?(a=0,s=u):1<=s+c?(a=(t*r-1)*Math.pow(2,n),s+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,n),s=0));8<=n;e[i+d]=255&a,d+=l,a/=256,n-=8);for(s=s<<n|a,h+=n;0<h;e[i+d]=255&s,d+=l,s/=256,h-=8);e[i+d-l]|=128*o}var et={}.toString,tt=Array.isArray||function(e){return"[object Array]"==et.call(e)},e=(v.TYPED_ARRAY_SUPPORT=void 0===a.TYPED_ARRAY_SUPPORT||a.TYPED_ARRAY_SUPPORT,it());function it(){return v.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function rt(e,t){if(it()<t)throw new RangeError("Invalid typed array length");return v.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=v.prototype:(e=null===e?new v(t):e).length=t,e}function v(e,t,i){if(!(v.TYPED_ARRAY_SUPPORT||this instanceof v))return new v(e,t,i);if("number"!=typeof e)return nt(this,e,t,i);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return st(this,e)}function nt(e,t,i,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer){var n=e,o=t,s=i;if(o.byteLength,s<0||o.byteLength<s)throw new RangeError("'offset' is out of bounds");if(o.byteLength<s+(r||0))throw new RangeError("'length' is out of bounds");return o=void 0===s&&void 0===r?new Uint8Array(o):void 0===r?new Uint8Array(o,s):new Uint8Array(o,s,r),v.TYPED_ARRAY_SUPPORT?(n=o).__proto__=v.prototype:n=at(n,o),n}if("string"!=typeof t){s=e,r=t;if(ut(r))return o=0|ht(r.length),0!==(s=rt(s,o)).length&&r.copy(s,0,0,o),s;if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||function(e){return e!=e}(r.length)?rt(s,0):at(s,r);if("Buffer"===r.type&&tt(r.data))return at(s,r.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}n=e,r=t,e=i;if(v.isEncoding(e="string"==typeof e&&""!==e?e:"utf8"))return t=0|ct(r,e),n=(r=(n=rt(n,t)).write(r,e))!==t?n.slice(0,r):n;throw new TypeError('"encoding" must be a valid string encoding')}function ot(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function st(e,t){if(ot(t),e=rt(e,t<0?0:0|ht(t)),!v.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function at(e,t){var i=t.length<0?0:0|ht(t.length);e=rt(e,i);for(var r=0;r<i;r+=1)e[r]=255&t[r];return e}function ht(e){if(e>=it())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+it().toString(16)+" bytes");return 0|e}function ut(e){return null!=e&&e._isBuffer}function ct(e,t){if(ut(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;var i=(e="string"!=typeof e?""+e:e).length;if(0===i)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return Pt(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return At(e).length;default:if(r)return Pt(e).length;t=(""+t).toLowerCase(),r=!0}}function pt(e,t,i){var r,n=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((i=void 0===i||i>this.length?this.length:i)<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var o=this,s=t,a=i,h=o.length;(!a||a<0||h<a)&&(a=h);for(var u="",c=s=!s||s<0?0:s;c<a;++c)u+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(o[c]);return u;case"utf8":case"utf-8":return mt(this,t,i);case"ascii":var p=this,h=t,d=i,l="";d=Math.min(p.length,d);for(var f=h;f<d;++f)l+=String.fromCharCode(127&p[f]);return l;case"latin1":case"binary":var v=this,s=t,g=i,m="";g=Math.min(v.length,g);for(var y=s;y<g;++y)m+=String.fromCharCode(v[y]);return m;case"base64":return S=this,r=i,0===(w=t)&&r===S.length?$e(S):$e(S.slice(w,r));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var S=t,w=i,b=this.slice(S,w),C="",R=0;R<b.length;R+=2)C+=String.fromCharCode(b[R]+256*b[R+1]);return C;default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function dt(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function lt(e,t,i,r,n){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):2147483647<i?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,(i=(i=isNaN(i)?n?0:e.length-1:i)<0?e.length+i:i)>=e.length){if(n)return-1;i=e.length-1}else if(i<0){if(!n)return-1;i=0}if(ut(t="string"==typeof t?v.from(t,r):t))return 0===t.length?-1:ft(e,t,i,r,n);if("number"==typeof t)return t&=255,v.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(n?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,i):ft(e,[t],i,r,n);throw new TypeError("val must be string, number or Buffer")}function ft(e,t,i,r,n){var o=1,s=e.length,a=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s/=o=2,a/=2,i/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(n)for(var u=-1,c=i;c<s;c++)if(h(e,c)===h(t,-1===u?0:c-u)){if(c-(u=-1===u?c:u)+1===a)return u*o}else-1!==u&&(c-=c-u),u=-1;else for(c=i=s<i+a?s-a:i;0<=c;c--){for(var p=!0,d=0;d<a;d++)if(h(e,c+d)!==h(t,d)){p=!1;break}if(p)return c}return-1}function vt(e,t,i,r){return It(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,r)}function gt(e,t,i,r){return It(function(e,t){for(var i,r,n=[],o=0;o<e.length&&!((t-=2)<0);++o)i=e.charCodeAt(o),r=i>>8,n.push(i%256),n.push(r);return n}(t,e.length-i),e,i,r)}function mt(e,t,i){i=Math.min(e.length,i);for(var r=[],n=t;n<i;){var o,s,a,h,u=e[n],c=null,p=239<u?4:223<u?3:191<u?2:1;if(n+p<=i)switch(p){case 1:u<128&&(c=u);break;case 2:128==(192&(o=e[n+1]))&&127<(h=(31&u)<<6|63&o)&&(c=h);break;case 3:o=e[n+1],s=e[n+2],128==(192&o)&&128==(192&s)&&2047<(h=(15&u)<<12|(63&o)<<6|63&s)&&(h<55296||57343<h)&&(c=h);break;case 4:o=e[n+1],s=e[n+2],a=e[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&65535<(h=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)&&h<1114112&&(c=h)}null===c?(c=65533,p=1):65535<c&&(r.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),r.push(c),n+=p}var d=r,l=d.length;if(l<=yt)return String.fromCharCode.apply(String,d);for(var f="",v=0;v<l;)f+=String.fromCharCode.apply(String,d.slice(v,v+=yt));return f}v.poolSize=8192,v._augment=function(e){return e.__proto__=v.prototype,e},v.from=function(e,t,i){return nt(null,e,t,i)},v.TYPED_ARRAY_SUPPORT&&(v.prototype.__proto__=Uint8Array.prototype,v.__proto__=Uint8Array),v.alloc=function(e,t,i){return r=null,t=t,i=i,ot(e=e),!(e<=0)&&void 0!==t?"string"==typeof i?rt(r,e).fill(t,i):rt(r,e).fill(t):rt(r,e);var r},v.allocUnsafe=function(e){return st(null,e)},v.allocUnsafeSlow=function(e){return st(null,e)},v.isBuffer=_t,v.compare=function(e,t){if(!ut(e)||!ut(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,r=t.length,n=0,o=Math.min(i,r);n<o;++n)if(e[n]!==t[n]){i=e[n],r=t[n];break}return i<r?-1:r<i?1:0},v.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},v.concat=function(e,t){if(!tt(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return v.alloc(0);if(void 0===t)for(n=t=0;n<e.length;++n)t+=e[n].length;for(var i=v.allocUnsafe(t),r=0,n=0;n<e.length;++n){var o=e[n];if(!ut(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},v.byteLength=ct,v.prototype._isBuffer=!0,v.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)dt(this,t,t+1);return this},v.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)dt(this,t,t+3),dt(this,t+1,t+2);return this},v.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)dt(this,t,t+7),dt(this,t+1,t+6),dt(this,t+2,t+5),dt(this,t+3,t+4);return this},v.prototype.toString=function(){var e=0|this.length;return 0==e?"":0===arguments.length?mt(this,0,e):pt.apply(this,arguments)},v.prototype.equals=function(e){if(ut(e))return this===e||0===v.compare(this,e);throw new TypeError("Argument must be a Buffer")},v.prototype.inspect=function(){var e="";return 0<this.length&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length)&&(e+=" ... "),"<Buffer "+e+">"},v.prototype.compare=function(e,t,i,r,n){if(!ut(e))throw new TypeError("Argument must be a Buffer");if(void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),(t=void 0===t?0:t)<0||i>e.length||r<0||n>this.length)throw new RangeError("out of range index");if(n<=r&&i<=t)return 0;if(n<=r)return-1;if(i<=t)return 1;if(this===e)return 0;for(var o=(n>>>=0)-(r>>>=0),s=(i>>>=0)-(t>>>=0),a=Math.min(o,s),h=this.slice(r,n),u=e.slice(t,i),c=0;c<a;++c)if(h[c]!==u[c]){o=h[c],s=u[c];break}return o<s?-1:s<o?1:0},v.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},v.prototype.indexOf=function(e,t,i){return lt(this,e,t,i,!0)},v.prototype.lastIndexOf=function(e,t,i){return lt(this,e,t,i,!1)},v.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-t;if((void 0===i||n<i)&&(i=n),0<e.length&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r=r||"utf8";for(var o,s,a,h=!1;;)switch(r){case"hex":var u=this,c=e,p=t,d=i,l=(p=Number(p)||0,u.length-p);if((!d||l<(d=Number(d)))&&(d=l),(l=c.length)%2!=0)throw new TypeError("Invalid hex string");l/2<d&&(d=l/2);for(var f=0;f<d;++f){var v=parseInt(c.substr(2*f,2),16);if(isNaN(v))return f;u[p+f]=v}return f;case"utf8":case"utf-8":return l=t,a=i,It(Pt(e,(s=this).length-l),s,l,a);case"ascii":return vt(this,e,t,i);case"latin1":case"binary":return vt(this,e,t,i);case"base64":return s=this,a=t,o=i,It(At(e),s,a,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return gt(this,e,t,i);default:if(h)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),h=!0}},v.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var yt=4096;function h(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(i<e+t)throw new RangeError("Trying to access beyond buffer length")}function St(e,t,i,r,n,o){if(!ut(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n<t||t<o)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function wt(e,t,i,r){t<0&&(t=65535+t+1);for(var n=0,o=Math.min(e.length-i,2);n<o;++n)e[i+n]=(t&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function bt(e,t,i,r){t<0&&(t=4294967295+t+1);for(var n=0,o=Math.min(e.length-i,4);n<o;++n)e[i+n]=t>>>8*(r?n:3-n)&255}function Ct(e,t,i,r){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function Rt(e,t,i,r,n){return n||Ct(e,0,i,4),Qe(e,t,i,r,23,4),i+4}function Mt(e,t,i,r,n){return n||Ct(e,0,i,8),Qe(e,t,i,r,52,8),i+8}v.prototype.slice=function(e,t){var i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):i<e&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):i<t&&(t=i),t<e&&(t=e),v.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=v.prototype;else for(var r=t-e,n=new v(r,void 0),o=0;o<r;++o)n[o]=this[o+e];return n},v.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||h(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return r},v.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||h(e,t,this.length);for(var r=this[e+--t],n=1;0<t&&(n*=256);)r+=this[e+--t]*n;return r},v.prototype.readUInt8=function(e,t){return t||h(e,1,this.length),this[e]},v.prototype.readUInt16LE=function(e,t){return t||h(e,2,this.length),this[e]|this[e+1]<<8},v.prototype.readUInt16BE=function(e,t){return t||h(e,2,this.length),this[e]<<8|this[e+1]},v.prototype.readUInt32LE=function(e,t){return t||h(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},v.prototype.readUInt32BE=function(e,t){return t||h(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},v.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||h(e,t,this.length);for(var r=this[e],n=1,o=0;++o<t&&(n*=256);)r+=this[e+o]*n;return(n*=128)<=r&&(r-=Math.pow(2,8*t)),r},v.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||h(e,t,this.length);for(var r=t,n=1,o=this[e+--r];0<r&&(n*=256);)o+=this[e+--r]*n;return(n*=128)<=o&&(o-=Math.pow(2,8*t)),o},v.prototype.readInt8=function(e,t){return t||h(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},v.prototype.readInt16LE=function(e,t){t||h(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},v.prototype.readInt16BE=function(e,t){t||h(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},v.prototype.readInt32LE=function(e,t){return t||h(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},v.prototype.readInt32BE=function(e,t){return t||h(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},v.prototype.readFloatLE=function(e,t){return t||h(e,4,this.length),Xe(this,e,!0,23,4)},v.prototype.readFloatBE=function(e,t){return t||h(e,4,this.length),Xe(this,e,!1,23,4)},v.prototype.readDoubleLE=function(e,t){return t||h(e,8,this.length),Xe(this,e,!0,52,8)},v.prototype.readDoubleBE=function(e,t){return t||h(e,8,this.length),Xe(this,e,!1,52,8)},v.prototype.writeUIntLE=function(e,t,i,r){e=+e,t|=0,i|=0,r||St(this,e,t,i,Math.pow(2,8*i)-1,0);var n=1,o=0;for(this[t]=255&e;++o<i&&(n*=256);)this[t+o]=e/n&255;return t+i},v.prototype.writeUIntBE=function(e,t,i,r){e=+e,t|=0,i|=0,r||St(this,e,t,i,Math.pow(2,8*i)-1,0);var n=i-1,o=1;for(this[t+n]=255&e;0<=--n&&(o*=256);)this[t+n]=e/o&255;return t+i},v.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||St(this,e,t,1,255,0),v.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},v.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||St(this,e,t,2,65535,0),v.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):wt(this,e,t,!0),t+2},v.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||St(this,e,t,2,65535,0),v.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):wt(this,e,t,!1),t+2},v.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||St(this,e,t,4,4294967295,0),v.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):bt(this,e,t,!0),t+4},v.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||St(this,e,t,4,4294967295,0),v.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):bt(this,e,t,!1),t+4},v.prototype.writeIntLE=function(e,t,i,r){e=+e,t|=0,r||St(this,e,t,i,(r=Math.pow(2,8*i-1))-1,-r);var n=0,o=1,s=0;for(this[t]=255&e;++n<i&&(o*=256);)e<0&&0===s&&0!==this[t+n-1]&&(s=1),this[t+n]=(e/o>>0)-s&255;return t+i},v.prototype.writeIntBE=function(e,t,i,r){e=+e,t|=0,r||St(this,e,t,i,(r=Math.pow(2,8*i-1))-1,-r);var n=i-1,o=1,s=0;for(this[t+n]=255&e;0<=--n&&(o*=256);)e<0&&0===s&&0!==this[t+n+1]&&(s=1),this[t+n]=(e/o>>0)-s&255;return t+i},v.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||St(this,e,t,1,127,-128),v.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&(e=e<0?255+e+1:e),t+1},v.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||St(this,e,t,2,32767,-32768),v.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):wt(this,e,t,!0),t+2},v.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||St(this,e,t,2,32767,-32768),v.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):wt(this,e,t,!1),t+2},v.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||St(this,e,t,4,2147483647,-2147483648),v.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):bt(this,e,t,!0),t+4},v.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||St(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),v.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):bt(this,e,t,!1),t+4},v.prototype.writeFloatLE=function(e,t,i){return Rt(this,e,t,!0,i)},v.prototype.writeFloatBE=function(e,t,i){return Rt(this,e,t,!1,i)},v.prototype.writeDoubleLE=function(e,t,i){return Mt(this,e,t,!0,i)},v.prototype.writeDoubleBE=function(e,t,i){return Mt(this,e,t,!1,i)},v.prototype.copy=function(e,t,i,r){if(i=i||0,r||0===r||(r=this.length),t>=e.length&&(t=e.length),(r=0<r&&r<i?i:r)===i)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length);var n,o=(r=e.length-t<r-i?e.length-t+i:r)-i;if(this===e&&i<t&&t<r)for(n=o-1;0<=n;--n)e[n+t]=this[n+i];else if(o<1e3||!v.TYPED_ARRAY_SUPPORT)for(n=0;n<o;++n)e[n+t]=this[n+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+o),t);return o},v.prototype.fill=function(e,t,i,r){if("string"==typeof e){var n;if("string"==typeof t?(r=t,t=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===e.length&&(n=e.charCodeAt(0))<256&&(e=n),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!v.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(!(i<=t))if(t>>>=0,i=void 0===i?this.length:i>>>0,"number"==typeof(e=e||0))for(a=t;a<i;++a)this[a]=e;else for(var o=ut(e)?e:Pt(new v(e,r).toString()),s=o.length,a=0;a<i-t;++a)this[a+t]=o[a%s];return this};var Et=/[^+\/0-9A-Za-z-_]/g;function Pt(e,t){t=t||1/0;for(var i,r=e.length,n=null,o=[],s=0;s<r;++s){if(55295<(i=e.charCodeAt(s))&&i<57344){if(!n){if(56319<i){-1<(t-=3)&&o.push(239,191,189);continue}if(s+1===r){-1<(t-=3)&&o.push(239,191,189);continue}n=i;continue}if(i<56320){-1<(t-=3)&&o.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&-1<(t-=3)&&o.push(239,191,189);if(n=null,i<128){if(--t<0)break;o.push(i)}else if(i<2048){if((t-=2)<0)break;o.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;o.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return o}function At(e){var t=function(e){var t;if((e=((t=e).trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(Et,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e);Je||Ye();var i,e=t.length;if(0<e%4)throw new Error("Invalid string. Length must be a multiple of 4");for(var r="="===t[e-2]?2:"="===t[e-1]?1:0,n=new Ge(3*e/4-r),o=0<r?e-4:e,s=0,a=0;a<o;a+=4)i=Ve[t.charCodeAt(a)]<<18|Ve[t.charCodeAt(a+1)]<<12|Ve[t.charCodeAt(a+2)]<<6|Ve[t.charCodeAt(a+3)],n[s++]=i>>16&255,n[s++]=i>>8&255,n[s++]=255&i;return 2==r?(i=Ve[t.charCodeAt(a)]<<2|Ve[t.charCodeAt(a+1)]>>4,n[s++]=255&i):1==r&&(i=Ve[t.charCodeAt(a)]<<10|Ve[t.charCodeAt(a+1)]<<4|Ve[t.charCodeAt(a+2)]>>2,n[s++]=i>>8&255,n[s++]=255&i),n}function It(e,t,i,r){for(var n=0;n<r&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}function _t(e){return null!=e&&(!!e._isBuffer||Tt(e)||"function"==typeof(e=e).readFloatLE&&"function"==typeof e.slice&&Tt(e.slice(0,0)))}function Tt(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var u,e=Object.freeze({__proto__:null,Buffer:v,INSPECT_MAX_BYTES:50,SlowBuffer:function(e){return v.alloc(+(e=+e!=e?0:e))},isBuffer:_t,kMaxLength:e});(C=u=u||{})[C.PCM=1]="PCM",C[C.MuLaw=2]="MuLaw",C[C.Siren=3]="Siren",C[C.MP3=4]="MP3",C[C.SILKSkype=5]="SILKSkype",C[C.OGG_OPUS=6]="OGG_OPUS",C[C.WEBM_OPUS=7]="WEBM_OPUS",C[C.ALaw=8]="ALaw",C[C.FLAC=9]="FLAC",C[C.OPUS=10]="OPUS";class Ot{static getDefaultInputFormat(){return kt.getDefaultInputFormat()}static getWaveFormat(e,t,i,r){return new kt(e,t,i,r)}static getWaveFormatPCM(e,t,i){return new kt(e,t,i)}}class kt extends Ot{constructor(e=16e3,t=16,i=1,r=u.PCM){super();let n=!0;switch(r){case u.PCM:this.formatTag=1;break;case u.ALaw:this.formatTag=6;break;case u.MuLaw:this.formatTag=7;break;default:n=!1}this.bitsPerSample=t,this.samplesPerSec=e,this.channels=i,this.avgBytesPerSec=this.samplesPerSec*this.channels*(this.bitsPerSample/8),this.blockAlign=this.channels*Math.max(this.bitsPerSample,8),n&&(this.privHeader=new ArrayBuffer(44),r=new DataView(this.privHeader),this.setString(r,0,"RIFF"),r.setUint32(4,0,!0),this.setString(r,8,"WAVEfmt "),r.setUint32(16,16,!0),r.setUint16(20,this.formatTag,!0),r.setUint16(22,this.channels,!0),r.setUint32(24,this.samplesPerSec,!0),r.setUint32(28,this.avgBytesPerSec,!0),r.setUint16(32,this.channels*(this.bitsPerSample/8),!0),r.setUint16(34,this.bitsPerSample,!0),this.setString(r,36,"data"),r.setUint32(40,0,!0))}static getDefaultInputFormat(){return new kt}static getAudioContext(e){var t=window.AudioContext||window.webkitAudioContext||!1;if(t)return void 0!==e&&navigator.mediaDevices.getSupportedConstraints().sampleRate?new t({sampleRate:e}):new t;throw new Error("Browser does not support Web Audio API (AudioContext is not available).")}close(){}get header(){return this.privHeader}setString(t,i,r){for(let e=0;e<r.length;e++)t.setUint8(i+e,r.charCodeAt(e))}}var t,xt=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class Dt{constructor(){}static createPushStream(e){return Bt.create(e)}static createPullStream(e,t){return zt.create(e,t)}}class Bt extends Dt{static create(e){return new Lt(e)}}class Lt extends Bt{constructor(e){super(),this.privFormat=void 0===e?kt.getDefaultInputFormat():e,this.privEvents=new de,this.privId=l(),this.privStream=new Ce(this.privFormat.avgBytesPerSec/10)}get format(){return Promise.resolve(this.privFormat)}write(e){this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}id(){return this.privId}get blob(){return this.attach("id").then(e=>{const t=[];let i=v.from("");const r=()=>e.read().then(e=>!e||e.isEnd?"undefined"!=typeof XMLHttpRequest&&"undefined"!=typeof Blob?Promise.resolve(new Blob(t)):Promise.resolve(v.from(i)):("undefined"!=typeof Blob?t.push(e.buffer):i=v.concat([i,this.toBuffer(e.buffer)]),r()));return r()})}turnOn(){this.onEvent(new W(this.privId)),this.onEvent(new V(this.privId))}attach(t){return xt(this,void 0,void 0,function*(){this.onEvent(new Z(this.privId,t)),yield this.turnOn();const e=this.privStream;return this.onEvent(new $(this.privId,t)),{detach:()=>xt(this,void 0,void 0,function*(){return this.onEvent(new X(this.privId,t)),this.turnOff()}),id:()=>t,read:()=>e.read()}})}detach(e){this.onEvent(new X(this.privId,e))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:Ai.Unknown,manufacturer:"Speech SDK",model:"PushStream",samplerate:this.privFormat.samplesPerSec,type:Ii.Stream})}onEvent(e){this.privEvents.onEvent(e),o.instance.onEvent(e)}toBuffer(e){var t=v.alloc(e.byteLength),i=new Uint8Array(e);for(let e=0;e<t.length;++e)t[e]=i[e];return t}}class zt extends Dt{constructor(){super()}static create(e,t){return new Nt(e,t)}}class Nt extends zt{constructor(e,t){super(),this.privFormat=void 0===t?Ot.getDefaultInputFormat():t,this.privEvents=new de,this.privId=l(),this.privCallback=e,this.privIsClosed=!1,this.privBufferSize=this.privFormat.avgBytesPerSec/10}get format(){return Promise.resolve(this.privFormat)}close(){this.privIsClosed=!0,this.privCallback.close()}id(){return this.privId}get blob(){return Promise.reject("Not implemented")}turnOn(){this.onEvent(new W(this.privId)),this.onEvent(new V(this.privId))}attach(e){return xt(this,void 0,void 0,function*(){return this.onEvent(new Z(this.privId,e)),yield this.turnOn(),this.onEvent(new $(this.privId,e)),{detach:()=>(this.privCallback.close(),this.onEvent(new X(this.privId,e)),this.turnOff()),id:()=>e,read:()=>{let e=0,t;for(;e<this.privBufferSize;){var i=new ArrayBuffer(this.privBufferSize-e),r=this.privCallback.read(i);if(void 0===t?t=i:new Int8Array(t).set(new Int8Array(i),e),0===r)break;e+=r}return Promise.resolve({buffer:t.slice(0,e),isEnd:this.privIsClosed||0===e,timeReceived:Date.now()})}}})}detach(e){this.onEvent(new X(this.privId,e))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:Ai.Unknown,manufacturer:"Speech SDK",model:"PullStream",samplerate:this.privFormat.samplesPerSec,type:Ii.Stream})}onEvent(e){this.privEvents.onEvent(e),o.instance.onEvent(e)}}(C=t=t||{})[C.Raw8Khz8BitMonoMULaw=0]="Raw8Khz8BitMonoMULaw",C[C.Riff16Khz16KbpsMonoSiren=1]="Riff16Khz16KbpsMonoSiren",C[C.Audio16Khz16KbpsMonoSiren=2]="Audio16Khz16KbpsMonoSiren",C[C.Audio16Khz32KBitRateMonoMp3=3]="Audio16Khz32KBitRateMonoMp3",C[C.Audio16Khz128KBitRateMonoMp3=4]="Audio16Khz128KBitRateMonoMp3",C[C.Audio16Khz64KBitRateMonoMp3=5]="Audio16Khz64KBitRateMonoMp3",C[C.Audio24Khz48KBitRateMonoMp3=6]="Audio24Khz48KBitRateMonoMp3",C[C.Audio24Khz96KBitRateMonoMp3=7]="Audio24Khz96KBitRateMonoMp3",C[C.Audio24Khz160KBitRateMonoMp3=8]="Audio24Khz160KBitRateMonoMp3",C[C.Raw16Khz16BitMonoTrueSilk=9]="Raw16Khz16BitMonoTrueSilk",C[C.Riff16Khz16BitMonoPcm=10]="Riff16Khz16BitMonoPcm",C[C.Riff8Khz16BitMonoPcm=11]="Riff8Khz16BitMonoPcm",C[C.Riff24Khz16BitMonoPcm=12]="Riff24Khz16BitMonoPcm",C[C.Riff8Khz8BitMonoMULaw=13]="Riff8Khz8BitMonoMULaw",C[C.Raw16Khz16BitMonoPcm=14]="Raw16Khz16BitMonoPcm",C[C.Raw24Khz16BitMonoPcm=15]="Raw24Khz16BitMonoPcm",C[C.Raw8Khz16BitMonoPcm=16]="Raw8Khz16BitMonoPcm",C[C.Ogg16Khz16BitMonoOpus=17]="Ogg16Khz16BitMonoOpus",C[C.Ogg24Khz16BitMonoOpus=18]="Ogg24Khz16BitMonoOpus",C[C.Raw48Khz16BitMonoPcm=19]="Raw48Khz16BitMonoPcm",C[C.Riff48Khz16BitMonoPcm=20]="Riff48Khz16BitMonoPcm",C[C.Audio48Khz96KBitRateMonoMp3=21]="Audio48Khz96KBitRateMonoMp3",C[C.Audio48Khz192KBitRateMonoMp3=22]="Audio48Khz192KBitRateMonoMp3",C[C.Ogg48Khz16BitMonoOpus=23]="Ogg48Khz16BitMonoOpus",C[C.Webm16Khz16BitMonoOpus=24]="Webm16Khz16BitMonoOpus",C[C.Webm24Khz16BitMonoOpus=25]="Webm24Khz16BitMonoOpus",C[C.Raw24Khz16BitMonoTrueSilk=26]="Raw24Khz16BitMonoTrueSilk",C[C.Raw8Khz8BitMonoALaw=27]="Raw8Khz8BitMonoALaw",C[C.Riff8Khz8BitMonoALaw=28]="Riff8Khz8BitMonoALaw",C[C.Webm24Khz16Bit24KbpsMonoOpus=29]="Webm24Khz16Bit24KbpsMonoOpus",C[C.Audio16Khz16Bit32KbpsMonoOpus=30]="Audio16Khz16Bit32KbpsMonoOpus",C[C.Audio24Khz16Bit48KbpsMonoOpus=31]="Audio24Khz16Bit48KbpsMonoOpus",C[C.Audio24Khz16Bit24KbpsMonoOpus=32]="Audio24Khz16Bit24KbpsMonoOpus",C[C.Raw22050Hz16BitMonoPcm=33]="Raw22050Hz16BitMonoPcm",C[C.Riff22050Hz16BitMonoPcm=34]="Riff22050Hz16BitMonoPcm",C[C.Raw44100Hz16BitMonoPcm=35]="Raw44100Hz16BitMonoPcm",C[C.Riff44100Hz16BitMonoPcm=36]="Riff44100Hz16BitMonoPcm";class g extends kt{constructor(e,t,i,r,n,o,s,a,h){super(i,o,t,e),this.formatTag=e,this.avgBytesPerSec=r,this.blockAlign=n,this.priAudioFormatString=s,this.priRequestAudioFormatString=a,this.priHasHeader=h}static fromSpeechSynthesisOutputFormat(e){return void 0===e?g.getDefaultOutputFormat():g.fromSpeechSynthesisOutputFormatString(g.SpeechSynthesisOutputFormatToString[e])}static fromSpeechSynthesisOutputFormatString(e){switch(e){case"raw-8khz-8bit-mono-mulaw":return new g(u.MuLaw,1,8e3,8e3,1,8,e,e,!1);case"riff-16khz-16kbps-mono-siren":return new g(u.Siren,1,16e3,2e3,40,0,e,"audio-16khz-16kbps-mono-siren",!0);case"audio-16khz-16kbps-mono-siren":return new g(u.Siren,1,16e3,2e3,40,0,e,e,!1);case"audio-16khz-32kbitrate-mono-mp3":return new g(u.MP3,1,16e3,4096,2,16,e,e,!1);case"audio-16khz-128kbitrate-mono-mp3":return new g(u.MP3,1,16e3,16384,2,16,e,e,!1);case"audio-16khz-64kbitrate-mono-mp3":return new g(u.MP3,1,16e3,8192,2,16,e,e,!1);case"audio-24khz-48kbitrate-mono-mp3":return new g(u.MP3,1,24e3,6144,2,16,e,e,!1);case"audio-24khz-96kbitrate-mono-mp3":return new g(u.MP3,1,24e3,12288,2,16,e,e,!1);case"audio-24khz-160kbitrate-mono-mp3":return new g(u.MP3,1,24e3,20480,2,16,e,e,!1);case"raw-16khz-16bit-mono-truesilk":return new g(u.SILKSkype,1,16e3,32e3,2,16,e,e,!1);case"riff-8khz-16bit-mono-pcm":return new g(u.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!0);case"riff-24khz-16bit-mono-pcm":return new g(u.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!0);case"riff-8khz-8bit-mono-mulaw":return new g(u.MuLaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-mulaw",!0);case"raw-16khz-16bit-mono-pcm":return new g(u.PCM,1,16e3,32e3,2,16,e,"raw-16khz-16bit-mono-pcm",!1);case"raw-24khz-16bit-mono-pcm":return new g(u.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!1);case"raw-8khz-16bit-mono-pcm":return new g(u.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!1);case"ogg-16khz-16bit-mono-opus":return new g(u.OGG_OPUS,1,16e3,8192,2,16,e,e,!1);case"ogg-24khz-16bit-mono-opus":return new g(u.OGG_OPUS,1,24e3,8192,2,16,e,e,!1);case"raw-48khz-16bit-mono-pcm":return new g(u.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!1);case"riff-48khz-16bit-mono-pcm":return new g(u.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!0);case"audio-48khz-96kbitrate-mono-mp3":return new g(u.MP3,1,48e3,12288,2,16,e,e,!1);case"audio-48khz-192kbitrate-mono-mp3":return new g(u.MP3,1,48e3,24576,2,16,e,e,!1);case"ogg-48khz-16bit-mono-opus":return new g(u.OGG_OPUS,1,48e3,12e3,2,16,e,e,!1);case"webm-16khz-16bit-mono-opus":return new g(u.WEBM_OPUS,1,16e3,4e3,2,16,e,e,!1);case"webm-24khz-16bit-mono-opus":return new g(u.WEBM_OPUS,1,24e3,6e3,2,16,e,e,!1);case"webm-24khz-16bit-24kbps-mono-opus":return new g(u.WEBM_OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-16khz-16bit-32kbps-mono-opus":return new g(u.OPUS,1,16e3,4e3,2,16,e,e,!1);case"audio-24khz-16bit-48kbps-mono-opus":return new g(u.OPUS,1,24e3,6e3,2,16,e,e,!1);case"audio-24khz-16bit-24kbps-mono-opus":return new g(u.OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-24khz-16bit-mono-flac":return new g(u.FLAC,1,24e3,24e3,2,16,e,e,!1);case"audio-48khz-16bit-mono-flac":return new g(u.FLAC,1,48e3,3e4,2,16,e,e,!1);case"raw-24khz-16bit-mono-truesilk":return new g(u.SILKSkype,1,24e3,48e3,2,16,e,e,!1);case"raw-8khz-8bit-mono-alaw":return new g(u.ALaw,1,8e3,8e3,1,8,e,e,!1);case"riff-8khz-8bit-mono-alaw":return new g(u.ALaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-alaw",!0);case"raw-22050hz-16bit-mono-pcm":return new g(u.PCM,1,22050,44100,2,16,e,e,!1);case"riff-22050hz-16bit-mono-pcm":return new g(u.PCM,1,22050,44100,2,16,e,"raw-22050hz-16bit-mono-pcm",!0);case"raw-44100hz-16bit-mono-pcm":return new g(u.PCM,1,44100,88200,2,16,e,e,!1);case"riff-44100hz-16bit-mono-pcm":return new g(u.PCM,1,44100,88200,2,16,e,"raw-44100hz-16bit-mono-pcm",!0);default:return new g(u.PCM,1,16e3,32e3,2,16,"riff-16khz-16bit-mono-pcm","raw-16khz-16bit-mono-pcm",!0)}}static getDefaultOutputFormat(){return g.fromSpeechSynthesisOutputFormatString("undefined"!=typeof window?"audio-24khz-48kbitrate-mono-mp3":"riff-16khz-16bit-mono-pcm")}get hasHeader(){return this.priHasHeader}get header(){if(this.hasHeader)return this.privHeader}updateHeader(e){var t;this.priHasHeader&&((t=new DataView(this.privHeader)).setUint32(4,e+this.privHeader.byteLength-8,!0),t.setUint32(40,e,!0))}get requestAudioFormatString(){return this.priRequestAudioFormatString}}g.SpeechSynthesisOutputFormatToString={[t.Raw8Khz8BitMonoMULaw]:"raw-8khz-8bit-mono-mulaw",[t.Riff16Khz16KbpsMonoSiren]:"riff-16khz-16kbps-mono-siren",[t.Audio16Khz16KbpsMonoSiren]:"audio-16khz-16kbps-mono-siren",[t.Audio16Khz32KBitRateMonoMp3]:"audio-16khz-32kbitrate-mono-mp3",[t.Audio16Khz128KBitRateMonoMp3]:"audio-16khz-128kbitrate-mono-mp3",[t.Audio16Khz64KBitRateMonoMp3]:"audio-16khz-64kbitrate-mono-mp3",[t.Audio24Khz48KBitRateMonoMp3]:"audio-24khz-48kbitrate-mono-mp3",[t.Audio24Khz96KBitRateMonoMp3]:"audio-24khz-96kbitrate-mono-mp3",[t.Audio24Khz160KBitRateMonoMp3]:"audio-24khz-160kbitrate-mono-mp3",[t.Raw16Khz16BitMonoTrueSilk]:"raw-16khz-16bit-mono-truesilk",[t.Riff16Khz16BitMonoPcm]:"riff-16khz-16bit-mono-pcm",[t.Riff8Khz16BitMonoPcm]:"riff-8khz-16bit-mono-pcm",[t.Riff24Khz16BitMonoPcm]:"riff-24khz-16bit-mono-pcm",[t.Riff8Khz8BitMonoMULaw]:"riff-8khz-8bit-mono-mulaw",[t.Raw16Khz16BitMonoPcm]:"raw-16khz-16bit-mono-pcm",[t.Raw24Khz16BitMonoPcm]:"raw-24khz-16bit-mono-pcm",[t.Raw8Khz16BitMonoPcm]:"raw-8khz-16bit-mono-pcm",[t.Ogg16Khz16BitMonoOpus]:"ogg-16khz-16bit-mono-opus",[t.Ogg24Khz16BitMonoOpus]:"ogg-24khz-16bit-mono-opus",[t.Raw48Khz16BitMonoPcm]:"raw-48khz-16bit-mono-pcm",[t.Riff48Khz16BitMonoPcm]:"riff-48khz-16bit-mono-pcm",[t.Audio48Khz96KBitRateMonoMp3]:"audio-48khz-96kbitrate-mono-mp3",[t.Audio48Khz192KBitRateMonoMp3]:"audio-48khz-192kbitrate-mono-mp3",[t.Ogg48Khz16BitMonoOpus]:"ogg-48khz-16bit-mono-opus",[t.Webm16Khz16BitMonoOpus]:"webm-16khz-16bit-mono-opus",[t.Webm24Khz16BitMonoOpus]:"webm-24khz-16bit-mono-opus",[t.Webm24Khz16Bit24KbpsMonoOpus]:"webm-24khz-16bit-24kbps-mono-opus",[t.Raw24Khz16BitMonoTrueSilk]:"raw-24khz-16bit-mono-truesilk",[t.Raw8Khz8BitMonoALaw]:"raw-8khz-8bit-mono-alaw",[t.Riff8Khz8BitMonoALaw]:"riff-8khz-8bit-mono-alaw",[t.Audio16Khz16Bit32KbpsMonoOpus]:"audio-16khz-16bit-32kbps-mono-opus",[t.Audio24Khz16Bit48KbpsMonoOpus]:"audio-24khz-16bit-48kbps-mono-opus",[t.Audio24Khz16Bit24KbpsMonoOpus]:"audio-24khz-16bit-24kbps-mono-opus",[t.Raw22050Hz16BitMonoPcm]:"raw-22050hz-16bit-mono-pcm",[t.Riff22050Hz16BitMonoPcm]:"riff-22050hz-16bit-mono-pcm",[t.Raw44100Hz16BitMonoPcm]:"raw-44100hz-16bit-mono-pcm",[t.Riff44100Hz16BitMonoPcm]:"riff-44100hz-16bit-mono-pcm"};var Ut,qt,Ft,m,jt=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class Kt{constructor(){}static createPullStream(){return Ht.create()}}class Ht extends Kt{static create(){return new Wt}}class Wt extends Ht{constructor(){super(),this.privId=l(),this.privStream=new be}set format(e){null==e&&(this.privFormat=g.getDefaultOutputFormat()),this.privFormat=e}get format(){return this.privFormat}get isClosed(){return this.privStream.isClosed}id(){return this.privId}read(n){return jt(this,void 0,void 0,function*(){var t=new Int8Array(n);let i=0;if(void 0!==this.privLastChunkView){if(this.privLastChunkView.length>n.byteLength)return t.set(this.privLastChunkView.slice(0,n.byteLength)),this.privLastChunkView=this.privLastChunkView.slice(n.byteLength),Promise.resolve(n.byteLength);t.set(this.privLastChunkView),i=this.privLastChunkView.length,this.privLastChunkView=void 0}for(;i<n.byteLength&&!this.privStream.isReadEnded;){var r=yield this.privStream.read();if(void 0===r||r.isEnd)this.privStream.readEnded();else{let e;r.buffer.byteLength>n.byteLength-i?(e=r.buffer.slice(0,n.byteLength-i),this.privLastChunkView=new Int8Array(r.buffer.slice(n.byteLength-i))):e=r.buffer,t.set(new Int8Array(e),i),i+=e.byteLength}}return i})}write(e){r.throwIfNullOrUndefined(this.privStream,"must set format before writing"),this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}}class Vt extends Kt{constructor(){super()}static create(e){return new Gt(e)}}class Gt extends Vt{constructor(e){super(),this.privId=l(),this.privCallback=e}set format(e){}write(e){this.privCallback.write&&this.privCallback.write(e)}close(){this.privCallback.close&&this.privCallback.close()}id(){return this.privId}}class Jt{static fromDefaultMicrophoneInput(){var e=new vr(!0);return new Yt(new dr(e))}static fromMicrophoneInput(e){var t=new vr(!0);return new Yt(new dr(t,e))}static fromWavFileInput(e,t="unnamedBuffer.wav"){return new Yt(new fr(e,t))}static fromStreamInput(e){if(!1)return new Yt(new Nt(e));if(e instanceof Dt)return new Yt(e);var t;if("undefined"!=typeof MediaStream&&e instanceof MediaStream)return t=new vr(!1),new Yt(new dr(t,null,null,e));throw new Error("Not Supported Type")}static fromDefaultSpeakerOutput(){return new Zt(new Si)}static fromSpeakerOutput(e){if(void 0===e)return Jt.fromDefaultSpeakerOutput();if(e instanceof Si)return new Zt(e);throw new Error("Not Supported Type")}static fromAudioFileOutput(e){return new Zt(new He(e))}static fromStreamOutput(e){if(!1)return new Zt(new Gt(e));if(e instanceof Vt)return new Zt(e);if(e instanceof Ht)return new Zt(e);throw new Error("Not Supported Type")}}class Yt extends Jt{constructor(e){super(),this.privSource=e}get format(){return this.privSource.format}close(e,t){this.privSource.turnOff().then(()=>{e&&e()},e=>{t&&t(e)})}id(){return this.privSource.id()}get blob(){return this.privSource.blob}turnOn(){return this.privSource.turnOn()}attach(e){return this.privSource.attach(e)}detach(e){return this.privSource.detach(e)}turnOff(){return this.privSource.turnOff()}get events(){return this.privSource.events}setProperty(e,t){if(r.throwIfNull(t,"value"),void 0===this.privSource.setProperty)throw new Error("This AudioConfig instance does not support setting properties.");this.privSource.setProperty(e,t)}getProperty(e,t){if(void 0!==this.privSource.getProperty)return this.privSource.getProperty(e,t);throw new Error("This AudioConfig instance does not support getting properties.")}get deviceInfo(){return this.privSource.deviceInfo}}class Zt extends Jt{constructor(e){super(),this.privDestination=e}set format(e){this.privDestination.format=e}write(e){this.privDestination.write(e)}close(){this.privDestination.close()}id(){return this.privDestination.id()}setProperty(){throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(){throw new Error("This AudioConfig instance does not support getting properties.")}}(C=Ut=Ut||{})[C.Error=0]="Error",C[C.EndOfStream=1]="EndOfStream";class $t{constructor(e){this.privSessionId=e}get sessionId(){return this.privSessionId}}class Xt extends $t{constructor(e,t){super(t),this.privOffset=e}get offset(){return this.privOffset}}(C=qt=qt||{})[C.Simple=0]="Simple",C[C.Detailed=1]="Detailed";class Qt extends class{constructor(e,t,i,r,n,o,s,a,h,u){this.privResultId=e,this.privReason=t,this.privText=i,this.privDuration=r,this.privOffset=n,this.privLanguage=o,this.privLanguageDetectionConfidence=s,this.privErrorDetails=a,this.privJson=h,this.privProperties=u}get resultId(){return this.privResultId}get reason(){return this.privReason}get text(){return this.privText}get duration(){return this.privDuration}get offset(){return this.privOffset}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}get errorDetails(){return this.privErrorDetails}get json(){return this.privJson}get properties(){return this.privProperties}}{constructor(e,t,i,r,n,o,s,a,h,u,c){super(e,t,i,r,n,o,s,h,u,c),this.privSpeakerId=a}get speakerId(){return this.privSpeakerId}}class ei extends Xt{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}}class ti extends Xt{constructor(e,t,i,r,n){super(r,n),this.privReason=e,this.privErrorDetails=t,this.privErrorCode=i}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}}class ii extends ti{}(C=Ft=Ft||{})[C.NoMatch=0]="NoMatch",C[C.Canceled=1]="Canceled",C[C.RecognizingSpeech=2]="RecognizingSpeech",C[C.RecognizedSpeech=3]="RecognizedSpeech",C[C.RecognizedKeyword=4]="RecognizedKeyword",C[C.RecognizingIntent=5]="RecognizingIntent",C[C.RecognizedIntent=6]="RecognizedIntent",C[C.TranslatingSpeech=7]="TranslatingSpeech",C[C.TranslatedSpeech=8]="TranslatedSpeech",C[C.SynthesizingAudio=9]="SynthesizingAudio",C[C.SynthesizingAudioCompleted=10]="SynthesizingAudioCompleted",C[C.SynthesizingAudioStarted=11]="SynthesizingAudioStarted",C[C.EnrollingVoiceProfile=12]="EnrollingVoiceProfile",C[C.EnrolledVoiceProfile=13]="EnrolledVoiceProfile",C[C.RecognizedSpeakers=14]="RecognizedSpeakers",C[C.RecognizedSpeaker=15]="RecognizedSpeaker",C[C.ResetVoiceProfile=16]="ResetVoiceProfile",C[C.DeletedVoiceProfile=17]="DeletedVoiceProfile",C[C.VoicesListRetrieved=18]="VoicesListRetrieved";class ri{constructor(){}static fromSubscription(e,t){r.throwIfNullOrWhitespace(e,"subscriptionKey"),r.throwIfNullOrWhitespace(t,"region");var i=new ni;return i.setProperty(m.SpeechServiceConnection_Region,t),i.setProperty(m.SpeechServiceConnection_IntentRegion,t),i.setProperty(m.SpeechServiceConnection_Key,e),i}static fromEndpoint(e,t){r.throwIfNull(e,"endpoint");var i=new ni;return i.setProperty(m.SpeechServiceConnection_Endpoint,e.href),void 0!==t&&i.setProperty(m.SpeechServiceConnection_Key,t),i}static fromHost(e,t){r.throwIfNull(e,"hostName");var i=new ni;return i.setProperty(m.SpeechServiceConnection_Host,e.protocol+"//"+e.hostname+(""===e.port?"":":"+e.port)),void 0!==t&&i.setProperty(m.SpeechServiceConnection_Key,t),i}static fromAuthorizationToken(e,t){r.throwIfNull(e,"authorizationToken"),r.throwIfNullOrWhitespace(t,"region");var i=new ni;return i.setProperty(m.SpeechServiceConnection_Region,t),i.setProperty(m.SpeechServiceConnection_IntentRegion,t),i.authorizationToken=e,i}close(){}}class ni extends ri{constructor(){super(),this.privProperties=new oi,this.speechRecognitionLanguage="en-US",this.outputFormat=qt.Simple}get properties(){return this.privProperties}get endPoint(){return new URL(this.privProperties.getProperty(m.SpeechServiceConnection_Endpoint))}get subscriptionKey(){return this.privProperties.getProperty(m.SpeechServiceConnection_Key)}get region(){return this.privProperties.getProperty(m.SpeechServiceConnection_Region)}get authorizationToken(){return this.privProperties.getProperty(m.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.privProperties.setProperty(m.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return this.privProperties.getProperty(m.SpeechServiceConnection_RecoLanguage)}set speechRecognitionLanguage(e){this.privProperties.setProperty(m.SpeechServiceConnection_RecoLanguage,e)}get autoDetectSourceLanguages(){return this.privProperties.getProperty(m.SpeechServiceConnection_AutoDetectSourceLanguages)}set autoDetectSourceLanguages(e){this.privProperties.setProperty(m.SpeechServiceConnection_AutoDetectSourceLanguages,e)}get outputFormat(){return qt[this.privProperties.getProperty(ar,void 0)]}set outputFormat(e){this.privProperties.setProperty(ar,qt[e])}get endpointId(){return this.privProperties.getProperty(m.SpeechServiceConnection_EndpointId)}set endpointId(e){this.privProperties.setProperty(m.SpeechServiceConnection_EndpointId,e)}setProperty(e,t){r.throwIfNull(t,"value"),this.privProperties.setProperty(e,t)}getProperty(e,t){return this.privProperties.getProperty(e,t)}setProxy(e,t,i,r){this.setProperty(m[m.SpeechServiceConnection_ProxyHostName],e),this.setProperty(m[m.SpeechServiceConnection_ProxyPort],t),this.setProperty(m[m.SpeechServiceConnection_ProxyUserName],i),this.setProperty(m[m.SpeechServiceConnection_ProxyPassword],r)}setServiceProperty(e,t){var i=JSON.parse(this.privProperties.getProperty(ur,"{}"));i[e]=t,this.privProperties.setProperty(ur,JSON.stringify(i))}setProfanity(e){this.privProperties.setProperty(m.SpeechServiceResponse_ProfanityOption,hi[e])}enableAudioLogging(){this.privProperties.setProperty(m.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privProperties.setProperty(m.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privProperties.setProperty(cr,"true")}clone(){var e=new ni;return e.privProperties=this.privProperties.clone(),e}get speechSynthesisLanguage(){return this.privProperties.getProperty(m.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(e){this.privProperties.setProperty(m.SpeechServiceConnection_SynthLanguage,e)}get speechSynthesisVoiceName(){return this.privProperties.getProperty(m.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(e){this.privProperties.setProperty(m.SpeechServiceConnection_SynthVoice,e)}get speechSynthesisOutputFormat(){return t[this.privProperties.getProperty(m.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(e){this.privProperties.setProperty(m.SpeechServiceConnection_SynthOutputFormat,t[e])}}class oi{constructor(){this.privKeys=[],this.privValues=[]}getProperty(e,t){let i;i="string"==typeof e?e:m[e];for(let e=0;e<this.privKeys.length;e++)if(this.privKeys[e]===i)return this.privValues[e];if(void 0!==t)return String(t)}setProperty(e,t){let i;i="string"==typeof e?e:m[e];for(let e=0;e<this.privKeys.length;e++)if(this.privKeys[e]===i)return void(this.privValues[e]=t);this.privKeys.push(i),this.privValues.push(t)}clone(){var t=new oi;for(let e=0;e<this.privKeys.length;e++)t.privKeys.push(this.privKeys[e]),t.privValues.push(this.privValues[e]);return t}mergeTo(i){this.privKeys.forEach(e=>{var t;void 0===i.getProperty(e,void 0)&&(t=this.getProperty(e),i.setProperty(e,t))})}get keys(){return this.privKeys}}(C=m=m||{})[C.SpeechServiceConnection_Key=0]="SpeechServiceConnection_Key",C[C.SpeechServiceConnection_Endpoint=1]="SpeechServiceConnection_Endpoint",C[C.SpeechServiceConnection_Region=2]="SpeechServiceConnection_Region",C[C.SpeechServiceAuthorization_Token=3]="SpeechServiceAuthorization_Token",C[C.SpeechServiceAuthorization_Type=4]="SpeechServiceAuthorization_Type",C[C.SpeechServiceConnection_EndpointId=5]="SpeechServiceConnection_EndpointId",C[C.SpeechServiceConnection_TranslationToLanguages=6]="SpeechServiceConnection_TranslationToLanguages",C[C.SpeechServiceConnection_TranslationVoice=7]="SpeechServiceConnection_TranslationVoice",C[C.SpeechServiceConnection_TranslationFeatures=8]="SpeechServiceConnection_TranslationFeatures",C[C.SpeechServiceConnection_IntentRegion=9]="SpeechServiceConnection_IntentRegion",C[C.SpeechServiceConnection_ProxyHostName=10]="SpeechServiceConnection_ProxyHostName",C[C.SpeechServiceConnection_ProxyPort=11]="SpeechServiceConnection_ProxyPort",C[C.SpeechServiceConnection_ProxyUserName=12]="SpeechServiceConnection_ProxyUserName",C[C.SpeechServiceConnection_ProxyPassword=13]="SpeechServiceConnection_ProxyPassword",C[C.SpeechServiceConnection_RecoMode=14]="SpeechServiceConnection_RecoMode",C[C.SpeechServiceConnection_RecoLanguage=15]="SpeechServiceConnection_RecoLanguage",C[C.Speech_SessionId=16]="Speech_SessionId",C[C.SpeechServiceConnection_SynthLanguage=17]="SpeechServiceConnection_SynthLanguage",C[C.SpeechServiceConnection_SynthVoice=18]="SpeechServiceConnection_SynthVoice",C[C.SpeechServiceConnection_SynthOutputFormat=19]="SpeechServiceConnection_SynthOutputFormat",C[C.SpeechServiceConnection_AutoDetectSourceLanguages=20]="SpeechServiceConnection_AutoDetectSourceLanguages",C[C.SpeechServiceResponse_RequestDetailedResultTrueFalse=21]="SpeechServiceResponse_RequestDetailedResultTrueFalse",C[C.SpeechServiceResponse_RequestProfanityFilterTrueFalse=22]="SpeechServiceResponse_RequestProfanityFilterTrueFalse",C[C.SpeechServiceResponse_JsonResult=23]="SpeechServiceResponse_JsonResult",C[C.SpeechServiceResponse_JsonErrorDetails=24]="SpeechServiceResponse_JsonErrorDetails",C[C.CancellationDetails_Reason=25]="CancellationDetails_Reason",C[C.CancellationDetails_ReasonText=26]="CancellationDetails_ReasonText",C[C.CancellationDetails_ReasonDetailedText=27]="CancellationDetails_ReasonDetailedText",C[C.LanguageUnderstandingServiceResponse_JsonResult=28]="LanguageUnderstandingServiceResponse_JsonResult",C[C.SpeechServiceConnection_Url=29]="SpeechServiceConnection_Url",C[C.SpeechServiceConnection_InitialSilenceTimeoutMs=30]="SpeechServiceConnection_InitialSilenceTimeoutMs",C[C.SpeechServiceConnection_EndSilenceTimeoutMs=31]="SpeechServiceConnection_EndSilenceTimeoutMs",C[C.Speech_SegmentationSilenceTimeoutMs=32]="Speech_SegmentationSilenceTimeoutMs",C[C.SpeechServiceConnection_EnableAudioLogging=33]="SpeechServiceConnection_EnableAudioLogging",C[C.SpeechServiceConnection_AtStartLanguageIdPriority=34]="SpeechServiceConnection_AtStartLanguageIdPriority",C[C.SpeechServiceConnection_ContinuousLanguageIdPriority=35]="SpeechServiceConnection_ContinuousLanguageIdPriority",C[C.SpeechServiceConnection_RecognitionEndpointVersion=36]="SpeechServiceConnection_RecognitionEndpointVersion",C[C.SpeechServiceResponse_ProfanityOption=37]="SpeechServiceResponse_ProfanityOption",C[C.SpeechServiceResponse_PostProcessingOption=38]="SpeechServiceResponse_PostProcessingOption",C[C.SpeechServiceResponse_RequestWordLevelTimestamps=39]="SpeechServiceResponse_RequestWordLevelTimestamps",C[C.SpeechServiceResponse_StablePartialResultThreshold=40]="SpeechServiceResponse_StablePartialResultThreshold",C[C.SpeechServiceResponse_OutputFormatOption=41]="SpeechServiceResponse_OutputFormatOption",C[C.SpeechServiceResponse_TranslationRequestStablePartialResult=42]="SpeechServiceResponse_TranslationRequestStablePartialResult",C[C.SpeechServiceResponse_RequestWordBoundary=43]="SpeechServiceResponse_RequestWordBoundary",C[C.SpeechServiceResponse_RequestPunctuationBoundary=44]="SpeechServiceResponse_RequestPunctuationBoundary",C[C.SpeechServiceResponse_RequestSentenceBoundary=45]="SpeechServiceResponse_RequestSentenceBoundary",C[C.Conversation_ApplicationId=46]="Conversation_ApplicationId",C[C.Conversation_DialogType=47]="Conversation_DialogType",C[C.Conversation_Initial_Silence_Timeout=48]="Conversation_Initial_Silence_Timeout",C[C.Conversation_From_Id=49]="Conversation_From_Id",C[C.Conversation_Conversation_Id=50]="Conversation_Conversation_Id",C[C.Conversation_Custom_Voice_Deployment_Ids=51]="Conversation_Custom_Voice_Deployment_Ids",C[C.Conversation_Speech_Activity_Template=52]="Conversation_Speech_Activity_Template",C[C.Conversation_Request_Bot_Status_Messages=53]="Conversation_Request_Bot_Status_Messages",C[C.Conversation_Agent_Connection_Id=54]="Conversation_Agent_Connection_Id",C[C.SpeechServiceConnection_Host=55]="SpeechServiceConnection_Host",C[C.ConversationTranslator_Host=56]="ConversationTranslator_Host",C[C.ConversationTranslator_Name=57]="ConversationTranslator_Name",C[C.ConversationTranslator_CorrelationId=58]="ConversationTranslator_CorrelationId",C[C.ConversationTranslator_Token=59]="ConversationTranslator_Token",C[C.PronunciationAssessment_ReferenceText=60]="PronunciationAssessment_ReferenceText",C[C.PronunciationAssessment_GradingSystem=61]="PronunciationAssessment_GradingSystem",C[C.PronunciationAssessment_Granularity=62]="PronunciationAssessment_Granularity",C[C.PronunciationAssessment_EnableMiscue=63]="PronunciationAssessment_EnableMiscue",C[C.PronunciationAssessment_Json=64]="PronunciationAssessment_Json",C[C.PronunciationAssessment_Params=65]="PronunciationAssessment_Params",C[C.SpeakerRecognition_Api_Version=66]="SpeakerRecognition_Api_Version";var si=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class ai{constructor(e,t,i){this.audioConfig=void 0!==e?e:Jt.fromDefaultMicrophoneInput(),this.privDisposed=!1,this.privProperties=t.clone(),this.privConnectionFactory=i,this.implCommonRecognizerSetup()}close(e,t){r.throwIfDisposed(this.privDisposed),fe(this.dispose(!0),e,t)}get internalData(){return this.privReco}dispose(e){return si(this,void 0,void 0,function*(){this.privDisposed||(this.privDisposed=!0,e&&this.privReco&&(yield this.privReco.audioSource.turnOff(),yield this.privReco.dispose()))})}static get telemetryEnabled(){return _i.telemetryDataEnabled}static enableTelemetry(e){_i.telemetryDataEnabled=e}implCommonRecognizerSetup(){let e="undefined"!=typeof window?"Browser":"Node",t="unknown",i="unknown";"undefined"!=typeof navigator&&(e=e+"/"+navigator.platform,t=navigator.userAgent,i=navigator.appVersion);var r=this.createRecognizerConfig(new Oi(new ki(new Di(e,t,i))));this.privReco=this.createServiceRecognizer(ai.getAuthFromProperties(this.privProperties),this.privConnectionFactory,this.audioConfig,r)}recognizeOnceAsyncImpl(t){return si(this,void 0,void 0,function*(){r.throwIfDisposed(this.privDisposed);var e=new d,e=(yield this.implRecognizerStop(),yield this.privReco.recognize(t,e.resolve,e.reject),yield e.promise);return yield this.implRecognizerStop(),e})}startContinuousRecognitionAsyncImpl(e){return si(this,void 0,void 0,function*(){r.throwIfDisposed(this.privDisposed),yield this.implRecognizerStop(),yield this.privReco.recognize(e,void 0,void 0)})}stopContinuousRecognitionAsyncImpl(){return si(this,void 0,void 0,function*(){r.throwIfDisposed(this.privDisposed),yield this.implRecognizerStop()})}implRecognizerStop(){return si(this,void 0,void 0,function*(){this.privReco&&(yield this.privReco.stopRecognizing())})}static getAuthFromProperties(t){var e=t.getProperty(m.SpeechServiceConnection_Key,void 0);return e&&""!==e?new je(e):new Ke(()=>{var e=t.getProperty(m.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(e)},()=>{var e=t.getProperty(m.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(e)})}}var y,hi,ui=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class ci extends ai{constructor(e,t){r.throwIfNull(e,"speechConfig"),r.throwIfNullOrWhitespace(e.properties.getProperty(m.SpeechServiceConnection_RecoLanguage),m[m.SpeechServiceConnection_RecoLanguage]),super(t,e.properties,new Li),this.privDisposedRecognizer=!1}static FromConfig(e,t,i){t.properties.mergeTo(e.properties);t=new ci(e,i);return t}get endpointId(){return r.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(m.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(m.SpeechServiceAuthorization_Token)}set authorizationToken(e){r.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(m.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return r.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(m.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return r.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(ar,qt[qt.Simple])===qt[qt.Simple]?qt.Simple:qt.Detailed}get properties(){return this.privProperties}recognizeOnceAsync(e,t){fe(this.recognizeOnceAsyncImpl(Pi.Interactive),e,t)}startContinuousRecognitionAsync(e,t){fe(this.startContinuousRecognitionAsyncImpl(Pi.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){fe(this.stopContinuousRecognitionAsyncImpl(),e,t)}startKeywordRecognitionAsync(e,t,i){r.throwIfNull(e,"model"),i&&i("Not yet implemented.")}stopKeywordRecognitionAsync(e){e&&e()}close(e,t){r.throwIfDisposed(this.privDisposedRecognizer),fe(this.dispose(!0),e,t)}dispose(e){const t=Object.create(null,{dispose:{get:()=>super.dispose}});return ui(this,void 0,void 0,function*(){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,yield this.implRecognizerStop()),yield t.dispose.call(this,e))})}createRecognizerConfig(e){return new Ti(e,this.properties)}createServiceRecognizer(e,t,i,r){return new Fi(e,t,i,r,this)}}(C=y=y||{})[C.NoError=0]="NoError",C[C.AuthenticationFailure=1]="AuthenticationFailure",C[C.BadRequestParameters=2]="BadRequestParameters",C[C.TooManyRequests=3]="TooManyRequests",C[C.ConnectionFailure=4]="ConnectionFailure",C[C.ServiceTimeout=5]="ServiceTimeout",C[C.ServiceError=6]="ServiceError",C[C.RuntimeError=7]="RuntimeError",C[C.Forbidden=8]="Forbidden";class S{}S.BotId="botid",S.CustomSpeechDeploymentId="cid",S.CustomVoiceDeploymentId="deploymentId",S.EnableAudioLogging="storeAudio",S.EnableLanguageId="lidEnabled",S.EnableWordLevelTimestamps="wordLevelTimestamps",S.EndSilenceTimeoutMs="endSilenceTimeoutMs",S.SegmentationSilenceTimeoutMs="segmentationSilenceTimeoutMs",S.Format="format",S.InitialSilenceTimeoutMs="initialSilenceTimeoutMs",S.Language="language",S.Profanity="profanity",S.RequestBotStatusMessages="enableBotMessageStatus",S.StableIntermediateThreshold="stableIntermediateThreshold",S.StableTranslation="stableTranslation",S.TestHooks="testhooks",S.Postprocessing="postprocessing";class pi{static getHostSuffix(e){if(e){if(e.toLowerCase().startsWith("china"))return".azure.cn";if(e.toLowerCase().startsWith("usgov"))return".azure.us"}return".microsoft.com"}setCommonUrlParams(i,r,n){new Map([[m.Speech_SegmentationSilenceTimeoutMs,S.SegmentationSilenceTimeoutMs],[m.SpeechServiceConnection_EnableAudioLogging,S.EnableAudioLogging],[m.SpeechServiceConnection_EndSilenceTimeoutMs,S.EndSilenceTimeoutMs],[m.SpeechServiceConnection_InitialSilenceTimeoutMs,S.InitialSilenceTimeoutMs],[m.SpeechServiceResponse_PostProcessingOption,S.Postprocessing],[m.SpeechServiceResponse_ProfanityOption,S.Profanity],[m.SpeechServiceResponse_RequestWordLevelTimestamps,S.EnableWordLevelTimestamps],[m.SpeechServiceResponse_StablePartialResultThreshold,S.StableIntermediateThreshold]]).forEach((e,t)=>{this.setUrlParameter(t,e,i,r,n)});const t=JSON.parse(i.parameters.getProperty(ur,"{}"));Object.keys(t).forEach(e=>{r[e]=t[e]})}setUrlParameter(e,t,i,r,n){i=i.parameters.getProperty(e,void 0);!i||n&&-1!==n.search(t)||(r[t]=i.toLocaleLowerCase())}}(C=hi=hi||{})[C.Masked=0]="Masked",C[C.Removed=1]="Removed",C[C.Raw=2]="Raw";class di extends class{constructor(e,t,i,r){this.privResultId=e,this.privReason=t,this.privErrorDetails=i,this.privProperties=r}get resultId(){return this.privResultId}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get properties(){return this.privProperties}}{constructor(e,t,i,r,n,o){super(e,t,r,n),this.privAudioData=i,this.privAudioDuration=o}get audioData(){return this.privAudioData}get audioDuration(){return this.privAudioDuration}}class li{constructor(e){this.privResult=e}get result(){return this.privResult}}class fi{constructor(e,t,i,r,n,o){this.privAudioOffset=e,this.privDuration=t,this.privText=i,this.privWordLength=r,this.privTextOffset=n,this.privBoundaryType=o}get audioOffset(){return this.privAudioOffset}get duration(){return this.privDuration}get text(){return this.privText}get wordLength(){return this.privWordLength}get textOffset(){return this.privTextOffset}get boundaryType(){return this.privBoundaryType}}class vi{constructor(e,t){this.privAudioOffset=e,this.privText=t}get audioOffset(){return this.privAudioOffset}get text(){return this.privText}}class gi{constructor(e,t,i){this.privAudioOffset=e,this.privVisemeId=t,this.privAnimation=i}get audioOffset(){return this.privAudioOffset}get visemeId(){return this.privVisemeId}get animation(){return this.privAnimation}}var mi=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};const yi={[u.PCM]:"audio/wav",[u.MuLaw]:"audio/x-wav",[u.MP3]:"audio/mpeg",[u.OGG_OPUS]:"audio/ogg",[u.WEBM_OPUS]:"audio/webm; codecs=opus",[u.ALaw]:"audio/x-wav",[u.FLAC]:"audio/flac"};class Si{constructor(e){this.privPlaybackStarted=!1,this.privAppendingToBuffer=!1,this.privMediaSourceOpened=!1,this.privBytesReceived=0,this.privId=e||l(),this.privIsPaused=!1,this.privIsClosed=!1}id(){return this.privId}write(e,t,i){void 0!==this.privAudioBuffer?(this.privAudioBuffer.push(e),this.updateSourceBuffer().then(()=>{t&&t()},e=>{i&&i(e)})):void 0!==this.privAudioOutputStream&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength)}close(i,r){if(this.privIsClosed=!0,void 0!==this.privSourceBuffer)this.handleSourceBufferUpdateEnd().then(()=>{i&&i()},e=>{r&&r(e)});else if(void 0!==this.privAudioOutputStream&&"undefined"!=typeof window)if(this.privFormat.formatTag!==u.PCM&&this.privFormat.formatTag!==u.MuLaw&&this.privFormat.formatTag!==u.ALaw||!1!==this.privFormat.hasHeader){let t=new ArrayBuffer(this.privBytesReceived);this.privAudioOutputStream.read(t).then(()=>{t=Qi.addHeader(t,this.privFormat);var e=new Blob([t],{type:yi[this.privFormat.formatTag]});this.privAudio.src=window.URL.createObjectURL(e),this.notifyPlayback().then(()=>{i&&i()},e=>{r&&r(e)})},e=>{r&&r(e)})}else console.warn("Play back is not supported for raw PCM, mulaw or alaw format without header."),this.onAudioEnd&&this.onAudioEnd(this);else this.onAudioEnd&&this.onAudioEnd(this)}set format(e){if("undefined"!=typeof AudioContext||"undefined"!=typeof window&&void 0!==window.webkitAudioContext){this.privFormat=e;const t=yi[this.privFormat.formatTag];void 0===t?console.warn(`Unknown mimeType for format ${u[this.privFormat.formatTag]}; playback is not supported.`):"undefined"!=typeof MediaSource&&MediaSource.isTypeSupported(t)?(this.privAudio=new Audio,this.privAudioBuffer=[],this.privMediaSource=new MediaSource,this.privAudio.src=URL.createObjectURL(this.privMediaSource),this.privAudio.load(),this.privMediaSource.onsourceopen=()=>{this.privMediaSourceOpened=!0,this.privMediaSource.duration=1800,this.privSourceBuffer=this.privMediaSource.addSourceBuffer(t),this.privSourceBuffer.onupdate=()=>{this.updateSourceBuffer().catch(e=>{o.instance.onEvent(new qe(e))})},this.privSourceBuffer.onupdateend=()=>{this.handleSourceBufferUpdateEnd().catch(e=>{o.instance.onEvent(new qe(e))})},this.privSourceBuffer.onupdatestart=()=>{this.privAppendingToBuffer=!1}},this.updateSourceBuffer().catch(e=>{o.instance.onEvent(new qe(e))})):(console.warn(`Format ${u[this.privFormat.formatTag]} could not be played by MSE, streaming playback is not enabled.`),this.privAudioOutputStream=new Wt,this.privAudioOutputStream.format=this.privFormat,this.privAudio=new Audio)}}get volume(){var e;return null!=(e=null==(e=this.privAudio)?void 0:e.volume)?e:-1}set volume(e){this.privAudio&&(this.privAudio.volume=e)}mute(){this.privAudio&&(this.privAudio.muted=!0)}unmute(){this.privAudio&&(this.privAudio.muted=!1)}get isClosed(){return this.privIsClosed}get currentTime(){return void 0!==this.privAudio?this.privAudio.currentTime:-1}pause(){this.privIsPaused||void 0===this.privAudio||(this.privAudio.pause(),this.privIsPaused=!0)}resume(e,t){this.privIsPaused&&void 0!==this.privAudio&&(this.privAudio.play().then(()=>{e&&e()},e=>{t&&t(e)}),this.privIsPaused=!1)}get internalAudio(){return this.privAudio}updateSourceBuffer(){return mi(this,void 0,void 0,function*(){if(void 0!==this.privAudioBuffer&&0<this.privAudioBuffer.length&&this.sourceBufferAvailable()){this.privAppendingToBuffer=!0;var t=this.privAudioBuffer.shift();try{this.privSourceBuffer.appendBuffer(t)}catch(e){return this.privAudioBuffer.unshift(t),void console.log("buffer filled, pausing addition of binaries until space is made")}yield this.notifyPlayback()}else this.canEndStream()&&(yield this.handleSourceBufferUpdateEnd())})}handleSourceBufferUpdateEnd(){return mi(this,void 0,void 0,function*(){this.canEndStream()&&this.sourceBufferAvailable()&&(this.privMediaSource.endOfStream(),yield this.notifyPlayback())})}notifyPlayback(){return mi(this,void 0,void 0,function*(){this.privPlaybackStarted||void 0===this.privAudio||(this.privPlaybackStarted=!0,this.onAudioStart&&this.onAudioStart(this),this.privAudio.onended=()=>{this.onAudioEnd&&this.onAudioEnd(this)},this.privIsPaused)||(yield this.privAudio.play())})}canEndStream(){return this.isClosed&&void 0!==this.privSourceBuffer&&0===this.privAudioBuffer.length&&this.privMediaSourceOpened&&!this.privAppendingToBuffer&&"open"===this.privMediaSource.readyState}sourceBufferAvailable(){return void 0!==this.privSourceBuffer&&!this.privSourceBuffer.updating}}class wi extends K{constructor(e,t,i,r=n.Info){super(e,r),this.privRequestId=t,this.privSessionId=i}get requestId(){return this.privRequestId}get sessionId(){return this.privSessionId}}class bi extends wi{constructor(e,t,i,r){super("RecognitionTriggeredEvent",e,t),this.privAudioSourceId=i,this.privAudioNodeId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}class Ci extends wi{constructor(e,t,i,r){super("ListeningStartedEvent",e,t),this.privAudioSourceId=i,this.privAudioNodeId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}}class Ri extends wi{constructor(e,t,i){super("ConnectingToServiceEvent",e,i),this.privAuthFetchEventid=t}get authFetchEventid(){return this.privAuthFetchEventid}}class Mi extends wi{constructor(e,t,i,r,n){super("RecognitionStartedEvent",e,n),this.privAudioSourceId=t,this.privAudioNodeId=i,this.privAuthFetchEventId=r}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}}class Ei extends ce{constructor(e,t,i,r,n,o,s,a){if(!t)throw new f("path");if(!i)throw new f("requestId");var h={};if(h[c.Path]=t,h[c.RequestId]=i,h[c.RequestTimestamp]=(new Date).toISOString(),r&&(h[c.ContentType]=r),o&&(h[c.RequestStreamId]=o),s)for(const u in s)u&&(h[u]=s[u]);a?super(e,n,h,a):super(e,n,h),this.privPath=t,this.privRequestId=i,this.privContentType=r,this.privStreamId=o,this.privAdditionalHeaders=s}get path(){return this.privPath}get requestId(){return this.privRequestId}get contentType(){return this.privContentType}get streamId(){return this.privStreamId}get additionalHeaders(){return this.privAdditionalHeaders}static fromConnectionMessage(e){let t=null,i=null,r=null,n=null;var o={};if(e.headers)for(const s in e.headers)s&&(s.toLowerCase()===c.Path.toLowerCase()?t=e.headers[s]:s.toLowerCase()===c.RequestId.toLowerCase()?i=e.headers[s]:s.toLowerCase()===c.ContentType.toLowerCase()?r=e.headers[s]:s.toLowerCase()===c.RequestStreamId.toLowerCase()?n=e.headers[s]:o[s]=e.headers[s]);return new Ei(e.messageType,t,i,r,e.body,n,o,e.id)}}var Pi,Ai,Ii,w,b=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class _i{constructor(e,t,i,r,n){if(this.privConnectionConfigurationPromise=void 0,this.privConnectionPromise=void 0,this.privSetTimeout=setTimeout,this.privIsLiveAudio=!1,this.recognizeOverride=void 0,this.disconnectOverride=void 0,this.receiveMessageOverride=void 0,this.sendPrePayloadJSONOverride=void 0,this.postConnectImplOverride=void 0,this.configConnectionOverride=void 0,!e)throw new f("authentication");if(!t)throw new f("connectionFactory");if(!i)throw new f("audioSource");if(!r)throw new f("recognizerConfig");this.privMustReportEndOfStream=!1,this.privAuthentication=e,this.privConnectionFactory=t,this.privAudioSource=i,this.privRecognizerConfig=r,this.privIsDisposed=!1,this.privRecognizer=n,this.privRequestSession=new Gi(this.privAudioSource.id()),this.privConnectionEvents=new de,this.privServiceEvents=new de,this.privDynamicGrammar=new Yi,this.privSpeechContext=new Ji(this.privDynamicGrammar),this.privAgentConfig=new Zi,"undefined"!=typeof Blob&&"undefined"!=typeof Worker&&(this.privSetTimeout=Re.setTimeout),this.connectionEvents.attach(e=>{"ConnectionClosedEvent"===e.name&&(1003===e.statusCode||1007===e.statusCode||1002===e.statusCode||4e3===e.statusCode||this.privRequestSession.numConnectionAttempts>this.privRecognizerConfig.maxRetryCount)&&this.cancelRecognitionLocal(Ut.Error,1007===e.statusCode?y.BadRequestParameters:y.ConnectionFailure,e.reason+" websocket error code: "+e.statusCode)})}get audioSource(){return this.privAudioSource}get speechContext(){return this.privSpeechContext}get dynamicGrammar(){return this.privDynamicGrammar}get agentConfig(){return this.privAgentConfig}set conversationTranslatorToken(e){this.privRecognizerConfig.parameters.setProperty(m.ConversationTranslator_Token,e)}set authentication(e){this.privAuthentication=this.authentication}isDisposed(){return this.privIsDisposed}dispose(e){return b(this,void 0,void 0,function*(){if(this.privIsDisposed=!0,void 0!==this.privConnectionConfigurationPromise)try{yield(yield this.privConnectionConfigurationPromise).dispose(e)}catch(e){}})}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}get recognitionMode(){return this.privRecognizerConfig.recognitionMode}recognize(o,s,a){return b(this,void 0,void 0,function*(){if(void 0!==this.recognizeOverride)yield this.recognizeOverride(o,s,a);else{this.privConnectionConfigurationPromise=void 0,this.privRecognizerConfig.recognitionMode=o,this.privSuccessCallback=s,this.privErrorCallback=a,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events);var t=this.connectImpl();let e;try{var i=yield this.audioSource.attach(this.privRequestSession.audioNodeId),r=yield this.audioSource.format,n=yield this.audioSource.deviceInfo;this.privIsLiveAudio=n.type&&n.type===Ii.Microphones,e=new oh(i,r.avgBytesPerSec),yield this.privRequestSession.onAudioSourceAttachCompleted(e,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:n}}catch(e){throw yield this.privRequestSession.onStopRecognizing(),e}try{yield t}catch(e){return void(yield this.cancelRecognitionLocal(Ut.Error,y.ConnectionFailure,e))}i=new $t(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,i),this.receiveMessage(),this.sendAudio(e).catch(e=>b(this,void 0,void 0,function*(){yield this.cancelRecognitionLocal(Ut.Error,y.RuntimeError,e)}))}})}stopRecognizing(){return b(this,void 0,void 0,function*(){if(this.privRequestSession.isRecognizing)try{yield this.audioSource.turnOff(),yield this.sendFinalAudio(),yield this.privRequestSession.onStopRecognizing(),yield this.privRequestSession.turnCompletionPromise}finally{yield this.privRequestSession.dispose()}})}connect(){return b(this,void 0,void 0,function*(){return yield this.connectImpl(),Promise.resolve()})}connectAsync(e,t){this.connectImpl().then(()=>{try{e&&e()}catch(e){t&&t(e)}},e=>{try{t&&t(e)}catch(e){}})}disconnect(){return b(this,void 0,void 0,function*(){if(yield this.cancelRecognitionLocal(Ut.Error,y.NoError,"Disconnecting"),void 0!==this.disconnectOverride&&(yield this.disconnectOverride()),void 0!==this.privConnectionPromise)try{yield(yield this.privConnectionPromise).dispose()}catch(e){}this.privConnectionPromise=void 0})}sendMessage(e){}sendNetworkMessage(i,r){return b(this,void 0,void 0,function*(){var e="string"==typeof r?p.Text:p.Binary,t="string"==typeof r?"application/json":"";return(yield this.fetchConnection()).send(new Ei(e,i,this.privRequestSession.requestId,t,r))})}set activityTemplate(e){this.privActivityTemplate=e}get activityTemplate(){return this.privActivityTemplate}sendTelemetryData(){return b(this,void 0,void 0,function*(){var e=this.privRequestSession.getTelemetry();if(!0===_i.telemetryDataEnabled&&!this.privIsDisposed&&null!==e){if(_i.telemetryData)try{_i.telemetryData(e)}catch(e){}yield(yield this.fetchConnection()).send(new Ei(p.Text,"telemetry",this.privRequestSession.requestId,"application/json",e))}})}cancelRecognitionLocal(e,t,i){return b(this,void 0,void 0,function*(){this.privRequestSession.isRecognizing&&(yield this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,e,t,i))})}receiveMessage(){return b(this,void 0,void 0,function*(){try{if(!this.privIsDisposed){let t=yield this.fetchConnection();var e=yield t.read();if(void 0!==this.receiveMessageOverride)return this.receiveMessageOverride();if(!e)return this.privRequestSession.isRecognizing?this.receiveMessage():void 0;this.privServiceHasSentMessage=!0;var i=Ei.fromConnectionMessage(e);if(i.requestId.toLowerCase()===this.privRequestSession.requestId.toLowerCase())switch(i.path.toLowerCase()){case"turn.start":this.privMustReportEndOfStream=!0,this.privRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":var r=Ni.fromJSON(i.textBody),n=new Xt(r.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,n);break;case"speech.enddetected":let e;e=0<i.textBody.length?i.textBody:"{ Offset: 0 }";var o=Ni.fromJSON(e),s=(this.privRecognizerConfig.isContinuousRecognition&&this.privRequestSession.onServiceRecognized(o.Offset+this.privRequestSession.currentTurnAudioOffset),new Xt(o.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId));this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,s);break;case"turn.end":yield this.sendTelemetryData(),this.privRequestSession.isSpeechEnded&&this.privMustReportEndOfStream&&(this.privMustReportEndOfStream=!1,yield this.cancelRecognitionLocal(Ut.EndOfStream,y.NoError,void 0));var a=new $t(this.privRequestSession.sessionId);if(yield this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition),!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing)return void(this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,a));t=yield this.fetchConnection(),yield this.sendPrePayloadJSON(t);break;default:(yield this.processTypeSpecificMessages(i))||this.privServiceEvents&&this.serviceEvents.onEvent(new ee(i.path.toLowerCase(),i.textBody))}return this.receiveMessage()}}catch(e){return null}})}sendSpeechContext(e,t){var i=this.speechContext.toJSON();if(t&&this.privRequestSession.onSpeechContext(),i)return e.send(new Ei(p.Text,"speech.context",this.privRequestSession.requestId,"application/json",i))}sendPrePayloadJSON(e,t=!0){return b(this,void 0,void 0,function*(){if(void 0!==this.sendPrePayloadJSONOverride)return this.sendPrePayloadJSONOverride(e);yield this.sendSpeechContext(e,t),yield this.sendWaveHeader(e)})}sendWaveHeader(t){return b(this,void 0,void 0,function*(){var e=yield this.audioSource.format;return t.send(new Ei(p.Binary,"audio",this.privRequestSession.requestId,"audio/x-wav",e.header))})}connectImpl(){return void 0!==this.privConnectionPromise?this.privConnectionPromise.then(e=>e.state()===s.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl())):(this.privConnectionPromise=this.retryableConnect(),this.privConnectionPromise.catch(()=>{}),void 0!==this.postConnectImplOverride?this.postConnectImplOverride(this.privConnectionPromise):this.privConnectionPromise)}sendSpeechServiceConfig(e,t,i){var r;if(t.onSpeechContext(),!0!==_i.telemetryDataEnabled&&(r={context:{system:JSON.parse(i).context.system}},i=JSON.stringify(r)),"true"===this.privRecognizerConfig.parameters.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()&&((r=JSON.parse(i)).context.DisableReferenceChannel="True",r.context.MicSpec="1_0_0",i=JSON.stringify(r)),i)return e.send(new Ei(p.Text,"speech.config",t.requestId,"application/json",i))}fetchConnection(){return b(this,void 0,void 0,function*(){return void 0!==this.privConnectionConfigurationPromise?this.privConnectionConfigurationPromise.then(e=>e.state()===s.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),yield this.privConnectionConfigurationPromise)})}sendAudio(t){return b(this,void 0,void 0,function*(){const n=yield this.audioSource.format;let o=Date.now();var e=this.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000");const s=n.avgBytesPerSec/1e3*parseInt(e,10),a=this.privRequestSession.recogNumber,h=()=>b(this,void 0,void 0,function*(){if(!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===a){var i=yield this.fetchConnection(),r=yield t.read();if(!this.privRequestSession.isSpeechEnded){let e,t;if(0!==(t=!r||r.isEnd?(e=null,0):(e=r.buffer,this.privRequestSession.onAudioSent(e.byteLength),s>=this.privRequestSession.bytesSent?0:Math.max(0,o-Date.now())))&&(yield this.delay(t)),null!==e&&(o=Date.now()+1e3*e.byteLength/(2*n.avgBytesPerSec)),!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===a){if(i.send(new Ei(p.Binary,"audio",this.privRequestSession.requestId,null,e)).catch(()=>{this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition).catch(()=>{})}),null==r||!r.isEnd)return h();this.privIsLiveAudio||this.privRequestSession.onSpeechEnded()}}}});return h()})}retryableConnect(){return b(this,void 0,void 0,function*(){let e=!1;this.privAuthFetchEventId=l();var t=this.privRequestSession.sessionId;this.privConnectionId=void 0!==t?t:l(),this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);let i=0,r="";for(;this.privRequestSession.numConnectionAttempts<=this.privRecognizerConfig.maxRetryCount;){var n=yield e?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId),n=(yield this.privRequestSession.onAuthCompleted(!1),this.privConnectionFactory.create(this.privRecognizerConfig,n,this.privConnectionId)),o=(this.privRequestSession.listenForServiceTelemetry(n.events),n.events.attach(e=>{this.connectionEvents.onEvent(e)}),yield n.open());if(200===o.statusCode)return yield this.privRequestSession.onConnectionEstablishCompleted(o.statusCode),Promise.resolve(n);1006===o.statusCode&&(e=!0),i=o.statusCode,r=o.reason,this.privRequestSession.onRetryConnection()}return yield this.privRequestSession.onConnectionEstablishCompleted(i,r),Promise.reject(`Unable to contact server. StatusCode: ${i}, ${this.privRecognizerConfig.parameters.getProperty(m.SpeechServiceConnection_Endpoint)} Reason: `+r)})}delay(t){return new Promise(e=>this.privSetTimeout(e,t))}writeBufferToConsole(t){let i="Buffer Size: ";if(null===t)i+="null";else{var r=new Uint8Array(t);i+=t.byteLength+`\r
`;for(let e=0;e<t.byteLength;e++)i+=r[e].toString(16).padStart(2,"0")+" ",(e+1)%16==0&&(console.info(i),i="")}console.info(i)}sendFinalAudio(){return b(this,void 0,void 0,function*(){yield(yield this.fetchConnection()).send(new Ei(p.Binary,"audio",this.privRequestSession.requestId,null,null))})}configureConnection(){return b(this,void 0,void 0,function*(){var e=yield this.connectImpl();return void 0!==this.configConnectionOverride?this.configConnectionOverride(e):(yield this.sendSpeechServiceConfig(e,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),yield this.sendPrePayloadJSON(e,!1),e)})}}_i.telemetryDataEnabled=!0,(C=Pi=Pi||{})[C.Interactive=0]="Interactive",C[C.Conversation=1]="Conversation",C[C.Dictation=2]="Dictation";class Ti{constructor(e,t){this.privSpeechServiceConfig=e||new Oi(new ki(null)),this.privParameters=t,this.privMaxRetryCount=parseInt(t.getProperty("SPEECH-Error-MaxRetryCount","4"),10),this.privLanguageIdPriority=t.getProperty(m.SpeechServiceConnection_ContinuousLanguageIdPriority,void 0),this.privLanguageIdMode="Latency"===this.privLanguageIdPriority?"DetectContinuous":"DetectAtAudioStart","DetectAtAudioStart"===this.privLanguageIdMode&&(this.privLanguageIdPriority=t.getProperty(m.SpeechServiceConnection_AtStartLanguageIdPriority,void 0))}get parameters(){return this.privParameters}get recognitionMode(){return this.privRecognitionMode}set recognitionMode(e){this.privRecognitionMode=e,this.privRecognitionActivityTimeout=e===Pi.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=Pi[e]}get SpeechServiceConfig(){return this.privSpeechServiceConfig}get recognitionActivityTimeout(){return this.privRecognitionActivityTimeout}get isContinuousRecognition(){return this.privRecognitionMode!==Pi.Interactive}get languageIdPriority(){return this.privLanguageIdPriority?"Prioritize"+this.privLanguageIdPriority:""}get languageIdMode(){return this.privLanguageIdMode}get autoDetectSourceLanguages(){return this.parameters.getProperty(m.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)}get recognitionEndpointVersion(){return this.parameters.getProperty(m.SpeechServiceConnection_RecognitionEndpointVersion,void 0)}get sourceLanguageModels(){var e=[];let t=!1;if(void 0!==this.autoDetectSourceLanguages)for(const r of this.autoDetectSourceLanguages.split(",")){var i=r+m.SpeechServiceConnection_EndpointId.toString(),i=this.parameters.getProperty(i,void 0);void 0!==i?(e.push({language:r,endpoint:i}),t=!0):e.push({language:r,endpoint:""})}return t?e:void 0}get maxRetryCount(){return this.privMaxRetryCount}}class Oi{constructor(e){this.context=e}serialize(){return JSON.stringify(this,(e,t)=>{if(t&&"object"==typeof t){var i={};for(const r in t)Object.hasOwnProperty.call(t,r)&&(i[r&&r.charAt(0).toLowerCase()+r.substring(1)]=t[r]);return i}return t})}get Context(){return this.context}get Recognition(){return this.recognition}set Recognition(e){this.recognition=e.toLowerCase()}}class ki{constructor(e){this.system=new xi,this.os=e}}class xi{constructor(){this.name="SpeechSDK",this.version="1.24.0",this.build="JavaScript",this.lang="JavaScript"}}class Di{constructor(e,t,i){this.platform=e,this.name=t,this.version=i}}(C=Ai=Ai||{}).Bluetooth="Bluetooth",C.Wired="Wired",C.WiFi="WiFi",C.Cellular="Cellular",C.InBuilt="InBuilt",C.Unknown="Unknown",(C=Ii=Ii||{}).Phone="Phone",C.Speaker="Speaker",C.Car="Car",C.Headset="Headset",C.Thermostat="Thermostat",C.Microphones="Microphones",C.Deskphone="Deskphone",C.RemoteControl="RemoteControl",C.Unknown="Unknown",C.File="File",C.Stream="Stream";class Bi{toConnectionMessage(i){var r=new d;try{if(i.messageType===p.Text){var n,o=i.textContent;let e={},t=null;o&&(n=o.split("\r\n\r\n"))&&0<n.length&&(e=this.parseHeaders(n[0]),1<n.length)&&(t=n[1]),r.resolve(new ce(i.messageType,t,e,i.id))}else if(i.messageType===p.Binary){var s,a=i.binaryContent;let e=null;if(!a||a.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");var h=new DataView(a),u=h.getInt16(0);if(a.byteLength<u+2)throw new Error("Invalid binary message format. Header content missing.");let t="";for(let e=0;e<u;e++)t+=String.fromCharCode(h.getInt8(e+2));s=this.parseHeaders(t),a.byteLength>u+2&&(e=a.slice(2+u)),r.resolve(new ce(i.messageType,e,s,i.id))}}catch(e){r.reject("Error formatting the message. Error: "+e)}return r.promise}fromConnectionMessage(e){var t,i,r,n,o,s,a,h,u,c=new d;try{e.messageType===p.Text?(t=this.makeHeaders(e)+`\r
`+(e.textBody||""),c.resolve(new ye(p.Text,t,e.id))):e.messageType===p.Binary&&(i=this.makeHeaders(e),r=e.binaryBody,n=this.stringToArrayBuffer(i),s=(o=new Int8Array(n)).byteLength,(a=new Int8Array(2+s+(r?r.byteLength:0)))[0]=s>>8&255,a[1]=255&s,a.set(o,2),r&&(h=new Int8Array(r),a.set(h,2+s)),u=a.buffer,c.resolve(new ye(p.Binary,u,e.id)))}catch(e){c.reject("Error formatting the message. "+e)}return c.promise}makeHeaders(e){let t="";if(e.headers)for(const i in e.headers)i&&(t+=""+i+`: ${e.headers[i]}\r
`);return t}parseHeaders(e){var t={};if(e){var i,r,e=e.match(/[^\r\n]+/g);if(t)for(const n of e)n&&(i=0<(r=n.indexOf(":"))?n.substr(0,r).trim().toLowerCase():n,r=0<r&&n.length>r+1?n.substr(r+1).trim():"",t[i]=r)}return t}stringToArrayBuffer(t){var e=new ArrayBuffer(t.length),i=new DataView(e);for(let e=0;e<t.length;e++)i.setUint8(e,t.charCodeAt(e));return e}}class Li extends pi{constructor(){super(...arguments),this.interactiveRelativeUri="/speech/recognition/interactive/cognitiveservices/v1",this.conversationRelativeUri="/speech/recognition/conversation/cognitiveservices/v1",this.dictationRelativeUri="/speech/recognition/dictation/cognitiveservices/v1",this.universalUri="/speech/universal/v"}create(e,t,i){let r=e.parameters.getProperty(m.SpeechServiceConnection_Endpoint,void 0);var n=e.parameters.getProperty(m.SpeechServiceConnection_Region,void 0),o=pi.getHostSuffix(n),s=e.parameters.getProperty(m.SpeechServiceConnection_Host,"wss://"+n+".stt.speech"+o),n={},o=e.parameters.getProperty(m.SpeechServiceConnection_EndpointId,void 0),a=e.parameters.getProperty(m.SpeechServiceConnection_RecoLanguage,void 0);if(o?r&&-1!==r.search(S.CustomSpeechDeploymentId)||(n[S.CustomSpeechDeploymentId]=o):!a||r&&-1!==r.search(S.Language)||(n[S.Language]=a),r&&-1!==r.search(S.Format)||(n[S.Format]=e.parameters.getProperty(ar,qt[qt.Simple]).toLowerCase()),void 0!==e.autoDetectSourceLanguages&&(n[S.EnableLanguageId]="true"),this.setCommonUrlParams(e,n,r),!r)switch(e.recognitionMode){case Pi.Conversation:r="true"===e.parameters.getProperty(cr,"false")?s+this.dictationRelativeUri:void 0!==e.recognitionEndpointVersion&&1<parseInt(e.recognitionEndpointVersion,10)?""+s+this.universalUri+e.recognitionEndpointVersion:s+this.conversationRelativeUri;break;case Pi.Dictation:r=s+this.dictationRelativeUri;break;default:r=void 0!==e.recognitionEndpointVersion&&1<parseInt(e.recognitionEndpointVersion,10)?""+s+this.universalUri+e.recognitionEndpointVersion:s+this.interactiveRelativeUri}o={},void 0!==t.token&&""!==t.token&&(o[t.headerName]=t.token),o[c.ConnectionId]=i,e.parameters.setProperty(m.SpeechServiceConnection_Url,r),a="true"===e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false");return new nh(r,n,o,new Bi,ah.fromRecognizerConfig(e),a,i)}}class zi{static implTranslateRecognitionResult(e){let t=Ft.Canceled;switch(e){case w.Success:t=Ft.RecognizedSpeech;break;case w.NoMatch:case w.InitialSilenceTimeout:case w.BabbleTimeout:case w.EndOfDictation:t=Ft.NoMatch;break;case w.Error:case w.BadRequest:case w.Forbidden:default:t=Ft.Canceled}return t}static implTranslateCancelResult(e){let t=Ut.EndOfStream;switch(e){case w.Success:case w.EndOfDictation:case w.NoMatch:t=Ut.EndOfStream;break;case w.InitialSilenceTimeout:case w.BabbleTimeout:case w.Error:case w.BadRequest:case w.Forbidden:default:t=Ut.Error}return t}static implTranslateCancelErrorCode(e){let t=y.NoError;switch(e){case w.Error:t=y.ServiceError;break;case w.TooManyRequests:t=y.TooManyRequests;break;case w.BadRequest:t=y.BadRequestParameters;break;case w.Forbidden:t=y.Forbidden;break;default:t=y.NoError}return t}static implTranslateErrorDetails(e){let t="The speech service encountered an internal error and could not continue.";switch(e){case y.Forbidden:t="The recognizer is using a free subscription that ran out of quota.";break;case y.BadRequestParameters:t="Invalid parameter or unsupported audio format in the request.";break;case y.TooManyRequests:t="The number of parallel requests exceeded the number of allowed concurrent transcriptions."}return t}}(C=w=w||{})[C.Success=0]="Success",C[C.NoMatch=1]="NoMatch",C[C.InitialSilenceTimeout=2]="InitialSilenceTimeout",C[C.BabbleTimeout=3]="BabbleTimeout",C[C.Error=4]="Error",C[C.EndOfDictation=5]="EndOfDictation",C[C.TooManyRequests=6]="TooManyRequests",C[C.BadRequest=7]="BadRequest",C[C.Forbidden=8]="Forbidden";class Ni{constructor(e){this.privSpeechStartDetected=JSON.parse(e)}static fromJSON(e){return new Ni(e)}get Offset(){return this.privSpeechStartDetected.Offset}}class Ui{constructor(e){this.privSpeechHypothesis=JSON.parse(e)}static fromJSON(e){return new Ui(e)}get Text(){return this.privSpeechHypothesis.Text}get Offset(){return this.privSpeechHypothesis.Offset}get Duration(){return this.privSpeechHypothesis.Duration}get Language(){return void 0===this.privSpeechHypothesis.PrimaryLanguage?void 0:this.privSpeechHypothesis.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return void 0===this.privSpeechHypothesis.PrimaryLanguage?void 0:this.privSpeechHypothesis.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSpeechHypothesis.SpeakerId}}var qi=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class Fi extends _i{constructor(e,t,i,r,n){super(e,t,i,r,n),this.privSpeechRecognizer=n;var e={},t=r.parameters.getProperty(m.Speech_SegmentationSilenceTimeoutMs,void 0);void 0!==t&&(i=parseInt(t,10),e.mode="INTERACTIVE",e.INTERACTIVE={segmentation:{mode:"Custom",segmentationSilenceTimeoutMs:i}}),void 0!==r.autoDetectSourceLanguages&&(n=r.autoDetectSourceLanguages.split(","),this.privSpeechContext.setSection("languageId",{Priority:r.languageIdPriority,languages:n,mode:r.languageIdMode,onSuccess:{action:"Recognize"},onUnknown:{action:"None"}}),this.privSpeechContext.setSection("phraseOutput",{interimResults:{resultType:"Auto"},phraseResults:{resultType:"Always"}}),void 0!==(t=r.sourceLanguageModels))&&(e.customModels=t,e.onInterim={action:"None"},e.onSuccess={action:"None"});(e=>{for(const t in e)return!1;return!0})(e)||this.privSpeechContext.setSection("phraseDetection",e)}processTypeSpecificMessages(a){return qi(this,void 0,void 0,function*(){let e;var t=new oi;t.setProperty(m.SpeechServiceResponse_JsonResult,a.textBody);let i=!1;switch(a.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":var r=Ui.fromJSON(a.textBody),n=r.Offset+this.privRequestSession.currentTurnAudioOffset,n=(e=new Qt(this.privRequestSession.requestId,Ft.RecognizingSpeech,r.Text,r.Duration,n,r.Language,r.LanguageDetectionConfidence,void 0,void 0,a.textBody,t),this.privRequestSession.onHypothesis(n),new ei(e,r.Duration,this.privRequestSession.sessionId));if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,n)}catch(e){}i=!0;break;case"speech.phrase":r=Ki.fromJSON(a.textBody),n=zi.implTranslateRecognitionResult(r.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(this.privRequestSession.currentTurnAudioOffset+r.Offset+r.Duration),Ft.Canceled===n){var o=zi.implTranslateCancelResult(r.RecognitionStatus),s=zi.implTranslateCancelErrorCode(r.RecognitionStatus);yield this.cancelRecognitionLocal(o,s,zi.implTranslateErrorDetails(s))}else{if(!this.privRequestSession.isSpeechEnded||n!==Ft.NoMatch||r.RecognitionStatus===w.InitialSilenceTimeout){e=this.privRecognizerConfig.parameters.getProperty(ar)===qt[qt.Simple]?new Qt(this.privRequestSession.requestId,n,r.DisplayText,r.Duration,r.Offset+this.privRequestSession.currentTurnAudioOffset,r.Language,r.LanguageDetectionConfidence,void 0,void 0,a.textBody,t):(s=(o=ji.fromJSON(a.textBody)).Offset+this.privRequestSession.currentTurnAudioOffset,r=o.getJsonWithCorrectedOffsets(s),new Qt(this.privRequestSession.requestId,n,o.RecognitionStatus===w.Success?o.NBest[0].Display:void 0,o.Duration,s,o.Language,o.LanguageDetectionConfidence,void 0,void 0,r,t));n=new ei(e,e.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,n)}catch(e){}}if(this.privSuccessCallback){try{this.privSuccessCallback(e)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}i=!0}return i})}cancelRecognition(e,t,i,r,n){var o=new oi;if(o.setProperty(hr,y[r]),this.privSpeechRecognizer.canceled){i=new ii(i,n,r,void 0,e);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,i)}catch(e){}}if(this.privSuccessCallback){r=new Qt(t,Ft.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,n,void 0,o);try{this.privSuccessCallback(r),this.privSuccessCallback=void 0}catch(e){}}}}class ji{constructor(e){this.privDetailedSpeechPhrase=JSON.parse(e),this.privDetailedSpeechPhrase.RecognitionStatus=w[this.privDetailedSpeechPhrase.RecognitionStatus]}static fromJSON(e){return new ji(e)}getJsonWithCorrectedOffsets(t){if(this.privDetailedSpeechPhrase.NBest){let e;for(const r of this.privDetailedSpeechPhrase.NBest)if(r.Words&&r.Words[0]){e=r.Words[0].Offset;break}if(e&&e<t){var i=t-e;for(const n of this.privDetailedSpeechPhrase.NBest)if(n.Words)for(const o of n.Words)o.Offset+=i}}return JSON.stringify(this.privDetailedSpeechPhrase)}get RecognitionStatus(){return this.privDetailedSpeechPhrase.RecognitionStatus}get NBest(){return this.privDetailedSpeechPhrase.NBest}get Duration(){return this.privDetailedSpeechPhrase.Duration}get Offset(){return this.privDetailedSpeechPhrase.Offset}get Language(){return void 0===this.privDetailedSpeechPhrase.PrimaryLanguage?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return void 0===this.privDetailedSpeechPhrase.PrimaryLanguage?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Confidence}get Text(){return this.privDetailedSpeechPhrase.NBest&&this.privDetailedSpeechPhrase.NBest[0]?this.privDetailedSpeechPhrase.NBest[0].Display||this.privDetailedSpeechPhrase.NBest[0].DisplayText:this.privDetailedSpeechPhrase.DisplayText}get SpeakerId(){return this.privDetailedSpeechPhrase.SpeakerId}}class Ki{constructor(e){this.privSimpleSpeechPhrase=JSON.parse(e),this.privSimpleSpeechPhrase.RecognitionStatus=w[this.privSimpleSpeechPhrase.RecognitionStatus]}static fromJSON(e){return new Ki(e)}get RecognitionStatus(){return this.privSimpleSpeechPhrase.RecognitionStatus}get DisplayText(){return this.privSimpleSpeechPhrase.DisplayText}get Offset(){return this.privSimpleSpeechPhrase.Offset}get Duration(){return this.privSimpleSpeechPhrase.Duration}get Language(){return void 0===this.privSimpleSpeechPhrase.PrimaryLanguage?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return void 0===this.privSimpleSpeechPhrase.PrimaryLanguage?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSimpleSpeechPhrase.SpeakerId}}class Hi{constructor(e,t,i){this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privRequestId=e,this.privAudioSourceId=t,this.privAudioNodeId=i,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}phraseReceived(e){0<e&&this.privPhraseLatencies.push(Date.now()-e)}hypothesisReceived(e){0<e&&this.privHypothesisLatencies.push(Date.now()-e)}onEvent(e){this.privIsDisposed||(e instanceof bi&&e.requestId===this.privRequestId&&(this.privListeningTriggerMetric={End:e.eventTime,Name:"ListeningTrigger",Start:e.eventTime}),e instanceof Z&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof $&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof J&&e.audioSourceId===this.privAudioSourceId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof Q&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof X&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Name:"Microphone",Start:this.privMicStartTime})),e instanceof Ri&&e.requestId===this.privRequestId&&(this.privConnectionId=e.sessionId),e instanceof ie&&e.connectionId===this.privConnectionId&&(this.privConnectionStartTime=e.eventTime),e instanceof re&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),!1&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Error:this.getConnectionError(e.statusCode),Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof se&&e.connectionId===this.privConnectionId&&e.message&&e.message.headers&&e.message.headers.path&&(this.privReceivedMessages[e.message.headers.path]||(this.privReceivedMessages[e.message.headers.path]=new Array),this.privReceivedMessages[e.message.headers.path].length<50)&&this.privReceivedMessages[e.message.headers.path].push(e.networkReceivedTime))}getTelemetry(){var e=new Array,e=(this.privListeningTriggerMetric&&e.push(this.privListeningTriggerMetric),this.privMicMetric&&e.push(this.privMicMetric),this.privConnectionEstablishMetric&&e.push(this.privConnectionEstablishMetric),0<this.privPhraseLatencies.length&&e.push({PhraseLatencyMs:this.privPhraseLatencies}),0<this.privHypothesisLatencies.length&&e.push({FirstHypothesisLatencyMs:this.privHypothesisLatencies}),{Metrics:e,ReceivedMessages:this.privReceivedMessages}),e=JSON.stringify(e);return this.privReceivedMessages={},this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privPhraseLatencies=[],this.privHypothesisLatencies=[],e}get hasTelemetry(){return 0!==Object.keys(this.privReceivedMessages).length||null!==this.privListeningTriggerMetric||null!==this.privMicMetric||null!==this.privConnectionEstablishMetric||0!==this.privPhraseLatencies.length||0!==this.privHypothesisLatencies.length}dispose(){this.privIsDisposed=!0}getConnectionError(e){switch(e){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+e.toString()}}}var Wi,Vi=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class Gi{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecogNumber=0,this.privInTurn=!1,this.privConnectionAttempts=0,this.privAudioSourceId=e,this.privRequestId=l(),this.privAudioNodeId=l(),this.privTurnDeferral=new d,this.privTurnDeferral.resolve()}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get audioNodeId(){return this.privAudioNodeId}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSpeechEnded(){return this.privIsSpeechEnded}get isRecognizing(){return this.privIsRecognizing}get currentTurnAudioOffset(){return this.privTurnStartAudioOffset}get recogNumber(){return this.privRecogNumber}get numConnectionAttempts(){return this.privConnectionAttempts}get bytesSent(){return this.privBytesSent}listenForServiceTelemetry(e){this.privServiceTelemetryListener&&this.privDetachables.push(e.attachListener(this.privServiceTelemetryListener))}startNewRecognition(){this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRecogNumber++,this.privServiceTelemetryListener=new Hi(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new bi(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}onAudioSourceAttachCompleted(e,t){return Vi(this,void 0,void 0,function*(){this.privAudioNode=e,this.privIsAudioNodeDetached=!1,t?yield this.onComplete():this.onEvent(new Ci(this.privRequestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))})}onPreConnectionStart(e,t){this.privAuthFetchEventId=e,this.privSessionId=t,this.onEvent(new Ri(this.privRequestId,this.privAuthFetchEventId,this.privSessionId))}onAuthCompleted(e){return Vi(this,void 0,void 0,function*(){e&&(yield this.onComplete())})}onConnectionEstablishCompleted(e,t){return Vi(this,void 0,void 0,function*(){200===e?(this.onEvent(new Mi(this.requestId,this.privAudioSourceId,this.privAudioNodeId,this.privAuthFetchEventId,this.privSessionId)),this.privAudioNode&&this.privAudioNode.replay(),this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privBytesSent=0):403===e&&(yield this.onComplete())})}onServiceTurnEndResponse(e){return Vi(this,void 0,void 0,function*(){this.privTurnDeferral.resolve(),!e||this.isSpeechEnded?(yield this.onComplete(),this.privInTurn=!1):(this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privAudioNode.replay())})}onSpeechContext(){this.privRequestId=l()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new d}onHypothesis(e){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(e)))}onPhraseRecognized(e){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(e)),this.onServiceRecognized(e)}onServiceRecognized(e){this.privLastRecoOffset=e,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(e),this.privConnectionAttempts=0}onAudioSent(e){this.privBytesSent+=e}onRetryConnection(){this.privConnectionAttempts++}dispose(){return Vi(this,void 0,void 0,function*(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(const e of this.privDetachables)yield e.detach();this.privServiceTelemetryListener&&this.privServiceTelemetryListener.dispose(),this.privIsRecognizing=!1}})}getTelemetry(){return this.privServiceTelemetryListener.hasTelemetry?this.privServiceTelemetryListener.getTelemetry():null}onStopRecognizing(){return Vi(this,void 0,void 0,function*(){yield this.onComplete()})}onSpeechEnded(){this.privIsSpeechEnded=!0}onEvent(e){this.privServiceTelemetryListener&&this.privServiceTelemetryListener.onEvent(e),o.instance.onEvent(e)}onComplete(){return Vi(this,void 0,void 0,function*(){this.privIsRecognizing&&(this.privIsRecognizing=!1,yield this.detachAudioNode())})}detachAudioNode(){return Vi(this,void 0,void 0,function*(){this.privIsAudioNodeDetached||(this.privIsAudioNodeDetached=!0,this.privAudioNode&&(yield this.privAudioNode.detach()))})}}class Ji{constructor(e){this.privContext={},this.privDynamicGrammar=e}setSection(e,t){this.privContext[e]=t}setPronunciationAssessmentParams(e){void 0===this.privContext.phraseDetection&&(this.privContext.phraseDetection={enrichment:{pronunciationAssessment:{}}}),this.privContext.phraseDetection.enrichment.pronunciationAssessment=JSON.parse(e),this.setWordLevelTimings(),this.privContext.phraseOutput.detailed.options.push("PronunciationAssessment"),-1===this.privContext.phraseOutput.detailed.options.indexOf("SNR")&&this.privContext.phraseOutput.detailed.options.push("SNR")}setWordLevelTimings(){void 0===this.privContext.phraseOutput&&(this.privContext.phraseOutput={detailed:{options:[]},format:{}}),void 0===this.privContext.phraseOutput.detailed&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format="Detailed",-1===this.privContext.phraseOutput.detailed.options.indexOf("WordTimings")&&this.privContext.phraseOutput.detailed.options.push("WordTimings")}toJSON(){var e=this.privDynamicGrammar.generateGrammarObject(),e=(this.setSection("dgi",e),JSON.stringify(this.privContext));return e}}class Yi{addPhrase(e){this.privPhrases||(this.privPhrases=[]),e instanceof Array?this.privPhrases=this.privPhrases.concat(e):this.privPhrases.push(e)}clearPhrases(){this.privPhrases=void 0}addReferenceGrammar(e){this.privGrammars||(this.privGrammars=[]),e instanceof Array?this.privGrammars=this.privGrammars.concat(e):this.privGrammars.push(e)}clearGrammars(){this.privGrammars=void 0}generateGrammarObject(){if(void 0!==this.privGrammars||void 0!==this.privPhrases){var e={};if(e.ReferenceGrammars=this.privGrammars,void 0!==this.privPhrases&&0!==this.privPhrases.length){const t=[];this.privPhrases.forEach(e=>{t.push({Text:e})}),e.Groups=[{Type:"Generic",Items:t}]}return e}}}class Zi{toJsonString(){return JSON.stringify(this.iPrivConfig)}get(){return this.iPrivConfig}set(e){this.iPrivConfig=e}}(C=Wi=Wi||{}).WordBoundary="WordBoundary",C.Bookmark="Bookmark",C.Viseme="Viseme",C.SentenceBoundary="SentenceBoundary",C.SessionEnd="SessionEnd";class $i{constructor(e){this.privSynthesisAudioMetadata=JSON.parse(e)}static fromJSON(e){return new $i(e)}get Metadata(){return this.privSynthesisAudioMetadata.Metadata}}var Xi=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class Qi{constructor(e,t,i,r,n){if(this.speakOverride=void 0,this.receiveMessageOverride=void 0,this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.privConnectionConfigurationPromise=void 0,!e)throw new f("authentication");if(!t)throw new f("connectionFactory");if(!i)throw new f("synthesizerConfig");this.privAuthentication=e,this.privConnectionFactory=t,this.privSynthesizerConfig=i,this.privIsDisposed=!1,this.privSpeechSynthesizer=r,this.privSessionAudioDestination=n,this.privSynthesisTurn=new or,this.privConnectionEvents=new de,this.privServiceEvents=new de,this.privSynthesisContext=new sr(this.privSpeechSynthesizer),this.privAgentConfig=new Zi,this.connectionEvents.attach(e=>{"ConnectionClosedEvent"===e.name&&1e3!==e.statusCode&&this.cancelSynthesisLocal(Ut.Error,1007===e.statusCode?y.BadRequestParameters:y.ConnectionFailure,e.reason+" websocket error code: "+e.statusCode)})}get synthesisContext(){return this.privSynthesisContext}get agentConfig(){return this.privAgentConfig}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}set activityTemplate(e){this.privActivityTemplate=e}get activityTemplate(){return this.privActivityTemplate}set audioOutputFormat(e){this.privAudioOutputFormat=e,this.privSynthesisTurn.audioOutputFormat=e,void 0!==this.privSessionAudioDestination&&(this.privSessionAudioDestination.format=e),void 0!==this.synthesisContext&&(this.synthesisContext.audioOutputFormat=e)}static addHeader(e,t){if(!t.hasHeader)return e;t.updateHeader(e.byteLength);var i=new Uint8Array(e.byteLength+t.header.byteLength);return i.set(new Uint8Array(t.header),0),i.set(new Uint8Array(e),t.header.byteLength),i.buffer}isDisposed(){return this.privIsDisposed}dispose(e){return Xi(this,void 0,void 0,function*(){this.privIsDisposed=!0,void 0!==this.privSessionAudioDestination&&this.privSessionAudioDestination.close(),void 0!==this.privConnectionConfigurationPromise&&(yield(yield this.privConnectionConfigurationPromise).dispose(e))})}connect(){return Xi(this,void 0,void 0,function*(){yield this.connectImpl()})}sendNetworkMessage(i,r){return Xi(this,void 0,void 0,function*(){var e="string"==typeof r?p.Text:p.Binary,t="string"==typeof r?"application/json":"";return(yield this.fetchConnection()).send(new Ei(e,i,this.privSynthesisTurn.requestId,t,r))})}Speak(r,n,o,s,a,h){return Xi(this,void 0,void 0,function*(){let e;if(e=n?r:this.privSpeechSynthesizer.buildSsml(r),void 0!==this.speakOverride)return this.speakOverride(e,o,s,a);this.privSuccessCallback=s,this.privErrorCallback=a,this.privSynthesisTurn.startNewSynthesis(o,r,n,h);try{yield this.connectImpl();var t=yield this.fetchConnection(),i=(yield this.sendSynthesisContext(t),yield this.sendSsmlMessage(t,e,o),new li(new di(o,Ft.SynthesizingAudioStarted)));this.privSpeechSynthesizer.synthesisStarted&&this.privSpeechSynthesizer.synthesisStarted(this.privSpeechSynthesizer,i),this.receiveMessage()}catch(e){return this.cancelSynthesisLocal(Ut.Error,y.ConnectionFailure,e),Promise.reject(e)}})}cancelSynthesis(e,t,i,r){var n=new oi,i=(n.setProperty(hr,y[i]),new di(e,Ft.Canceled,void 0,r,n));if(this.privSpeechSynthesizer.SynthesisCanceled){e=new li(i);try{this.privSpeechSynthesizer.SynthesisCanceled(this.privSpeechSynthesizer,e)}catch(e){}}if(this.privSuccessCallback)try{this.privSuccessCallback(i)}catch(e){}}cancelSynthesisLocal(e,t,i){this.privSynthesisTurn.isSynthesizing&&(this.privSynthesisTurn.onStopSynthesizing(),this.cancelSynthesis(this.privSynthesisTurn.requestId,e,t,i))}processTypeSpecificMessages(e){return!0}receiveMessage(){return Xi(this,void 0,void 0,function*(){try{var e=yield(yield this.fetchConnection()).read();if(void 0!==this.receiveMessageOverride)return this.receiveMessageOverride();if(!this.privIsDisposed){if(!e)return this.privSynthesisTurn.isSynthesizing?this.receiveMessage():void 0;var t=Ei.fromConnectionMessage(e);if(t.requestId.toLowerCase()===this.privSynthesisTurn.requestId.toLowerCase())switch(t.path.toLowerCase()){case"turn.start":this.privSynthesisTurn.onServiceTurnStartResponse();break;case"response":this.privSynthesisTurn.onServiceResponseMessage(t.textBody);break;case"audio":if(this.privSynthesisTurn.streamId.toLowerCase()===t.streamId.toLowerCase()&&t.binaryBody){if(this.privSynthesisTurn.onAudioChunkReceived(t.binaryBody),this.privSpeechSynthesizer.synthesizing)try{var i=Qi.addHeader(t.binaryBody,this.privSynthesisTurn.audioOutputFormat),r=new li(new di(this.privSynthesisTurn.requestId,Ft.SynthesizingAudio,i));this.privSpeechSynthesizer.synthesizing(this.privSpeechSynthesizer,r)}catch(e){}void 0!==this.privSessionAudioDestination&&this.privSessionAudioDestination.write(t.binaryBody)}break;case"audio.metadata":for(const h of $i.fromJSON(t.textBody).Metadata)switch(h.Type){case Wi.WordBoundary:case Wi.SentenceBoundary:this.privSynthesisTurn.onTextBoundaryEvent(h);var n=new fi(h.Data.Offset,h.Data.Duration,h.Data.text.Text,h.Data.text.Length,h.Type===Wi.WordBoundary?this.privSynthesisTurn.currentTextOffset:this.privSynthesisTurn.currentSentenceOffset,h.Data.text.BoundaryType);if(this.privSpeechSynthesizer.wordBoundary)try{this.privSpeechSynthesizer.wordBoundary(this.privSpeechSynthesizer,n)}catch(e){}break;case Wi.Bookmark:var o=new vi(h.Data.Offset,h.Data.Bookmark);if(this.privSpeechSynthesizer.bookmarkReached)try{this.privSpeechSynthesizer.bookmarkReached(this.privSpeechSynthesizer,o)}catch(e){}break;case Wi.Viseme:if(this.privSynthesisTurn.onVisemeMetadataReceived(h),h.Data.IsLastAnimation){var s=new gi(h.Data.Offset,h.Data.VisemeId,this.privSynthesisTurn.getAndClearVisemeAnimation());if(this.privSpeechSynthesizer.visemeReceived)try{this.privSpeechSynthesizer.visemeReceived(this.privSpeechSynthesizer,s)}catch(e){}}break;case Wi.SessionEnd:this.privSynthesisTurn.onSessionEnd(h)}break;case"turn.end":this.privSynthesisTurn.onServiceTurnEndResponse();let e;try{var a=yield this.privSynthesisTurn.getAllReceivedAudioWithHeader();e=new di(this.privSynthesisTurn.requestId,Ft.SynthesizingAudioCompleted,a,void 0,void 0,this.privSynthesisTurn.audioDuration),this.privSuccessCallback&&this.privSuccessCallback(e)}catch(e){this.privErrorCallback&&this.privErrorCallback(e)}if(this.privSpeechSynthesizer.synthesisCompleted)try{this.privSpeechSynthesizer.synthesisCompleted(this.privSpeechSynthesizer,new li(e))}catch(e){}break;default:this.processTypeSpecificMessages(t)||this.privServiceEvents&&this.serviceEvents.onEvent(new ee(t.path.toLowerCase(),t.textBody))}return this.receiveMessage()}}catch(e){}})}sendSynthesisContext(e){var t=this.synthesisContext.toJSON();if(t)return e.send(new Ei(p.Text,"synthesis.context",this.privSynthesisTurn.requestId,"application/json",t))}connectImpl(r=!1){if(null!=this.privConnectionPromise)return this.privConnectionPromise.then(e=>e.state()===s.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()));this.privAuthFetchEventId=l(),this.privConnectionId=l(),this.privSynthesisTurn.onPreConnectionStart(this.privAuthFetchEventId);var e=r?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);return this.privConnectionPromise=e.then(i=>Xi(this,void 0,void 0,function*(){this.privSynthesisTurn.onAuthCompleted(!1);var e=this.privConnectionFactory.create(this.privSynthesizerConfig,i,this.privConnectionId),t=(e.events.attach(e=>{this.connectionEvents.onEvent(e)}),yield e.open());return 200===t.statusCode?(this.privSynthesisTurn.onConnectionEstablishCompleted(t.statusCode),Promise.resolve(e)):403!==t.statusCode||r?(this.privSynthesisTurn.onConnectionEstablishCompleted(t.statusCode),Promise.reject(`Unable to contact server. StatusCode: ${t.statusCode}, ${this.privSynthesizerConfig.parameters.getProperty(m.SpeechServiceConnection_Endpoint)} Reason: `+t.reason)):this.connectImpl(!0)}),e=>{throw this.privSynthesisTurn.onAuthCompleted(!0),new Error(e)}),this.privConnectionPromise.catch(()=>{}),this.privConnectionPromise}sendSpeechServiceConfig(e,t){if(t)return e.send(new Ei(p.Text,"speech.config",this.privSynthesisTurn.requestId,"application/json",t))}sendSsmlMessage(e,t,i){return e.send(new Ei(p.Text,"ssml",i,"application/ssml+xml",t))}fetchConnection(){return Xi(this,void 0,void 0,function*(){return void 0!==this.privConnectionConfigurationPromise?this.privConnectionConfigurationPromise.then(e=>e.state()===s.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),yield this.privConnectionConfigurationPromise)})}configureConnection(){return Xi(this,void 0,void 0,function*(){var e=yield this.connectImpl();return void 0!==this.configConnectionOverride?this.configConnectionOverride(e):(yield this.sendSpeechServiceConfig(e,this.privSynthesizerConfig.SpeechServiceConfig.serialize()),e)})}}Qi.telemetryDataEnabled=!0;class er extends K{constructor(e,t,i=n.Info){super(e,i),this.privRequestId=t}get requestId(){return this.privRequestId}}class tr extends er{constructor(e,t,i){super("SynthesisTriggeredEvent",e),this.privSessionAudioDestinationId=t,this.privTurnAudioDestinationId=i}get audioSessionDestinationId(){return this.privSessionAudioDestinationId}get audioTurnDestinationId(){return this.privTurnAudioDestinationId}}class ir extends er{constructor(e,t){super("ConnectingToSynthesisServiceEvent",e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}}class rr extends er{constructor(e,t){super("SynthesisStartedEvent",e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}}var nr=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class or{constructor(){this.privIsDisposed=!1,this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!1,this.privBytesReceived=0,this.privInTurn=!1,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privRequestId=l(),this.privTurnDeferral=new d,this.privTurnDeferral.resolve()}get requestId(){return this.privRequestId}get streamId(){return this.privStreamId}set streamId(e){this.privStreamId=e}get audioOutputFormat(){return this.privAudioOutputFormat}set audioOutputFormat(e){this.privAudioOutputFormat=e}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSynthesisEnded(){return this.privIsSynthesisEnded}get isSynthesizing(){return this.privIsSynthesizing}get currentTextOffset(){return this.privTextOffset}get currentSentenceOffset(){return this.privSentenceOffset}get bytesReceived(){return this.privBytesReceived}get audioDuration(){return this.privAudioDuration}getAllReceivedAudio(){return nr(this,void 0,void 0,function*(){if(!this.privReceivedAudio){if(!this.privIsSynthesisEnded)return null;yield this.readAllAudioFromStream()}return Promise.resolve(this.privReceivedAudio)})}getAllReceivedAudioWithHeader(){return nr(this,void 0,void 0,function*(){var e;return this.privReceivedAudioWithHeader||(this.privIsSynthesisEnded?this.audioOutputFormat.hasHeader?(e=yield this.getAllReceivedAudio(),this.privReceivedAudioWithHeader=Qi.addHeader(e,this.audioOutputFormat),this.privReceivedAudioWithHeader):this.getAllReceivedAudio():null)})}startNewSynthesis(e,t,i,r){this.privIsSynthesisEnded=!1,this.privIsSynthesizing=!0,this.privRequestId=e,this.privRawText=t,this.privIsSSML=i,this.privAudioOutputStream=new Wt,this.privAudioOutputStream.format=this.privAudioOutputFormat,this.privReceivedAudio=null,this.privReceivedAudioWithHeader=null,this.privBytesReceived=0,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privPartialVisemeAnimation="",void 0!==r&&(this.privTurnAudioDestination=r,this.privTurnAudioDestination.format=this.privAudioOutputFormat),this.onEvent(new tr(this.requestId,void 0,void 0===r?void 0:r.id()))}onPreConnectionStart(e){this.privAuthFetchEventId=e,this.onEvent(new ir(this.privRequestId,this.privAuthFetchEventId))}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){200===e?(this.onEvent(new rr(this.requestId,this.privAuthFetchEventId)),this.privBytesReceived=0):403===e&&this.onComplete()}onServiceResponseMessage(e){e=JSON.parse(e);this.streamId=e.audio.streamId}onServiceTurnEndResponse(){this.privInTurn=!1,this.privTurnDeferral.resolve(),this.onComplete()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new d}onAudioChunkReceived(e){this.isSynthesizing&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength,void 0!==this.privTurnAudioDestination)&&this.privTurnAudioDestination.write(e)}onTextBoundaryEvent(e){this.updateTextOffset(e.Data.text.Text,e.Type)}onVisemeMetadataReceived(e){void 0!==e.Data.AnimationChunk&&(this.privPartialVisemeAnimation+=e.Data.AnimationChunk)}onSessionEnd(e){this.privAudioDuration=e.Data.Offset}dispose(){this.privIsDisposed||(this.privIsDisposed=!0)}onStopSynthesizing(){this.onComplete()}getAndClearVisemeAnimation(){var e=this.privPartialVisemeAnimation;return this.privPartialVisemeAnimation="",e}onEvent(e){o.instance.onEvent(e)}static isXmlTag(e){return 2<=e.length&&"<"===e[0]&&">"===e[e.length-1]}updateTextOffset(e,t){t===Wi.WordBoundary?(this.privTextOffset=this.privRawText.indexOf(e,this.privNextSearchTextIndex),0<=this.privTextOffset&&(this.privNextSearchTextIndex=this.privTextOffset+e.length,this.privIsSSML)&&this.withinXmlTag(this.privTextOffset)&&!or.isXmlTag(e)&&this.updateTextOffset(e,t)):(this.privSentenceOffset=this.privRawText.indexOf(e,this.privNextSearchSentenceIndex),0<=this.privSentenceOffset&&(this.privNextSearchSentenceIndex=this.privSentenceOffset+e.length,this.privIsSSML)&&this.withinXmlTag(this.privSentenceOffset)&&!or.isXmlTag(e)&&this.updateTextOffset(e,t))}onComplete(){this.privIsSynthesizing&&(this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!0,this.privAudioOutputStream.close(),this.privInTurn=!1,void 0!==this.privTurnAudioDestination)&&(this.privTurnAudioDestination.close(),this.privTurnAudioDestination=void 0)}readAllAudioFromStream(){return nr(this,void 0,void 0,function*(){if(this.privIsSynthesisEnded){this.privReceivedAudio=new ArrayBuffer(this.bytesReceived);try{yield this.privAudioOutputStream.read(this.privReceivedAudio)}catch(e){this.privReceivedAudio=new ArrayBuffer(0)}}})}withinXmlTag(e){return this.privRawText.indexOf("<",e+1)>this.privRawText.indexOf(">",e+1)}}class sr{constructor(e){this.privContext={},this.privSpeechSynthesizer=e}setSection(e,t){this.privContext[e]=t}set audioOutputFormat(e){this.privAudioOutputFormat=e}toJSON(){var e=this.buildSynthesisContext();return this.setSection("synthesis",e),JSON.stringify(this.privContext)}buildSynthesisContext(){return{audio:{metadataOptions:{bookmarkEnabled:!!this.privSpeechSynthesizer.bookmarkReached,punctuationBoundaryEnabled:this.privSpeechSynthesizer.properties.getProperty(m.SpeechServiceResponse_RequestPunctuationBoundary,!!this.privSpeechSynthesizer.wordBoundary),sentenceBoundaryEnabled:this.privSpeechSynthesizer.properties.getProperty(m.SpeechServiceResponse_RequestSentenceBoundary,!1),sessionEndEnabled:!0,visemeEnabled:!!this.privSpeechSynthesizer.visemeReceived,wordBoundaryEnabled:this.privSpeechSynthesizer.properties.getProperty(m.SpeechServiceResponse_RequestWordBoundary,!!this.privSpeechSynthesizer.wordBoundary)},outputFormat:this.privAudioOutputFormat.requestAudioFormatString},language:{autoDetection:this.privSpeechSynthesizer.autoDetectSourceLanguage}}}}const ar="OutputFormat",hr="CancellationErrorCode",ur="ServiceProperties",cr="ForceDictation";var pr=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class dr{constructor(e,t,i,r){this.privRecorder=e,this.deviceId=t,this.privStreams={},this.privOutputChunkSize=dr.AUDIOFORMAT.avgBytesPerSec/10,this.privId=i||l(),this.privEvents=new de,this.privMediaStream=r||null,this.privIsClosing=!1}get format(){return Promise.resolve(dr.AUDIOFORMAT)}get blob(){return Promise.reject("Not implemented for Mic input")}turnOn(){if(!this.privInitializeDeferral){this.privInitializeDeferral=new d;try{this.createAudioContext()}catch(e){return e instanceof Error?this.privInitializeDeferral.reject(e.name+": "+e.message):this.privInitializeDeferral.reject(e),this.privInitializeDeferral.promise}const r=window.navigator;let e=r.getUserMedia||r.webkitGetUserMedia||r.mozGetUserMedia||r.msGetUserMedia;var t;(e=r.mediaDevices?(e,t,i)=>{r.mediaDevices.getUserMedia(e).then(t).catch(i)}:e)?(t=()=>{this.onEvent(new W(this.privId)),this.privMediaStream&&this.privMediaStream.active?(this.onEvent(new V(this.privId)),this.privInitializeDeferral.resolve()):e({audio:!this.deviceId||{deviceId:this.deviceId},video:!1},e=>{this.privMediaStream=e,this.onEvent(new V(this.privId)),this.privInitializeDeferral.resolve()},e=>{e="Error occurred during microphone initialization: "+e;this.privInitializeDeferral.reject(e),this.onEvent(new J(this.privId,e))})},"suspended"===this.privContext.state?this.privContext.resume().then(t).catch(e=>{this.privInitializeDeferral.reject("Failed to initialize audio context: "+e)}):t()):(this.privInitializeDeferral.reject(t="Browser does not support getUserMedia."),this.onEvent(new J(t,"")))}return this.privInitializeDeferral.promise}id(){return this.privId}attach(t){return this.onEvent(new Z(this.privId,t)),this.listen(t).then(e=>(this.onEvent(new $(this.privId,t)),{detach:()=>pr(this,void 0,void 0,function*(){return e.readEnded(),delete this.privStreams[t],this.onEvent(new X(this.privId,t)),this.turnOff()}),id:()=>t,read:()=>e.read()}))}detach(e){e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new X(this.privId,e)))}turnOff(){return pr(this,void 0,void 0,function*(){for(const t in this.privStreams){var e;t&&(e=this.privStreams[t])&&e.close()}this.onEvent(new G(this.privId)),this.privInitializeDeferral&&(yield this.privInitializeDeferral,this.privInitializeDeferral=null),yield this.destroyAudioContext()})}get events(){return this.privEvents}get deviceInfo(){return this.getMicrophoneLabel().then(e=>({bitspersample:dr.AUDIOFORMAT.bitsPerSample,channelcount:dr.AUDIOFORMAT.channels,connectivity:Ai.Unknown,manufacturer:"Speech SDK",model:e,samplerate:dr.AUDIOFORMAT.samplesPerSec,type:Ii.Microphones}))}setProperty(e,t){if("MICROPHONE-WorkletSourceUrl"!==e)throw new Error("Property '"+e+"' is not supported on Microphone.");this.privRecorder.setWorkletUrl(t)}getMicrophoneLabel(){var e="microphone";if(void 0!==this.privMicrophoneLabel)return Promise.resolve(this.privMicrophoneLabel);if(void 0===this.privMediaStream||!this.privMediaStream.active)return Promise.resolve(e);this.privMicrophoneLabel=e;const i=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(void 0===i)return Promise.resolve(this.privMicrophoneLabel);const r=new d;return navigator.mediaDevices.enumerateDevices().then(e=>{for(const t of e)if(t.deviceId===i){this.privMicrophoneLabel=t.label;break}r.resolve(this.privMicrophoneLabel)},()=>r.resolve(this.privMicrophoneLabel)),r.promise}listen(t){return pr(this,void 0,void 0,function*(){yield this.turnOn();var e=new Ce(this.privOutputChunkSize,t);this.privStreams[t]=e;try{this.privRecorder.record(this.privContext,this.privMediaStream,e)}catch(e){throw this.onEvent(new Q(this.privId,t,e)),e}return e})}onEvent(e){this.privEvents.onEvent(e),o.instance.onEvent(e)}createAudioContext(){this.privContext||(this.privContext=kt.getAudioContext(dr.AUDIOFORMAT.samplesPerSec))}destroyAudioContext(){return pr(this,void 0,void 0,function*(){if(this.privContext){this.privRecorder.releaseMediaResources(this.privContext);let e=!1;(e="close"in this.privContext?!0:e)?this.privIsClosing||(this.privIsClosing=!0,yield this.privContext.close(),this.privContext=null,this.privIsClosing=!1):null!==this.privContext&&"running"===this.privContext.state&&(yield this.privContext.suspend())}})}}dr.AUDIOFORMAT=Ot.getDefaultInputFormat();var lr=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class fr{constructor(e,t,i){this.privStreams={},this.privHeaderEnd=44,this.privId=i||l(),this.privEvents=new de,this.privSource=e,"undefined"!=typeof window&&"undefined"!=typeof Blob&&this.privSource instanceof Blob?this.privFilename=e.name:this.privFilename=t||"unknown.wav",this.privAudioFormatPromise=this.readHeader()}get format(){return this.privAudioFormatPromise}get blob(){return Promise.resolve(this.privSource)}turnOn(){var e;if(this.privFilename.lastIndexOf(".wav")!==this.privFilename.length-4)return e=this.privFilename+" is not supported. Only WAVE files are allowed at the moment.",this.onEvent(new J(e,"")),Promise.reject(e);this.onEvent(new W(this.privId)),this.onEvent(new V(this.privId))}id(){return this.privId}attach(t){return lr(this,void 0,void 0,function*(){this.onEvent(new Z(this.privId,t));const e=yield this.upload(t);return this.onEvent(new $(this.privId,t)),Promise.resolve({detach:()=>lr(this,void 0,void 0,function*(){e.readEnded(),delete this.privStreams[t],this.onEvent(new X(this.privId,t)),yield this.turnOff()}),id:()=>t,read:()=>e.read()})})}detach(e){e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new X(this.privId,e)))}turnOff(){for(const t in this.privStreams){var e;t&&(e=this.privStreams[t])&&!e.isClosed&&e.close()}return this.onEvent(new G(this.privId)),Promise.resolve()}get events(){return this.privEvents}get deviceInfo(){return this.privAudioFormatPromise.then(e=>Promise.resolve({bitspersample:e.bitsPerSample,channelcount:e.channels,connectivity:Ai.Unknown,manufacturer:"Speech SDK",model:"File",samplerate:e.samplesPerSec,type:Ii.File}))}readHeader(){const a=512;var e,t=this.privSource.slice(0,a);const h=new d,i=t=>{const i=new DataView(t);var r=e=>String.fromCharCode(i.getUint8(e),i.getUint8(e+1),i.getUint8(e+2),i.getUint8(e+3));if("RIFF"!==r(0))h.reject("Invalid WAV header in file, RIFF was not found");else if("WAVE"!==r(8)||"fmt "!==r(12))h.reject("Invalid WAV header in file, WAVEfmt was not found");else{var t=i.getInt32(16,!0),n=i.getUint16(22,!0),o=i.getUint32(24,!0),s=i.getUint16(34,!0);let e=36+Math.max(t-16,0);for(;"data"!==r(e);e+=2)if(e>a-8)return void h.reject("Invalid WAV header in file, data block was not found");this.privHeaderEnd=e+8,h.resolve(Ot.getWaveFormatPCM(o,s,n))}};return"undefined"!=typeof window&&"undefined"!=typeof Blob&&t instanceof Blob?((e=new FileReader).onload=e=>{e=e.target.result;i(e)},e.readAsArrayBuffer(t)):i(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)),h.promise}upload(a){return lr(this,void 0,void 0,function*(){const t=e=>{e=`Error occurred while processing '${this.privFilename}'. `+e;throw this.onEvent(new Q(this.privId,a,e)),new Error(e)};try{yield this.turnOn();var e=yield this.privAudioFormatPromise;const o=new Ce(e.avgBytesPerSec/10,a);this.privStreams[a]=o;var i,r,n=this.privSource.slice(this.privHeaderEnd);const s=e=>{o.isClosed||(o.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()}),o.close())};return"undefined"!=typeof window&&"undefined"!=typeof Blob&&n instanceof Blob?((i=new FileReader).onerror=e=>t(e.toString()),i.onload=e=>{e=e.target.result;s(e)},i.readAsArrayBuffer(n)):(r=n,s(r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength))),o}catch(e){t(e)}})}onEvent(e){this.privEvents.onEvent(e),o.instance.onEvent(e)}}class vr{constructor(e){this.privStopInputOnRelease=e}record(r,t,i){const n=16e3,o=new Se(r.sampleRate,n),s=r.createMediaStreamSource(t),e=()=>{var e=(()=>{let i=0;try{return r.createScriptProcessor(i,1,1)}catch(e){i=2048;let t=r.sampleRate;for(;i<16384&&t>=2*n;)i<<=1,t>>=1;return r.createScriptProcessor(i,1,1)}})();e.onaudioprocess=e=>{var e=e.inputBuffer.getChannelData(0);i&&!i.isClosed&&(e=o.encode(e))&&i.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})},s.connect(e),e.connect(r.destination),this.privMediaResources={scriptProcessorNode:e,source:s,stream:t}};var a;if(r.audioWorklet)this.privSpeechProcessorScript||(a=new Blob([`class SP extends AudioWorkletProcessor {
                    constructor(options) {
                      super(options);
                    }
                    process(inputs, outputs) {
                      const input = inputs[0];
                      const output = [];
                      for (let channel = 0; channel < input.length; channel += 1) {
                        output[channel] = input[channel];
                      }
                      this.port.postMessage(output[0]);
                      return true;
                    }
                  }
                  registerProcessor('speech-processor', SP);`],{type:"application/javascript; charset=utf-8"}),this.privSpeechProcessorScript=URL.createObjectURL(a)),r.audioWorklet.addModule(this.privSpeechProcessorScript).then(()=>{var e=new AudioWorkletNode(r,"speech-processor");e.port.onmessage=e=>{var e=e.data;i&&!i.isClosed&&(e=o.encode(e))&&i.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})},s.connect(e),e.connect(r.destination),this.privMediaResources={scriptProcessorNode:e,source:s,stream:t}}).catch(()=>{e()});else try{e()}catch(e){throw new Error("Unable to start audio worklet node for PCMRecorder: "+e)}}releaseMediaResources(e){this.privMediaResources&&(this.privMediaResources.scriptProcessorNode&&(this.privMediaResources.scriptProcessorNode.disconnect(e.destination),this.privMediaResources.scriptProcessorNode=null),this.privMediaResources.source)&&(this.privMediaResources.source.disconnect(),this.privStopInputOnRelease&&this.privMediaResources.stream.getTracks().forEach(e=>e.stop()),this.privMediaResources.source=null)}setWorkletUrl(e){this.privSpeechProcessorScript=e}}var gr={},C=Object.freeze({__proto__:null,default:gr});function mr(){throw new Error("setTimeout has not been defined")}function yr(){throw new Error("clearTimeout has not been defined")}var Sr=mr,wr=yr;function br(t){if(Sr===setTimeout)return setTimeout(t,0);if((Sr===mr||!Sr)&&setTimeout)return(Sr=setTimeout)(t,0);try{return Sr(t,0)}catch(e){try{return Sr.call(null,t,0)}catch(e){return Sr.call(this,t,0)}}}"function"==typeof a.setTimeout&&(Sr=setTimeout),"function"==typeof a.clearTimeout&&(wr=clearTimeout);var Cr,Rr=[],Mr=!1,Er=-1;function Pr(){Mr&&Cr&&(Mr=!1,Cr.length?Rr=Cr.concat(Rr):Er=-1,Rr.length)&&Ar()}function Ar(){if(!Mr){for(var e=br(Pr),t=(Mr=!0,Rr.length);t;){for(Cr=Rr,Rr=[];++Er<t;)Cr&&Cr[Er].run();Er=-1,t=Rr.length}Cr=null,Mr=!1,!function(t){if(wr===clearTimeout)return clearTimeout(t);if((wr===yr||!wr)&&clearTimeout)return(wr=clearTimeout)(t);try{wr(t)}catch(e){try{return wr.call(null,t)}catch(e){return wr.call(this,t)}}}(e)}}function Ir(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];Rr.push(new _r(e,t)),1!==Rr.length||Mr||br(Ar)}function _r(e,t){this.fun=e,this.array=t}_r.prototype.run=function(){this.fun.apply(null,this.array)};function Tr(){}var R=Tr,M=Tr,E=Tr,Or=Tr,kr=Tr,xr=Tr,Dr=Tr;var Br=a.performance||{},Lr=Br.now||Br.mozNow||Br.msNow||Br.oNow||Br.webkitNow||function(){return(new Date).getTime()};var zr=new Date;var Nr={nextTick:Ir,title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:R,addListener:M,once:E,off:Or,removeListener:kr,removeAllListeners:xr,emit:Dr,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*Lr.call(Br),i=Math.floor(t),t=Math.floor(t%1*1e9);return e&&(i-=e[0],(t-=e[1])<0)&&(i--,t+=1e9),[i,t]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-zr)/1e3}},R="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ur(i){var r,e=i.default;return"function"==typeof e?(r=function(){return e.apply(this,arguments)}).prototype=e.prototype:r={},Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(i).forEach(function(e){var t=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(r,e,t.get?t:{enumerable:!0,get:function(){return i[e]}})}),r}var qr,Fr,jr={};var M="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e},Kr=/%[sdj%]/g;function Hr(e){if(!an(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(Yr(arguments[i]));return t.join(" ")}for(var i=1,r=arguments,n=r.length,o=String(e).replace(Kr,function(e){if("%%"===e)return"%";if(n<=i)return e;switch(e){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch(e){return"[Circular]"}default:return e}}),s=r[i];i<n;s=r[++i])nn(s)||!pn(s)?o+=" "+s:o+=" "+Yr(s);return o}function Wr(e,t){var i;return un(a.process)?function(){return Wr(e,t).apply(this,arguments)}:!0===Nr.noDeprecation?e:(i=!1,function(){if(!i){if(Nr.throwDeprecation)throw new Error(t);Nr.traceDeprecation?console.trace(t):console.error(t),i=!0}return e.apply(this,arguments)})}var Vr,Gr={};function Jr(t){return un(Vr)&&(Vr=Nr.env.NODE_DEBUG||""),t=t.toUpperCase(),Gr[t]||(new RegExp("\\b"+t+"\\b","i").test(Vr)?Gr[t]=function(){var e=Hr.apply(null,arguments);console.error("%s %d: %s",t,0,e)}:Gr[t]=function(){}),Gr[t]}function Yr(e,t){var i={seen:[],stylize:$r};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),rn(t)?i.showHidden=t:t&&bn(i,t),un(i.showHidden)&&(i.showHidden=!1),un(i.depth)&&(i.depth=2),un(i.colors)&&(i.colors=!1),un(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=Zr),Xr(i,e,i.depth)}function Zr(e,t){t=Yr.styles[t];return t?"["+Yr.colors[t][0]+"m"+e+"["+Yr.colors[t][1]+"m":e}function $r(e,t){return e}function Xr(t,i,r){if(t.customInspect&&i&&fn(i.inspect)&&i.inspect!==Yr&&(!i.constructor||i.constructor.prototype!==i))return an(e=i.inspect(r,t))?e:Xr(t,e,r);var e=function(e,t){if(un(t))return e.stylize("undefined","undefined");{var i;if(an(t))return i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",e.stylize(i,"string")}return sn(t)?e.stylize(""+t,"number"):rn(t)?e.stylize(""+t,"boolean"):nn(t)?e.stylize("null","null"):void 0}(t,i);if(e)return e;var n,e=Object.keys(i),o=(n={},e.forEach(function(e,t){n[e]=!0}),n);if(t.showHidden&&(e=Object.getOwnPropertyNames(i)),ln(i)&&(0<=e.indexOf("message")||0<=e.indexOf("description")))return Qr(i);if(0===e.length){if(fn(i))return s=i.name?": "+i.name:"",t.stylize("[Function"+s+"]","special");if(cn(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(dn(i))return t.stylize(Date.prototype.toString.call(i),"date");if(ln(i))return Qr(i)}var s="",a=!1,h=["{","}"];if(tn(i)&&(a=!0,h=["[","]"]),fn(i)&&(s=" [Function"+(i.name?": "+i.name:"")+"]"),cn(i)&&(s=" "+RegExp.prototype.toString.call(i)),dn(i)&&(s=" "+Date.prototype.toUTCString.call(i)),ln(i)&&(s=" "+Qr(i)),0===e.length&&(!a||0==i.length))return h[0]+s+h[1];if(r<0)return cn(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special");t.seen.push(i),u=a?function(t,i,r,n,e){for(var o=[],s=0,a=i.length;s<a;++s)Cn(i,String(s))?o.push(en(t,i,r,n,String(s),!0)):o.push("");return e.forEach(function(e){e.match(/^\d+$/)||o.push(en(t,i,r,n,e,!0))}),o}(t,i,r,o,e):e.map(function(e){return en(t,i,r,o,e,a)}),t.seen.pop();var u;return 60<u.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)?h[0]+(""===s?"":s+"\n ")+" "+u.join(",\n  ")+" "+h[1]:h[0]+s+" "+u.join(", ")+" "+h[1]}function Qr(e){return"["+Error.prototype.toString.call(e)+"]"}function en(e,t,i,r,n,o){var s,a,t=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]};if(t.get?a=t.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):t.set&&(a=e.stylize("[Setter]","special")),Cn(r,n)||(s="["+n+"]"),a||(e.seen.indexOf(t.value)<0?-1<(a=nn(i)?Xr(e,t.value,null):Xr(e,t.value,i-1)).indexOf("\n")&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),un(s)){if(o&&n.match(/^\d+$/))return a;s=(s=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(s,"string"))}return s+": "+a}function tn(e){return Array.isArray(e)}function rn(e){return"boolean"==typeof e}function nn(e){return null===e}function on(e){return null==e}function sn(e){return"number"==typeof e}function an(e){return"string"==typeof e}function hn(e){return"symbol"==typeof e}function un(e){return void 0===e}function cn(e){return pn(e)&&"[object RegExp]"===mn(e)}function pn(e){return"object"==typeof e&&null!==e}function dn(e){return pn(e)&&"[object Date]"===mn(e)}function ln(e){return pn(e)&&("[object Error]"===mn(e)||e instanceof Error)}function fn(e){return"function"==typeof e}function vn(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function gn(e){return v.isBuffer(e)}function mn(e){return Object.prototype.toString.call(e)}function yn(e){return e<10?"0"+e.toString(10):e.toString(10)}Yr.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Yr.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var Sn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function wn(){var e,t;console.log("%s - %s",(e=new Date,t=[yn(e.getHours()),yn(e.getMinutes()),yn(e.getSeconds())].join(":"),[e.getDate(),Sn[e.getMonth()],t].join(" ")),Hr.apply(null,arguments))}function bn(e,t){if(t&&pn(t))for(var i=Object.keys(t),r=i.length;r--;)e[i[r]]=t[i[r]];return e}function Cn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Rn,Mn,En=Ur(Object.freeze({__proto__:null,format:Hr,deprecate:Wr,debuglog:Jr,inspect:Yr,isArray:tn,isBoolean:rn,isNull:nn,isNullOrUndefined:on,isNumber:sn,isString:an,isSymbol:hn,isUndefined:un,isRegExp:cn,isObject:pn,isDate:dn,isError:ln,isFunction:fn,isPrimitive:vn,isBuffer:gn,log:wn,inherits:M,_extend:bn,default:{inherits:M,_extend:bn,log:wn,isBuffer:gn,isPrimitive:vn,isFunction:fn,isError:ln,isDate:dn,isObject:pn,isRegExp:cn,isUndefined:un,isSymbol:hn,isString:an,isNumber:sn,isNullOrUndefined:on,isNull:nn,isBoolean:rn,isArray:tn,inspect:Yr,deprecate:Wr,format:Hr,debuglog:Jr}})),Pn=xn(a.fetch)&&xn(a.ReadableStream);function An(e){Mn||(Mn=new a.XMLHttpRequest).open("GET",a.location.host?"/":"https://example.com");try{return Mn.responseType=e,Mn.responseType===e}catch(e){return!1}}var E=void 0!==a.ArrayBuffer,Or=E&&xn(a.ArrayBuffer.prototype.slice),In=E&&An("arraybuffer"),_n=!Pn&&Or&&An("ms-stream"),Tn=!Pn&&E&&An("moz-chunked-arraybuffer"),On=xn(Mn.overrideMimeType),kn=xn(a.VBArray);function xn(e){return"function"==typeof e}function Dn(){}function P(){P.init.call(this)}function Bn(e){return void 0===e._maxListeners?P.defaultMaxListeners:e._maxListeners}function Ln(e,t,i,r){var n,o;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');return(n=e._events)?(n.newListener&&(e.emit("newListener",t,i.listener||i),n=e._events),o=n[t]):(n=e._events=new Dn,e._eventsCount=0),o?("function"==typeof o?o=n[t]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),o.warned||(r=Bn(e))&&0<r&&o.length>r&&(o.warned=!0,(r=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",r.emitter=e,r.type=t,r.count=o.length,r=r,"function"==typeof console.warn?console.warn(r):console.log(r))):(o=n[t]=i,++e._eventsCount),e}function zn(e,t,i){var r=!1;function n(){e.removeListener(t,n),r||(r=!0,i.apply(e,arguments))}return n.listener=i,n}function Nn(e){var t=this._events;if(t){t=t[e];if("function"==typeof t)return 1;if(t)return t.length}return 0}function Un(e,t){for(var i=new Array(t);t--;)i[t]=e[t];return i}function qn(){this.head=null,this.tail=null,this.length=0}Mn=null,Dn.prototype=Object.create(null),(P.EventEmitter=P).usingDomains=!1,P.prototype.domain=void 0,P.prototype._events=void 0,P.prototype._maxListeners=void 0,P.defaultMaxListeners=10,P.init=function(){this.domain=null,P.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Dn,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},P.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},P.prototype.getMaxListeners=function(){return Bn(this)},P.prototype.emit=function(e){var t,i,r,n="error"===e,o=this._events;if(o)n=n&&null==o.error;else if(!n)return!1;if(s=this.domain,n){var s,n=arguments[1];if(s)return(n=n||new Error('Uncaught, unspecified "error" event')).domainEmitter=this,n.domain=s,n.domainThrown=!1,s.emit("error",n),!1;throw n instanceof Error?n:((s=new Error('Uncaught, unspecified "error" event. ('+n+")")).context=n,s)}if(!(t=o[e]))return!1;var a,h="function"==typeof t;switch(a=arguments.length){case 1:var u=t,c=h,p=this;if(c)u.call(p);else for(var d=u.length,B=Un(u,d),l=0;l<d;++l)B[l].call(p);break;case 2:var c=t,u=h,f=this,v=arguments[1];if(u)c.call(f,v);else for(var g=c.length,L=Un(c,g),m=0;m<g;++m)L[m].call(f,v);break;case 3:var y=t,S=h,w=this,b=arguments[1],C=arguments[2];if(S)y.call(w,b,C);else for(var R=y.length,z=Un(y,R),M=0;M<R;++M)z[M].call(w,b,C);break;case 4:var S=t,y=h,E=this,P=arguments[1],A=arguments[2],I=arguments[3];if(y)S.call(E,P,A,I);else for(var _=S.length,N=Un(S,_),T=0;T<_;++T)N[T].call(E,P,A,I);break;default:for(i=new Array(a-1),r=1;r<a;r++)i[r-1]=arguments[r];var O=t,U=h,k=this,x=i;if(U)O.apply(k,x);else for(var q=O.length,F=Un(O,q),D=0;D<q;++D)F[D].apply(k,x)}return!0},P.prototype.on=P.prototype.addListener=function(e,t){return Ln(this,e,t,!1)},P.prototype.prependListener=function(e,t){return Ln(this,e,t,!0)},P.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,zn(this,e,t)),this},P.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,zn(this,e,t)),this},P.prototype.removeListener=function(e,t){var i,r,n,o,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if((r=this._events)&&(i=r[e]))if(i===t||i.listener&&i.listener===t)0==--this._eventsCount?this._events=new Dn:(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,o=i.length;0<o--;)if(i[o]===t||i[o].listener&&i[o].listener===t){s=i[o].listener,n=o;break}if(n<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new Dn,this;delete r[e]}else{for(var a=i,h=n,u=h+1,c=a.length;u<c;h+=1,u+=1)a[h]=a[u];a.pop()}r.removeListener&&this.emit("removeListener",e,s||t)}return this},P.prototype.off=function(e,t){return this.removeListener(e,t)},P.prototype.removeAllListeners=function(e){var t,i=this._events;if(i)if(i.removeListener){if(0===arguments.length){for(var r,n=Object.keys(i),o=0;o<n.length;++o)"removeListener"!==(r=n[o])&&this.removeAllListeners(r);this.removeAllListeners("removeListener"),this._events=new Dn,this._eventsCount=0}else if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(t)for(;this.removeListener(e,t[t.length-1]),t[0];);}else 0===arguments.length?(this._events=new Dn,this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=new Dn:delete i[e]);return this},P.prototype.listeners=function(e){var t=this._events,e=t&&(t=t[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(t):[];return e},P.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Nn.call(e,t)},P.prototype.listenerCount=Nn,P.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]},qn.prototype.push=function(e){e={data:e,next:null};0<this.length?this.tail.next=e:this.head=e,this.tail=e,++this.length},qn.prototype.unshift=function(e){e={data:e,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},qn.prototype.shift=function(){var e;if(0!==this.length)return e=this.head.data,1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e},qn.prototype.clear=function(){this.head=this.tail=null,this.length=0},qn.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i},qn.prototype.concat=function(e){if(0===this.length)return v.alloc(0);if(1===this.length)return this.head.data;for(var t=v.allocUnsafe(e>>>0),i=this.head,r=0;i;)i.data.copy(t,r),r+=i.data.length,i=i.next;return t};var Fn=v.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function jn(e){this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,"");if(e&&!Fn(e))throw new Error("Unknown encoding: "+e);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=Hn;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=Wn;break;default:return void(this.write=Kn)}this.charBuffer=new v(6),this.charReceived=0,this.charLength=0}function Kn(e){return e.toString(this.encoding)}function Hn(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function Wn(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}jn.prototype.write=function(e){for(var t="";this.charLength;){var i=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,i),this.charReceived+=i,this.charReceived<this.charLength)return"";if(e=e.slice(i,e.length),!(55296<=(r=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))&&r<=56319)){if((this.charReceived=this.charLength=0)===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var r,n,o=e.length,o=(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,o),o-=this.charReceived),(t+=e.toString(this.encoding,0,o)).length-1);return 55296<=(r=t.charCodeAt(o))&&r<=56319?(n=this.surrogateSize,this.charLength+=n,this.charReceived+=n,this.charBuffer.copy(this.charBuffer,n,0,n),e.copy(this.charBuffer,0,0,n),t.substring(0,o)):t},jn.prototype.detectIncompleteChar=function(e){for(var t=3<=e.length?3:e.length;0<t;t--){var i=e[e.length-t];if(1==t&&i>>5==6){this.charLength=2;break}if(t<=2&&i>>4==14){this.charLength=3;break}if(t<=3&&i>>3==30){this.charLength=4;break}}this.charReceived=t},jn.prototype.end=function(e){var t,i,r="";return e&&e.length&&(r=this.write(e)),this.charReceived&&(e=this.charReceived,t=this.charBuffer,i=this.encoding,r+=t.slice(0,e).toString(i)),r},I.ReadableState=Vn;var A=Jr("stream");function Vn(e,t){this.objectMode=!!(e=e||{}).objectMode,t instanceof wo&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var t=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=t||0===t?t:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new qn,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new jn(e.encoding),this.encoding=e.encoding)}function I(e){if(!(this instanceof I))return new I(e);this._readableState=new Vn(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),P.call(this)}function Gn(e,t,i,r,n){var o,s,a,h=function(e,t){var i=null;v.isBuffer(t)||"string"==typeof t||null==t||e.objectMode||(i=new TypeError("Invalid non-string/buffer chunk"));return i}(t,i);return h?e.emit("error",h):null===i?(t.reading=!1,h=e,(o=t).ended||(o.decoder&&(s=o.decoder.end())&&s.length&&(o.buffer.push(s),o.length+=o.objectMode?1:s.length),o.ended=!0,Zn(h))):t.objectMode||i&&0<i.length?t.ended&&!n?(s=new Error("stream.push() after EOF"),e.emit("error",s)):t.endEmitted&&n?(o=new Error("stream.unshift() after end event"),e.emit("error",o)):(!t.decoder||n||r||(i=t.decoder.write(i),a=!t.objectMode&&0===i.length),n||(t.reading=!1),a||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",i),e.read(0)):(t.length+=t.objectMode?1:i.length,n?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&Zn(e))),h=e,(r=t).readingMore||(r.readingMore=!0,Ir(Xn,h,r))):n||(t.reading=!1),!(a=t).ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}M(I,P),I.prototype.push=function(e,t){var i=this._readableState;return i.objectMode||"string"!=typeof e||(t=t||i.defaultEncoding)!==i.encoding&&(e=v.from(e,t),t=""),Gn(this,i,e,t,!1)},I.prototype.unshift=function(e){return Gn(this,this._readableState,e,"",!0)},I.prototype.isPaused=function(){return!1===this._readableState.flowing},I.prototype.setEncoding=function(e){return this._readableState.decoder=new jn(e),this._readableState.encoding=e,this};var Jn=8388608;function Yn(e,t){var i;return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?(t.flowing&&t.length?t.buffer.head.data:t).length:(e>t.highWaterMark&&(t.highWaterMark=(Jn<=(i=e)?i=Jn:(i--,i=(i=(i=(i=(i|=i>>>1)|i>>>2)|i>>>4)|i>>>8)|i>>>16,i++),i)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function Zn(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(A("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?Ir($n,e):$n(e))}function $n(e){A("emit readable"),e.emit("readable"),to(e)}function Xn(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(A("maybeReadMore read 0"),e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}function Qn(e){A("readable nexttick read 0"),e.read(0)}function eo(e,t){t.reading||(A("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),to(e),t.flowing&&!t.reading&&e.read(0)}function to(e){var t=e._readableState;for(A("flow",t.flowing);t.flowing&&null!==e.read(););}function io(e,t){var i;return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):i=function(e,t,i){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():(i?function(e,t){var i=t.head,r=1,n=i.data;e-=n.length;for(;i=i.next;){var o=i.data,s=e>o.length?o.length:e;if(s===o.length?n+=o:n+=o.slice(0,e),0===(e-=s)){s===o.length?(++r,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i).data=o.slice(s);break}++r}return t.length-=r,n}:function(e,t){var i=v.allocUnsafe(e),r=t.head,n=1;r.data.copy(i),e-=r.data.length;for(;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(i,i.length-e,0,s),0===(e-=s)){s===o.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r).data=o.slice(s);break}++n}return t.length-=n,i})(e,t);return r}(e,t.buffer,t.decoder),i)}function ro(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,Ir(no,t,e))}function no(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function oo(e,t){for(var i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1}function so(){}function ao(e,t,i){this.chunk=e,this.encoding=t,this.callback=i,this.next=null}function ho(e,c){Object.defineProperty(this,"buffer",{get:Wr(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),this.objectMode=!!(e=e||{}).objectMode,c instanceof wo&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var t=e.highWaterMark,i=this.objectMode?16:16384,t=(this.highWaterMark=t||0===t?t:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,(this.finished=!1)===e.decodeStrings);this.decodeStrings=!t,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){e=e,i=(t=c)._writableState,r=i.sync,n=i.writecb;var t,i,r,n,o=i;{var s,a,h,u;(o.writing=!1,o.writecb=null,o.length-=o.writelen,o.writelen=0,e)?(o=t,a=r,h=e,u=n,--i.pendingcb,a?Ir(u,h):u(h),o._writableState.errorEmitted=!0,o.emit("error",h)):((e=lo(i))||i.corked||i.bufferProcessing||!i.bufferedRequest||po(t,i),r?Ir(co,t,i,e,n):co(t,i,e,n))}},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new go(this)}function _(e){if(!(this instanceof _||this instanceof wo))return new _(e);this._writableState=new ho(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev)&&(this._writev=e.writev),P.call(this)}function uo(e,t,i,r,n,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,i?e._writev(n,t.onwrite):e._write(n,o,t.onwrite),t.sync=!1}function co(e,t,i,r){var n;i||(i=e,0===(n=t).length&&n.needDrain&&(n.needDrain=!1,i.emit("drain"))),t.pendingcb--,r(),vo(e,t)}function po(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){for(var r=t.bufferedRequestCount,n=new Array(r),r=t.corkedRequestsFree,o=(r.entry=i,0);i;)i=(n[o]=i).next,o+=1;uo(e,t,!0,t.length,n,"",r.finish),t.pendingcb++,t.lastBufferedRequest=null,r.next?(t.corkedRequestsFree=r.next,r.next=null):t.corkedRequestsFree=new go(t)}else{for(;i;){var s=i.chunk,a=i.encoding,h=i.callback;if(uo(e,t,!1,t.objectMode?1:s.length,s,a,h),i=i.next,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=i,t.bufferProcessing=!1}function lo(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function fo(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function vo(e,t){var i=lo(t);i&&(0===t.pendingcb?(fo(e,t),t.finished=!0,e.emit("finish")):fo(e,t))}function go(r){var n=this;this.next=null,this.entry=null,this.finish=function(e){var t=n.entry;for(n.entry=null;t;){var i=t.callback;r.pendingcb--,i(e),t=t.next}r.corkedRequestsFree?r.corkedRequestsFree.next=n:r.corkedRequestsFree=n}}I.prototype.read=function(e){A("read",e),e=parseInt(e,10);var t,i=this._readableState,r=e;return 0!==e&&(i.emittedReadable=!1),0===e&&i.needReadable&&(i.length>=i.highWaterMark||i.ended)?(A("read: emitReadable",i.length,i.ended),(0===i.length&&i.ended?ro:Zn)(this),null):0===(e=Yn(e,i))&&i.ended?(0===i.length&&ro(this),null):(t=i.needReadable,A("need readable",t),(0===i.length||i.length-e<i.highWaterMark)&&A("length less than watermark",t=!0),i.ended||i.reading?A("reading or ended",t=!1):t&&(A("do read"),i.reading=!0,i.sync=!0,0===i.length&&(i.needReadable=!0),this._read(i.highWaterMark),i.sync=!1,i.reading||(e=Yn(r,i))),null===(t=0<e?io(e,i):null)?(i.needReadable=!0,e=0):i.length-=e,0===i.length&&(i.ended||(i.needReadable=!0),r!==e)&&i.ended&&ro(this),null!==t&&this.emit("data",t),t)},I.prototype._read=function(e){this.emit("error",new Error("not implemented"))},I.prototype.pipe=function(i,e){var t=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=i;break;case 1:r.pipes=[r.pipes,i];break;default:r.pipes.push(i)}r.pipesCount+=1,A("pipe count=%d opts=%j",r.pipesCount,e);e=!e||!1!==e.end?o:u;function n(e){A("onunpipe"),e===t&&u()}function o(){A("onend"),i.end()}r.endEmitted?Ir(e):t.once("end",e),i.on("unpipe",n);s=t;var s,a=function(){var e=s._readableState;A("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&s.listeners("data").length&&(e.flowing=!0,to(s))},h=(i.on("drain",a),!1);function u(){A("cleanup"),i.removeListener("close",v),i.removeListener("finish",g),i.removeListener("drain",a),i.removeListener("error",f),i.removeListener("unpipe",n),t.removeListener("end",o),t.removeListener("end",u),t.removeListener("data",l),h=!0,!r.awaitDrain||i._writableState&&!i._writableState.needDrain||a()}var c,p,d=!1;function l(e){A("ondata"),(d=!1)!==i.write(e)||d||((1===r.pipesCount&&r.pipes===i||1<r.pipesCount&&-1!==oo(r.pipes,i))&&!h&&(A("false write response, pause",t._readableState.awaitDrain),t._readableState.awaitDrain++,d=!0),t.pause())}function f(e){var t;A("onerror",e),m(),i.removeListener("error",f),0===(t="error",i.listeners(t).length)&&i.emit("error",e)}function v(){i.removeListener("finish",g),m()}function g(){A("onfinish"),i.removeListener("close",v),m()}function m(){A("unpipe"),t.unpipe(i)}return t.on("data",l),e="error",p=f,"function"==typeof(c=i).prependListener?c.prependListener(e,p):c._events&&c._events[e]?Array.isArray(c._events[e])?c._events[e].unshift(p):c._events[e]=[p,c._events[e]]:c.on(e,p),i.once("close",v),i.once("finish",g),i.emit("pipe",t),r.flowing||(A("pipe resume"),t.resume()),i},I.prototype.unpipe=function(e){var t=this._readableState;if(0!==t.pipesCount)if(1===t.pipesCount)e&&e!==t.pipes||(e=e||t.pipes,t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this));else if(e){var i=oo(t.pipes,e);-1!==i&&(t.pipes.splice(i,1),--t.pipesCount,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this))}else{var r=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<n;o++)r[o].emit("unpipe",this)}return this},I.prototype.addListener=I.prototype.on=function(e,t){t=P.prototype.on.call(this,e,t);return"data"===e?!1!==this._readableState.flowing&&this.resume():"readable"!==e||(e=this._readableState).endEmitted||e.readableListening||(e.readableListening=e.needReadable=!0,e.emittedReadable=!1,e.reading?e.length&&Zn(this):Ir(Qn,this)),t},I.prototype.resume=function(){var e,t=this._readableState;return t.flowing||(A("resume"),t.flowing=!0,e=this,(t=t).resumeScheduled)||(t.resumeScheduled=!0,Ir(eo,e,t)),this},I.prototype.pause=function(){return A("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(A("pause"),this._readableState.flowing=!1,this.emit("pause")),this},I.prototype.wrap=function(t){var e,i=this._readableState,r=!1,n=this;for(e in t.on("end",function(){var e;A("wrapped end"),i.decoder&&!i.ended&&(e=i.decoder.end())&&e.length&&n.push(e),n.push(null)}),t.on("data",function(e){A("wrapped data"),i.decoder&&(e=i.decoder.write(e)),i.objectMode&&null==e||(i.objectMode||e&&e.length)&&!n.push(e)&&(r=!0,t.pause())}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var o=["error","close","destroy","pause","resume"],s=function(e){t.on(e,n.emit.bind(n,e))},a=0,h=o.length;a<h;a++)s(o[a],a);return n._read=function(e){A("wrapped _read",e),r&&(r=!1,t.resume())},n},I._fromList=io,_.WritableState=ho,M(_,P),ho.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},_.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},_.prototype.write=function(e,t,i){var r,n,o,s,a,h,u=this._writableState,c=!1;return"function"==typeof t&&(i=t,t=null),t=v.isBuffer(e)?"buffer":t||u.defaultEncoding,"function"!=typeof i&&(i=so),u.ended?(s=this,a=i,h=new Error("write after end"),s.emit("error",h),Ir(a,h)):(s=this,a=u,h=i,o=!(n=!0),null===(r=e)?o=new TypeError("May not write null values to stream"):v.isBuffer(r)||"string"==typeof r||void 0===r||a.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(s.emit("error",o),Ir(h,o),n=!1),n&&(u.pendingcb++,c=function(e,t,i,r,n){i=function(e,t,i){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=v.from(t,i));return t}(t,i,r),v.isBuffer(i)&&(r="buffer");var o=t.objectMode?1:i.length,s=(t.length+=o,t.length<t.highWaterMark);s||(t.needDrain=!0);{var a;t.writing||t.corked?(a=t.lastBufferedRequest,t.lastBufferedRequest=new ao(i,r,n),a?a.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1):uo(e,t,!1,o,i,r,n)}return s}(this,u,e,t,i))),c},_.prototype.cork=function(){this._writableState.corked++},_.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||po(this,e))},_.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase()))return this._writableState.defaultEncoding=e,this;throw new TypeError("Unknown encoding: "+e)},_.prototype._write=function(e,t,i){i(new Error("not implemented"))},_.prototype._writev=null,_.prototype.end=function(e,t,i){var r=this._writableState;"function"==typeof e?(i=e,t=e=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||(e=this,t=i,(i=r).ending=!0,vo(e,i),t&&(i.finished?Ir(t):e.once("finish",t)),i.ended=!0,e.writable=!1)},M(wo,I);for(var mo=Object.keys(_.prototype),yo=0;yo<mo.length;yo++){var So=mo[yo];wo.prototype[So]||(wo.prototype[So]=_.prototype[So])}function wo(e){if(!(this instanceof wo))return new wo(e);I.call(this,e),_.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",bo)}function bo(){this.allowHalfOpen||this._writableState.ended||Ir(Co,this)}function Co(e){e.end()}function Ro(o){this.afterTransform=function(e,t){var i=o,r=i._transformState,n=(r.transforming=!1,r.writecb);if(!n)return i.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,(r.writecb=null)!=t&&i.push(t),n(e),(r=i._readableState).reading=!1,(r.needReadable||r.length<r.highWaterMark)&&i._read(r.highWaterMark)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function Mo(e){if(!(this instanceof Mo))return new Mo(e);wo.call(this,e),this._transformState=new Ro(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush)&&(this._flush=e.flush),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e){Eo(t,e)}):Eo(t)})}function Eo(e,t){if(t)return e.emit("error",t);var t=e._writableState,i=e._transformState;if(t.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");e.push(null)}function Po(e){if(!(this instanceof Po))return new Po(e);Mo.call(this,e)}function Ao(){P.call(this)}M(Mo,wo),Mo.prototype.push=function(e,t){return this._transformState.needTransform=!1,wo.prototype.push.call(this,e,t)},Mo.prototype._transform=function(e,t,i){throw new Error("Not implemented")},Mo.prototype._write=function(e,t,i){var r=this._transformState;r.writecb=i,r.writechunk=e,r.writeencoding=t,!r.transforming&&(i=this._readableState,r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)},Mo.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},M(Po,Mo),Po.prototype._transform=function(e,t,i){i(null,e)},M(Ao,P),Ao.Readable=I,Ao.Writable=_,Ao.Duplex=wo,Ao.Transform=Mo,Ao.PassThrough=Po,(Ao.Stream=Ao).prototype.pipe=function(t,e){var i=this;function r(e){t.writable&&!1===t.write(e)&&i.pause&&i.pause()}function n(){i.readable&&i.resume&&i.resume()}i.on("data",r),t.on("drain",n),t._isStdio||e&&!1===e.end||(i.on("end",s),i.on("close",a));var o=!1;function s(){o||(o=!0,t.end())}function a(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function h(e){if(u(),0===P.listenerCount(this,"error"))throw e}function u(){i.removeListener("data",r),t.removeListener("drain",n),i.removeListener("end",s),i.removeListener("close",a),i.removeListener("error",h),t.removeListener("error",h),i.removeListener("end",u),i.removeListener("close",u),t.removeListener("close",u)}return i.on("error",h),t.on("error",h),i.on("end",u),i.on("close",u),t.on("close",u),t.emit("pipe",i),t};var Io=3,_o=4;function To(e,t,i){var r=this;if(I.call(r),r._mode=i,r.headers={},r.rawHeaders=[],r.trailers={},r.rawTrailers=[],r.on("end",function(){Nr.nextTick(function(){r.emit("close")})}),"fetch"===i){r._fetchResponse=t,r.url=t.url,r.statusCode=t.status,r.statusMessage=t.statusText;for(var n,o,s=t.headers[Symbol.iterator]();n=(o=s.next()).value,!o.done;)r.headers[n[0].toLowerCase()]=n[1],r.rawHeaders.push(n[0],n[1]);var a,h=t.body.getReader();(a=function(){h.read().then(function(e){r._destroyed||(e.done?r.push(null):(r.push(new v(e.value)),a()))})})()}else r._xhr=e,r._pos=0,r.url=e.responseURL,r.statusCode=e.status,r.statusMessage=e.statusText,e.getAllResponseHeaders().split(/\r?\n/).forEach(function(e){var t,e=e.match(/^([^:]+):\s*(.*)/);e&&("set-cookie"===(t=e[1].toLowerCase())?(void 0===r.headers[t]&&(r.headers[t]=[]),r.headers[t].push(e[2])):void 0!==r.headers[t]?r.headers[t]+=", "+e[2]:r.headers[t]=e[2],r.rawHeaders.push(e[1],e[2]))}),r._charset="x-user-defined",On||((i=r.rawHeaders["mime-type"])&&(t=i.match(/;\s*charset=([^;])(;|$)/))&&(r._charset=t[1].toLowerCase()),r._charset)||(r._charset="utf-8")}function T(t){var e,i=this,r=(_.call(i),i._opts=t,i._body=[],i._headers={},t.auth&&i.setHeader("Authorization","Basic "+new v(t.auth).toString("base64")),Object.keys(t.headers).forEach(function(e){i.setHeader(e,t.headers[e])}),!0);if("disable-fetch"===t.mode)e=!(r=!1);else if("prefer-streaming"===t.mode)e=!1;else if("allow-wrong-content-type"===t.mode)e=!On;else{if(t.mode&&"default"!==t.mode&&"prefer-fast"!==t.mode)throw new Error("Invalid value for opts.mode");e=!0}i._mode=(e=e,r=r,Pn&&r?"fetch":Tn?"moz-chunked-arraybuffer":_n?"ms-stream":In&&e?"arraybuffer":kn&&e?"text:vbarray":"text"),i.on("finish",function(){i._onFinish()})}M(To,I),To.prototype._read=function(){},To.prototype._onXHRProgress=function(){var t=this,e=t._xhr,i=null;switch(t._mode){case"text:vbarray":if(e.readyState!==_o)break;try{i=new a.VBArray(e.responseBody).toArray()}catch(e){}if(null!==i){t.push(new v(i));break}case"text":try{i=e.responseText}catch(e){t._mode="text:vbarray";break}if(i.length>t._pos){var r=i.substr(t._pos);if("x-user-defined"===t._charset){for(var n=new v(r.length),o=0;o<r.length;o++)n[o]=255&r.charCodeAt(o);t.push(n)}else t.push(r,t._charset);t._pos=i.length}break;case"arraybuffer":e.readyState===_o&&e.response&&(i=e.response,t.push(new v(new Uint8Array(i))));break;case"moz-chunked-arraybuffer":i=e.response,e.readyState===Io&&i&&t.push(new v(new Uint8Array(i)));break;case"ms-stream":var s,i=e.response;e.readyState===Io&&((s=new a.MSStreamReader).onprogress=function(){s.result.byteLength>t._pos&&(t.push(new v(new Uint8Array(s.result.slice(t._pos)))),t._pos=s.result.byteLength)},s.onload=function(){t.push(null)},s.readAsArrayBuffer(i))}t._xhr.readyState===_o&&"ms-stream"!==t._mode&&t.push(null)},M(T,_);var Oo=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];T.prototype.setHeader=function(e,t){var i=e.toLowerCase();-1===Oo.indexOf(i)&&(this._headers[i]={name:e,value:t})},T.prototype.getHeader=function(e){return this._headers[e.toLowerCase()].value},T.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},T.prototype._onFinish=function(){var t=this;if(!t._destroyed){var e,i=t._opts,r=t._headers;if("POST"!==i.method&&"PUT"!==i.method&&"PATCH"!==i.method||(e=function(){if(void 0===Rn)try{new a.Blob([new ArrayBuffer(1)]),Rn=!0}catch(e){Rn=!1}return Rn}()?new a.Blob(t._body.map(function(e){var t=e;if(t instanceof Uint8Array){if(0===t.byteOffset&&t.byteLength===t.buffer.byteLength)return t.buffer;if("function"==typeof t.buffer.slice)return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}if(_t(t)){for(var i=new Uint8Array(t.length),r=t.length,n=0;n<r;n++)i[n]=t[n];return i.buffer}throw new Error("Argument must be a Buffer")}),{type:(r["content-type"]||{}).value||""}):v.concat(t._body).toString()),"fetch"===t._mode){var n=Object.keys(r).map(function(e){return[r[e].name,r[e].value]});a.fetch(t._opts.url,{method:t._opts.method,headers:n,body:e,mode:"cors",credentials:i.withCredentials?"include":"same-origin"}).then(function(e){t._fetchResponse=e,t._connect()},function(e){t.emit("error",e)})}else{var o=t._xhr=new a.XMLHttpRequest;try{o.open(t._opts.method,t._opts.url,!0)}catch(e){return void Nr.nextTick(function(){t.emit("error",e)})}"responseType"in o&&(o.responseType=t._mode.split(":")[0]),"withCredentials"in o&&(o.withCredentials=!!i.withCredentials),"text"===t._mode&&"overrideMimeType"in o&&o.overrideMimeType("text/plain; charset=x-user-defined"),Object.keys(r).forEach(function(e){o.setRequestHeader(r[e].name,r[e].value)}),t._response=null,o.onreadystatechange=function(){switch(o.readyState){case Io:case _o:t._onXHRProgress()}},"moz-chunked-arraybuffer"===t._mode&&(o.onprogress=function(){t._onXHRProgress()}),o.onerror=function(){t._destroyed||t.emit("error",new Error("XHR error"))};try{o.send(e)}catch(e){Nr.nextTick(function(){t.emit("error",e)})}}}},T.prototype._onXHRProgress=function(){var e=this;!function(e){try{var t=e.status;return null!==t&&0!==t}catch(e){}}(e._xhr)||e._destroyed||(e._response||e._connect(),e._response._onXHRProgress())},T.prototype._connect=function(){var e=this;e._destroyed||(e._response=new To(e._xhr,e._fetchResponse,e._mode),e.emit("response",e._response))},T.prototype._write=function(e,t,i){this._body.push(e),i()},T.prototype.abort=T.prototype.destroy=function(){var e=this;e._destroyed=!0,e._response&&(e._response._destroyed=!0),e._xhr&&e._xhr.abort()},T.prototype.end=function(e,t,i){"function"==typeof e&&(i=e,e=void 0),_.prototype.end.call(this,e,t,i)},T.prototype.flushHeaders=function(){},T.prototype.setTimeout=function(){},T.prototype.setNoDelay=function(){},T.prototype.setSocketKeepAlive=function(){};var ko=2147483647,xo=/[^\x20-\x7E]/,Do=/[\x2E\u3002\uFF0E\uFF61]/g,Bo={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Lo=Math.floor,zo=String.fromCharCode;function No(e){throw new RangeError(Bo[e])}function Uo(e,t){var i=e.split("@"),r="",i=(1<i.length&&(r=i[0]+"@",e=i[1]),(e=e.replace(Do,".")).split("."));return r+function(e,t){for(var i=e.length,r=[];i--;)r[i]=t(e[i]);return r}(i,t).join(".")}function qo(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function Fo(e){for(var t,i,r,n,o,s,a,h,u,c,p=[],d=(e=function(e){for(var t,i,r=[],n=0,o=e.length;n<o;)55296<=(t=e.charCodeAt(n++))&&t<=56319&&n<o?56320==(64512&(i=e.charCodeAt(n++)))?r.push(((1023&t)<<10)+(1023&i)+65536):(r.push(t),n--):r.push(t);return r}(e)).length,l=128,f=72,v=t=0;v<d;++v)(a=e[v])<128&&p.push(zo(a));for(i=r=p.length,r&&p.push("-");i<d;){for(n=ko,v=0;v<d;++v)l<=(a=e[v])&&a<n&&(n=a);for(n-l>Lo((ko-t)/(h=i+1))&&No("overflow"),t+=(n-l)*h,l=n,v=0;v<d;++v)if((a=e[v])<l&&++t>ko&&No("overflow"),a==l){for(o=t,s=36;!(o<(u=s<=f?1:f+26<=s?26:s-f));s+=36)p.push(zo(qo(u+(c=o-u)%(u=36-u),0))),o=Lo(c/u);p.push(zo(qo(o,0))),f=function(e,t,i){var r=0;for(e=i?Lo(e/700):e>>1,e+=Lo(e/t);455<e;r+=36)e=Lo(e/35);return Lo(r+36*e/(e+38))}(t,h,i==r),t=0,++i}++t,++l}return p.join("")}var jo=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function Ko(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function Ho(e,t){if(e.map)return e.map(t);for(var i=[],r=0;r<e.length;r++)i.push(t(e[r],r));return i}var Wo=Object.keys||function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i};function Vo(e,t,i,r){t=t||"&",i=i||"=";var n={};if("string"==typeof e&&0!==e.length){var o=/\+/g,t=(e=e.split(t),1e3),s=(r&&"number"==typeof r.maxKeys&&(t=r.maxKeys),e.length);0<t&&t<s&&(s=t);for(var a=0;a<s;++a){var h,u=e[a].replace(o,"%20"),c=u.indexOf(i),c=0<=c?(h=u.substr(0,c),u.substr(c+1)):(h=u,""),u=decodeURIComponent(h),c=decodeURIComponent(c);Object.prototype.hasOwnProperty.call(n,u)?jo(n[u])?n[u].push(c):n[u]=[n[u],c]:n[u]=c}}return n}kr={parse:ss,resolve:ps,resolveObject:ds,fileURLToPath:hs,format:us,Url:Go};function Go(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Jo=/^([a-z0-9.+-]+:)/i,Yo=/:[0-9]*$/,Zo=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,xr=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),$o=["'"].concat(xr),Xo=["%","/","?",";","#"].concat($o),Qo=["/","?","#"],es=255,ts=/^[+a-z0-9A-Z_-]{0,63}$/,is=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,rs={javascript:!0,"javascript:":!0},ns={javascript:!0,"javascript:":!0},os={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function ss(e,t,i){var r;return e&&pn(e)&&e instanceof Go?e:((r=new Go).parse(e,t,i),r)}function as(e,t,i,r){if(!an(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),n=-1!==n&&n<t.indexOf("#")?"?":"#",o=t.split(n);o[0]=o[0].replace(/\\/g,"/");var s=(s=t=o.join(n)).trim();if(!r&&1===t.split("#").length){o=Zo.exec(s);if(o)return e.path=s,e.href=s,e.pathname=o[1],o[2]?(e.search=o[2],e.query=i?Vo(e.search.substr(1)):e.search.substr(1)):i&&(e.search="",e.query={}),e}var a,h,n=Jo.exec(s);if(n&&(a=(n=n[0]).toLowerCase(),e.protocol=a,s=s.substr(n.length)),!(r||n||s.match(/^\/\/[^@\/]+@[^@\/]+/))||!(b="//"===s.substr(0,2))||n&&ns[n]||(s=s.substr(2),e.slashes=!0),!ns[n]&&(b||n&&!os[n])){var u=-1;for(p=0;p<Qo.length;p++)-1!==(h=s.indexOf(Qo[p]))&&(-1===u||h<u)&&(u=h);for(-1!==(t=-1===u?s.lastIndexOf("@"):s.lastIndexOf("@",u))&&(o=s.slice(0,t),s=s.slice(t+1),e.auth=decodeURIComponent(o)),u=-1,p=0;p<Xo.length;p++)-1!==(h=s.indexOf(Xo[p]))&&(-1===u||h<u)&&(u=h);-1===u&&(u=s.length),e.host=s.slice(0,u),s=s.slice(u),ls(e),e.hostname=e.hostname||"";r="["===e.hostname[0]&&"]"===e.hostname[e.hostname.length-1];if(!r)for(var c=e.hostname.split(/\./),p=0,d=c.length;p<d;p++){var l=c[p];if(l&&!l.match(ts)){for(var f="",v=0,g=l.length;v<g;v++)127<l.charCodeAt(v)?f+="x":f+=l[v];if(!f.match(ts)){var m=c.slice(0,p),y=c.slice(p+1),S=l.match(is);S&&(m.push(S[1]),y.unshift(S[2])),y.length&&(s="/"+y.join(".")+s),e.hostname=m.join(".");break}}}e.hostname.length>es?e.hostname="":e.hostname=e.hostname.toLowerCase(),r||(e.hostname=Uo(e.hostname,function(e){return xo.test(e)?"xn--"+Fo(e):e}));var w=e.port?":"+e.port:"",b=e.hostname||"";e.host=b+w,e.href+=e.host,r&&(e.hostname=e.hostname.substr(1,e.hostname.length-2),"/"!==s[0])&&(s="/"+s)}if(!rs[a])for(p=0,d=$o.length;p<d;p++){var C,R=$o[p];-1!==s.indexOf(R)&&((C=encodeURIComponent(R))===R&&(C=escape(R)),s=s.split(R).join(C))}n=s.indexOf("#"),-1!==n&&(e.hash=s.substr(n),s=s.slice(0,n)),t=s.indexOf("?");return-1!==t?(e.search=s.substr(t),e.query=s.substr(t+1),i&&(e.query=Vo(e.query)),s=s.slice(0,t)):i&&(e.search="",e.query={}),s&&(e.pathname=s),os[a]&&e.hostname&&!e.pathname&&(e.pathname="/"),(e.pathname||e.search)&&(w=e.pathname||"",o=e.search||"",e.path=w+o),e.href=cs(e),e}function hs(e){if("string"==typeof e)e=(new Go).parse(e);else if(!(e instanceof Go))throw new TypeError('The "path" argument must be of type string or an instance of URL. Received type '+typeof e+String(e));if("file:"!==e.protocol)throw new TypeError("The URL must be of scheme file");var t=e.pathname;for(let e=0;e<t.length;e++)if("%"===t[e]){var i=32|t.codePointAt(e+2);if("2"===t[e+1]&&102==i)throw new TypeError("must not include encoded / characters")}return decodeURIComponent(t)}function us(e){return cs(e=an(e)?as({},e):e)}function cs(e){var i,r,n,t,o=e.auth||"",s=(o&&(o=(o=encodeURIComponent(o)).replace(/%3A/i,":"),o+="@"),e.protocol||""),a=e.pathname||"",h=e.hash||"",u=!1,c="",o=(e.host?u=o+e.host:e.hostname&&(u=o+(-1===e.hostname.indexOf(":")?e.hostname:"["+this.hostname+"]"),e.port)&&(u+=":"+e.port),e.query&&pn(e.query)&&Object.keys(e.query).length&&(i=e.query,r=r||"&",n=n||"=",c="object"==typeof(i=null===i?void 0:i)?Ho(Wo(i),function(e){var t=encodeURIComponent(Ko(e))+n;return jo(i[e])?Ho(i[e],function(e){return t+encodeURIComponent(Ko(e))}).join(r):t+encodeURIComponent(Ko(i[e]))}).join(r):t?encodeURIComponent(Ko(t))+n+encodeURIComponent(Ko(i)):""),e.search||c&&"?"+c||"");return s&&":"!==s.substr(-1)&&(s+=":"),e.slashes||(!s||os[s])&&!1!==u?(u="//"+(u||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):u=u||"",h&&"#"!==h.charAt(0)&&(h="#"+h),o&&"?"!==o.charAt(0)&&(o="?"+o),s+u+(a=a.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(o=o.replace("#","%23"))+h}function ps(e,t){return ss(e,!1,!0).resolve(t)}function ds(e,t){return e?ss(e,!1,!0).resolveObject(t):t}function ls(e){var t=e.host,i=Yo.exec(t);i&&(":"!==(i=i[0])&&(e.port=i.substr(1)),t=t.substr(0,t.length-i.length)),t&&(e.hostname=t)}Go.prototype.parse=function(e,t,i){return as(this,e,t,i)},Go.prototype.format=function(){return cs(this)},Go.prototype.resolve=function(e){return this.resolveObject(ss(e,!1,!0)).format()},Go.prototype.resolveObject=function(e){an(e)&&((d=new Go).parse(e,!1,!0),e=d);for(var t=new Go,i=Object.keys(this),r=0;r<i.length;r++){var n=i[r];t[n]=this[n]}if(t.hash=e.hash,""!==e.href)if(e.slashes&&!e.protocol){for(var o=Object.keys(e),s=0;s<o.length;s++){var a=o[s];"protocol"!==a&&(t[a]=e[a])}os[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/")}else if(e.protocol&&e.protocol!==t.protocol)if(os[e.protocol]){if(t.protocol=e.protocol,e.host||ns[e.protocol])t.pathname=e.pathname;else{for(m=(e.pathname||"").split("/");m.length&&!(e.host=m.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),t.pathname=m.join("/")}t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,(t.pathname||t.search)&&(d=t.pathname||"",l=t.search||"",t.path=d+l),t.slashes=t.slashes||e.slashes}else for(var h=Object.keys(e),u=0;u<h.length;u++){var c=h[u];t[c]=e[c]}else{var p,d=t.pathname&&"/"===t.pathname.charAt(0),l=e.host||e.pathname&&"/"===e.pathname.charAt(0),d=l||d||t.host&&e.pathname,f=d,v=t.pathname&&t.pathname.split("/")||[],g=t.protocol&&!os[t.protocol],m=e.pathname&&e.pathname.split("/")||[];if(g&&(t.hostname="",t.port=null,t.host&&(""===v[0]?v[0]=t.host:v.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===m[0]?m[0]=e.host:m.unshift(e.host)),e.host=null),d=d&&(""===m[0]||""===v[0])),l)t.host=(e.host||""===e.host?e:t).host,t.hostname=(e.hostname||""===e.hostname?e:t).hostname,t.search=e.search,t.query=e.query,v=m;else if(m.length)(v=v||[]).pop(),v=v.concat(m),t.search=e.search,t.query=e.query;else if(!on(e.search))return g&&(t.hostname=t.host=v.shift(),p=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=p.shift(),t.host=t.hostname=p.shift()),t.search=e.search,t.query=e.query,nn(t.pathname)&&nn(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.href=t.format(),t;if(v.length){for(var y=v.slice(-1)[0],l=(t.host||e.host||1<v.length)&&("."===y||".."===y)||""===y,S=0,w=v.length;0<=w;w--)"."===(y=v[w])?v.splice(w,1):".."===y?(v.splice(w,1),S++):S&&(v.splice(w,1),S--);if(!d&&!f)for(;S--;)v.unshift("..");!d||""===v[0]||v[0]&&"/"===v[0].charAt(0)||v.unshift(""),l&&"/"!==v.join("/").substr(-1)&&v.push("");f=""===v[0]||v[0]&&"/"===v[0].charAt(0);g&&(t.hostname=t.host=!f&&v.length?v.shift():"",p=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=p.shift(),t.host=t.hostname=p.shift()),(d=d||t.host&&v.length)&&!f&&v.unshift(""),v.length?t.pathname=v.join("/"):(t.pathname=null,t.path=null),nn(t.pathname)&&nn(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes}else t.pathname=null,t.search?t.path="/"+t.search:t.path=null}return t.href=t.format(),t},Go.prototype.parseHost=function(){return ls(this)};Dr=Object.freeze({__proto__:null,parse:ss,resolve:ps,resolveObject:ds,fileURLToPath:hs,format:us,default:kr,Url:Go});function fs(e,t){"string"==typeof e&&(e=ss(e));var i=-1===a.location.protocol.search(/^https?:$/)?"http:":"",i=e.protocol||i,r=e.hostname||e.host,n=e.port,o=e.path||"/",i=(r&&-1!==r.indexOf(":")&&(r="["+r+"]"),e.url=(r?i+"//"+r:"")+(n?":"+n:"")+o,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{},new T(e));return t&&i.on("response",t),i}function vs(e,t){e=fs(e,t);return e.end(),e}function gs(){}gs.defaultMaxSockets=4;var Or=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"],E={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"},ms=Ur(Object.freeze({__proto__:null,request:fs,get:vs,Agent:gs,METHODS:Or,STATUS_CODES:E,default:{request:fs,get:vs,Agent:gs,METHODS:Or,STATUS_CODES:E}}));function ys(e,t){"string"==typeof e&&(e=ss(e));var i=-1===a.location.protocol.search(/^https?:$/)?"http:":"",i=e.protocol||i,r=e.hostname||e.host,n=e.port,o=e.path||"/",i=(r&&-1!==r.indexOf(":")&&(r="["+r+"]"),e.url=(r?i+"//"+r:"")+(n?":"+n:"")+o,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{},new T(e));return t&&i.on("response",t),i}function Ss(e,t){e=ys(e,t);return e.end(),e}function ws(){}ws.defaultMaxSockets=4;var bs,Cs,M=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"],xr={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"},Rs=Ur(Object.freeze({__proto__:null,request:ys,get:Ss,Agent:ws,METHODS:M,STATUS_CODES:xr,default:{request:ys,get:Ss,Agent:ws,METHODS:M,STATUS_CODES:xr}})),Ms=Ur(C);function Es(){var a,s,h,u,c,t;return Cs||(Cs=1,a=Xa(),h=ms,u=Rs,t=c=Ms,bs=e,(s=En).inherits(e,u.Agent),e.prototype.createConnection=function(e,t,i){null!==e&&"object"==typeof e?(i=e,e=null):null!==t&&"object"==typeof t?(i=t,t=null):null!==i&&"object"==typeof i||(i={}),"number"==typeof e&&(i.port=e),"string"==typeof t&&(i.host=t);var i=s._extend({requestOCSP:!0},i),r=u.Agent.prototype.createConnection.call(this,e,t,i),n=this,o=null;return r.on("OCSPResponse",function(e){o=e}),r.on("secure",function(){return n.handleOCSPResponse(r,o,function(e){if(e)return r.destroy(e);r.uncork()})}),r.cork(),r},e.prototype.handleOCSPResponse=function(e,i,r){var n=(o=e.ssl.getPeerCertificate(!0)).issuerCertificate,o=o.raw;try{o=c.Certificate.decode(o,"der"),n&&(n=n.raw,n=c.Certificate.decode(n,"der"))}catch(e){return r(e)}function t(e,t){return e?r(e):(n=t,i?(e=a.request.generate(o,n),void a.verify({request:e,response:i},r)):a.check({cert:o,issuer:n},r))}return n?t(null,n):this.fetchIssuer(o,i,t)},e.prototype.fetchIssuer=function(e,t,o){var i=a.utils["id-ad-caIssuers"].join("."),s=this;a.utils.getAuthorityInfo(e,i,function(e,r){var i;return e?o(e):(e=s.caCache.get(r))?o(null,e):(i=!1,void h.get(r).on("error",n).on("response",function(t){if(t.statusCode<200||400<=t.statusCode)return n(new Error("Failed to fetch CA: "+t.statusCode));var i=[];t.on("readable",function(){var e=t.read();e&&i.push(e)}),t.on("end",function(){var e=v.concat(i);try{e=c.Certificate.decode(e,"der")}catch(e){return n(e)}s.caCache.set(r,e),n(null,e)})}));function n(e,t){i||(i=!0,o(e,t))}})}),bs;function e(e){u.Agent.call(this,e=e||{}),this.caCache=new t({maxSize:e.CACacheSize||1024})}}var Ps,As={};var Is,_s={},Ts=Ur(Object.freeze({__proto__:null,default:{}}));var Os,ks,xs,Ds,Bs=Ur(Dr);function Ls(){var c,p,d;return Ds||(Ds=1,c=Xa(),p=Ms,d=Ts,xs=function(t,i){var e=t.request;function r(e){Nr.nextTick(function(){i(e,o&&o.certStatus)})}try{n=e.issuer||p.Certificate.decode(c.utils.toDER(t.issuer,"CERTIFICATE"),"der"),o=c.utils.parseResponse(t.response)}catch(e){return r(e)}var n,o,s=t.response.slice(o.start,o.end),a=o.certs,h=o.certsTbs.map(function(e){return t.response.slice(e.start,e.end)}),u=(o=o.value,c.utils.sign[o.signatureAlgorithm.algorithm.join(".")]);if(u)return n=function(e,t,i){for(var r=e.tbsCertificate.subjectPublicKeyInfo,r=c.utils.toPEM(p.SubjectPublicKeyInfo.encode(r,"der"),"PUBLIC KEY"),n=0;n<t.length;n++){var o=t[n],s=c.utils.sign[o.signatureAlgorithm.algorithm.join(".")];if(!s)throw new Error("Unknown signature algorithm "+o.signatureAlgorithm.algorithm);var s=d.createVerify(s);if(s.update(i[n]),s.verify(r,o.signature.data))return s=o.tbsCertificate.subjectPublicKeyInfo,c.utils.toPEM(p.SubjectPublicKeyInfo.encode(s,"der"),"PUBLIC KEY");throw new Error("Invalid signature")}return r}(n,a,h),a=d.createVerify(u),h=o.tbsResponseData,u=o.signature.data,a.update(s),a.verify(n,u)?h.responses.length<1?r(new Error("Expected at least one response")):(o=h.responses[0]).certId.hashAlgorithm.algorithm.join(".")!==e.certID.hashAlgorithm.algorithm.join(".")?r(new Error("Hash algorithm mismatch")):o.certId.issuerNameHash.toString("hex")!==e.certID.issuerNameHash.toString("hex")?r(new Error("Issuer name hash mismatch")):o.certId.issuerKeyHash.toString("hex")!==e.certID.issuerKeyHash.toString("hex")?r(new Error("Issuer key hash mismatch")):0!==o.certId.serialNumber.cmp(e.certID.serialNumber)?r(new Error("Serial number mismatch")):"good"!==o.certStatus.type?r(new Error("OCSP Status: "+o.certStatus.type)):(s=+new Date,a=t.nudge||6e4,o.thisUpdate-a>s||o.nextUpdate+a<s?r(new Error("OCSP Response expired")):r(null)):r(new Error("Invalid signature"));r(new Error("Unknown signature algorithm "+o.signatureAlgorithm.algorithm))}),xs}var zs,Ns={},kr={},Or={exports:{}},E=Ur(e),M=Or,xr=R;function O(e,t){if(!e)throw new Error(t||"Assertion failed")}function Us(e,t){e.super_=t;function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function k(e,t,i){if(k.isBN(e))return e;this.negative=0,this.words=null,this.length=0,(this.red=null)!==e&&("le"!==t&&"be"!==t||(i=t,t=10),this._init(e||0,t||10,i||"be"))}"object"==typeof M?M.exports=k:xr.BN=k,(k.BN=k).wordSize=26;try{zs=("undefined"!=typeof window&&void 0!==window.Buffer?window:E).Buffer}catch(e){}function qs(e,t){e=e.charCodeAt(t);return 65<=e&&e<=70?e-55:97<=e&&e<=102?e-87:e-48&15}function Fs(e,t,i){var r=qs(e,i);return t<=i-1&&(r|=qs(e,i-1)<<4),r}function js(e,t,i,r){for(var n=0,o=Math.min(e.length,i),s=t;s<o;s++)var a=e.charCodeAt(s)-48,n=n*r+(49<=a?a-49+10:17<=a?a-17+10:a);return n}k.isBN=function(e){return e instanceof k||null!==e&&"object"==typeof e&&e.constructor.wordSize===k.wordSize&&Array.isArray(e.words)},k.max=function(e,t){return 0<e.cmp(t)?e:t},k.min=function(e,t){return e.cmp(t)<0?e:t},k.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);O((t="hex"===t?16:t)===(0|t)&&2<=t&&t<=36);var r=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(r++,this.negative=1),r<e.length&&(16===t?this._parseHex(e,r,i):(this._parseBase(e,t,r),"le"===i&&this._initArray(this.toArray(),t,i)))},k.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(O(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},k.prototype._initArray=function(e,t,i){if(O("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var r,n,o=0;o<this.length;o++)this.words[o]=0;var s=0;if("be"===i)for(o=e.length-1,r=0;0<=o;o-=3)n=e[o]|e[o-1]<<8|e[o-2]<<16,this.words[r]|=n<<s&67108863,this.words[r+1]=n>>>26-s&67108863,26<=(s+=24)&&(s-=26,r++);else if("le"===i)for(r=o=0;o<e.length;o+=3)n=e[o]|e[o+1]<<8|e[o+2]<<16,this.words[r]|=n<<s&67108863,this.words[r+1]=n>>>26-s&67108863,26<=(s+=24)&&(s-=26,r++);return this.strip()},k.prototype._parseHex=function(e,t,i){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var n,o=0,s=0;if("be"===i)for(r=e.length-1;t<=r;r-=2)n=Fs(e,t,r)<<o,this.words[s]|=67108863&n,18<=o?(o-=18,this.words[s+=1]|=n>>>26):o+=8;else for(r=(e.length-t)%2==0?t+1:t;r<e.length;r+=2)n=Fs(e,t,r)<<o,this.words[s]|=67108863&n,18<=o?(o-=18,this.words[s+=1]|=n>>>26):o+=8;this.strip()},k.prototype._parseBase=function(e,t,i){this.words=[0];for(var r=0,n=this.length=1;n<=67108863;n*=t)r++;for(var n=n/t|0,o=e.length-i,s=o%--r,a=Math.min(o,o-s)+i,h=0,u=i;u<a;u+=r)h=js(e,u,u+r,t),this.imuln(n),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!=s){for(var c=1,h=js(e,u,e.length,t),u=0;u<s;u++)c*=t;this.imuln(c),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},k.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},k.prototype.clone=function(){var e=new k(null);return this.copy(e),e},k.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},k.prototype.strip=function(){for(;1<this.length&&0===this.words[this.length-1];)this.length--;return this._normSign()},k.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},k.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var Ks=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],Hs=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],Ws=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function Vs(e,t,i){i.negative=t.negative^e.negative;var r=e.length+t.length|0,r=(i.length=r)-1|0,n=(s=(0|e.words[0])*(0|t.words[0]))/67108864|0;i.words[0]=67108863&s;for(var o=1;o<r;o++){for(var s,a=n>>>26,h=67108863&n,u=Math.min(o,t.length-1),c=Math.max(0,o-e.length+1);c<=u;c++)a+=(s=(0|e.words[o-c|0])*(0|t.words[c])+h)/67108864|0,h=67108863&s;i.words[o]=0|h,n=0|a}return 0!==n?i.words[o]=0|n:i.length--,i.strip()}k.prototype.toString=function(e,t){if(t=0|t||1,16===(e=e||10)||"hex"===e){a="";for(var i=0,r=0,n=0;n<this.length;n++){var o=this.words[n],s=(16777215&(o<<i|r)).toString(16),a=0!==(r=o>>>24-i&16777215)||n!==this.length-1?Ks[6-s.length]+s+a:s+a;26<=(i+=2)&&(i-=26,n--)}for(0!==r&&(a=r.toString(16)+a);a.length%t!=0;)a="0"+a;return a=0!==this.negative?"-"+a:a}if(e===(0|e)&&2<=e&&e<=36){var h=Hs[e],u=Ws[e];for(a="",(c=this.clone()).negative=0;!c.isZero();){var c,p=c.modn(u).toString(e);a=(c=c.idivn(u)).isZero()?p+a:Ks[h-p.length]+p+a}for(this.isZero()&&(a="0"+a);a.length%t!=0;)a="0"+a;return a=0!==this.negative?"-"+a:a}O(!1,"Base should be between 2 and 36")},k.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:2<this.length&&O(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},k.prototype.toJSON=function(){return this.toString(16)},k.prototype.toBuffer=function(e,t){return O(void 0!==zs),this.toArrayLike(zs,e,t)},k.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},k.prototype.toArrayLike=function(e,t,i){var r,n,o=this.byteLength(),s=i||Math.max(1,o),i=(O(o<=s,"byte array longer than desired length"),O(0<s,"Requested array length <= 0"),this.strip(),"le"===t),a=new e(s),h=this.clone();if(i){for(n=0;!h.isZero();n++)r=h.andln(255),h.iushrn(8),a[n]=r;for(;n<s;n++)a[n]=0}else{for(n=0;n<s-o;n++)a[n]=0;for(n=0;!h.isZero();n++)r=h.andln(255),h.iushrn(8),a[s-n-1]=r}return a},Math.clz32?k.prototype._countBits=function(e){return 32-Math.clz32(e)}:k.prototype._countBits=function(e){var t=0;return 4096<=e&&(t+=13,e>>>=13),64<=e&&(t+=7,e>>>=7),8<=e&&(t+=4,e>>>=4),2<=e&&(t+=2,e>>>=2),t+e},k.prototype._zeroBits=function(e){var t;return 0===e?26:((t=0)==(8191&(e=e))&&(t+=13,e>>>=13),0==(127&e)&&(t+=7,e>>>=7),0==(15&e)&&(t+=4,e>>>=4),0==(3&e)&&(t+=2,e>>>=2),0==(1&e)&&t++,t)},k.prototype.bitLength=function(){var e=this.words[this.length-1],e=this._countBits(e);return 26*(this.length-1)+e},k.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var i=this._zeroBits(this.words[t]);if(e+=i,26!==i)break}return e},k.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},k.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},k.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},k.prototype.isNeg=function(){return 0!==this.negative},k.prototype.neg=function(){return this.clone().ineg()},k.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},k.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},k.prototype.ior=function(e){return O(0==(this.negative|e.negative)),this.iuor(e)},k.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},k.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},k.prototype.iuand=function(e){for(var t=this.length>e.length?e:this,i=0;i<t.length;i++)this.words[i]=this.words[i]&e.words[i];return this.length=t.length,this.strip()},k.prototype.iand=function(e){return O(0==(this.negative|e.negative)),this.iuand(e)},k.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},k.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},k.prototype.iuxor=function(e){for(var t,i=this.length>e.length?(t=this,e):(t=e,this),r=0;r<i.length;r++)this.words[r]=t.words[r]^i.words[r];if(this!==t)for(;r<t.length;r++)this.words[r]=t.words[r];return this.length=t.length,this.strip()},k.prototype.ixor=function(e){return O(0==(this.negative|e.negative)),this.iuxor(e)},k.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},k.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},k.prototype.inotn=function(e){O("number"==typeof e&&0<=e);var t=0|Math.ceil(e/26),e=e%26;this._expand(t),0<e&&t--;for(var i=0;i<t;i++)this.words[i]=67108863&~this.words[i];return 0<e&&(this.words[i]=~this.words[i]&67108863>>26-e),this.strip()},k.prototype.notn=function(e){return this.clone().inotn(e)},k.prototype.setn=function(e,t){O("number"==typeof e&&0<=e);var i=e/26|0,e=e%26;return this._expand(1+i),this.words[i]=t?this.words[i]|1<<e:this.words[i]&~(1<<e),this.strip()},k.prototype.iadd=function(e){var t,i;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();for(var r=this.length>e.length?(i=this,e):(i=e,this),n=0,o=0;o<r.length;o++)t=(0|i.words[o])+(0|r.words[o])+n,this.words[o]=67108863&t,n=t>>>26;for(;0!==n&&o<i.length;o++)t=(0|i.words[o])+n,this.words[o]=67108863&t,n=t>>>26;if(this.length=i.length,0!==n)this.words[this.length]=n,this.length++;else if(i!==this)for(;o<i.length;o++)this.words[o]=i.words[o];return this},k.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},k.prototype.isub=function(e){var t;if(0!==e.negative)return e.negative=0,t=this.iadd(e),e.negative=1,t._normSign();if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i,r=this.cmp(e);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;for(var n=0<r?(i=this,e):(i=e,this),o=0,s=0;s<n.length;s++)o=(t=(0|i.words[s])-(0|n.words[s])+o)>>26,this.words[s]=67108863&t;for(;0!==o&&s<i.length;s++)o=(t=(0|i.words[s])+o)>>26,this.words[s]=67108863&t;if(0===o&&s<i.length&&i!==this)for(;s<i.length;s++)this.words[s]=i.words[s];return this.length=Math.max(this.length,s),i!==this&&(this.negative=1),this.strip()},k.prototype.sub=function(e){return this.clone().isub(e)};var Gs=function(e,L,z){var t,i=e.words,r=L.words,n=z.words,o=0|i[0],s=8191&o,o=o>>>13,a=0|i[1],h=8191&a,a=a>>>13,u=0|i[2],c=8191&u,u=u>>>13,p=0|i[3],d=8191&p,p=p>>>13,l=0|i[4],f=8191&l,l=l>>>13,v=0|i[5],g=8191&v,v=v>>>13,m=0|i[6],y=8191&m,m=m>>>13,S=0|i[7],w=8191&S,S=S>>>13,b=0|i[8],N=8191&b,b=b>>>13,i=0|i[9],U=8191&i,i=i>>>13,C=0|r[0],R=8191&C,C=C>>>13,M=0|r[1],E=8191&M,M=M>>>13,P=0|r[2],A=8191&P,P=P>>>13,I=0|r[3],q=8191&I,I=I>>>13,_=0|r[4],F=8191&_,_=_>>>13,T=0|r[5],j=8191&T,T=T>>>13,O=0|r[6],K=8191&O,O=O>>>13,k=0|r[7],H=8191&k,k=k>>>13,x=0|r[8],W=8191&x,x=x>>>13,r=0|r[9],V=8191&r,r=r>>>13,L=(z.negative=e.negative^L.negative,z.length=19,(0+Math.imul(s,R)|0)+((8191&(e=Math.imul(s,C)+Math.imul(o,R)|0))<<13)|0),D=(Math.imul(o,C)+(e>>>13)|0)+(L>>>26)|0;L&=67108863,t=Math.imul(h,R),e=Math.imul(h,C)+Math.imul(a,R)|0,B=Math.imul(a,C);var B,G=(D+(t+Math.imul(s,E)|0)|0)+((8191&(e=(e+Math.imul(s,M)|0)+Math.imul(o,E)|0))<<13)|0,J=(D=((B+Math.imul(o,M)|0)+(e>>>13)|0)+(G>>>26)|0,G&=67108863,t=Math.imul(c,R),e=Math.imul(c,C)+Math.imul(u,R)|0,B=Math.imul(u,C),t=t+Math.imul(h,E)|0,e=(e+Math.imul(h,M)|0)+Math.imul(a,E)|0,B=B+Math.imul(a,M)|0,(D+(t+Math.imul(s,A)|0)|0)+((8191&(e=(e+Math.imul(s,P)|0)+Math.imul(o,A)|0))<<13)|0),Y=(D=((B+Math.imul(o,P)|0)+(e>>>13)|0)+(J>>>26)|0,J&=67108863,t=Math.imul(d,R),e=Math.imul(d,C)+Math.imul(p,R)|0,B=Math.imul(p,C),t=t+Math.imul(c,E)|0,e=(e+Math.imul(c,M)|0)+Math.imul(u,E)|0,B=B+Math.imul(u,M)|0,t=t+Math.imul(h,A)|0,e=(e+Math.imul(h,P)|0)+Math.imul(a,A)|0,B=B+Math.imul(a,P)|0,(D+(t+Math.imul(s,q)|0)|0)+((8191&(e=(e+Math.imul(s,I)|0)+Math.imul(o,q)|0))<<13)|0),Z=(D=((B+Math.imul(o,I)|0)+(e>>>13)|0)+(Y>>>26)|0,Y&=67108863,t=Math.imul(f,R),e=Math.imul(f,C)+Math.imul(l,R)|0,B=Math.imul(l,C),t=t+Math.imul(d,E)|0,e=(e+Math.imul(d,M)|0)+Math.imul(p,E)|0,B=B+Math.imul(p,M)|0,t=t+Math.imul(c,A)|0,e=(e+Math.imul(c,P)|0)+Math.imul(u,A)|0,B=B+Math.imul(u,P)|0,t=t+Math.imul(h,q)|0,e=(e+Math.imul(h,I)|0)+Math.imul(a,q)|0,B=B+Math.imul(a,I)|0,(D+(t+Math.imul(s,F)|0)|0)+((8191&(e=(e+Math.imul(s,_)|0)+Math.imul(o,F)|0))<<13)|0),$=(D=((B+Math.imul(o,_)|0)+(e>>>13)|0)+(Z>>>26)|0,Z&=67108863,t=Math.imul(g,R),e=Math.imul(g,C)+Math.imul(v,R)|0,B=Math.imul(v,C),t=t+Math.imul(f,E)|0,e=(e+Math.imul(f,M)|0)+Math.imul(l,E)|0,B=B+Math.imul(l,M)|0,t=t+Math.imul(d,A)|0,e=(e+Math.imul(d,P)|0)+Math.imul(p,A)|0,B=B+Math.imul(p,P)|0,t=t+Math.imul(c,q)|0,e=(e+Math.imul(c,I)|0)+Math.imul(u,q)|0,B=B+Math.imul(u,I)|0,t=t+Math.imul(h,F)|0,e=(e+Math.imul(h,_)|0)+Math.imul(a,F)|0,B=B+Math.imul(a,_)|0,(D+(t+Math.imul(s,j)|0)|0)+((8191&(e=(e+Math.imul(s,T)|0)+Math.imul(o,j)|0))<<13)|0),X=(D=((B+Math.imul(o,T)|0)+(e>>>13)|0)+($>>>26)|0,$&=67108863,t=Math.imul(y,R),e=Math.imul(y,C)+Math.imul(m,R)|0,B=Math.imul(m,C),t=t+Math.imul(g,E)|0,e=(e+Math.imul(g,M)|0)+Math.imul(v,E)|0,B=B+Math.imul(v,M)|0,t=t+Math.imul(f,A)|0,e=(e+Math.imul(f,P)|0)+Math.imul(l,A)|0,B=B+Math.imul(l,P)|0,t=t+Math.imul(d,q)|0,e=(e+Math.imul(d,I)|0)+Math.imul(p,q)|0,B=B+Math.imul(p,I)|0,t=t+Math.imul(c,F)|0,e=(e+Math.imul(c,_)|0)+Math.imul(u,F)|0,B=B+Math.imul(u,_)|0,t=t+Math.imul(h,j)|0,e=(e+Math.imul(h,T)|0)+Math.imul(a,j)|0,B=B+Math.imul(a,T)|0,(D+(t+Math.imul(s,K)|0)|0)+((8191&(e=(e+Math.imul(s,O)|0)+Math.imul(o,K)|0))<<13)|0),Q=(D=((B+Math.imul(o,O)|0)+(e>>>13)|0)+(X>>>26)|0,X&=67108863,t=Math.imul(w,R),e=Math.imul(w,C)+Math.imul(S,R)|0,B=Math.imul(S,C),t=t+Math.imul(y,E)|0,e=(e+Math.imul(y,M)|0)+Math.imul(m,E)|0,B=B+Math.imul(m,M)|0,t=t+Math.imul(g,A)|0,e=(e+Math.imul(g,P)|0)+Math.imul(v,A)|0,B=B+Math.imul(v,P)|0,t=t+Math.imul(f,q)|0,e=(e+Math.imul(f,I)|0)+Math.imul(l,q)|0,B=B+Math.imul(l,I)|0,t=t+Math.imul(d,F)|0,e=(e+Math.imul(d,_)|0)+Math.imul(p,F)|0,B=B+Math.imul(p,_)|0,t=t+Math.imul(c,j)|0,e=(e+Math.imul(c,T)|0)+Math.imul(u,j)|0,B=B+Math.imul(u,T)|0,t=t+Math.imul(h,K)|0,e=(e+Math.imul(h,O)|0)+Math.imul(a,K)|0,B=B+Math.imul(a,O)|0,(D+(t+Math.imul(s,H)|0)|0)+((8191&(e=(e+Math.imul(s,k)|0)+Math.imul(o,H)|0))<<13)|0),ee=(D=((B+Math.imul(o,k)|0)+(e>>>13)|0)+(Q>>>26)|0,Q&=67108863,t=Math.imul(N,R),e=Math.imul(N,C)+Math.imul(b,R)|0,B=Math.imul(b,C),t=t+Math.imul(w,E)|0,e=(e+Math.imul(w,M)|0)+Math.imul(S,E)|0,B=B+Math.imul(S,M)|0,t=t+Math.imul(y,A)|0,e=(e+Math.imul(y,P)|0)+Math.imul(m,A)|0,B=B+Math.imul(m,P)|0,t=t+Math.imul(g,q)|0,e=(e+Math.imul(g,I)|0)+Math.imul(v,q)|0,B=B+Math.imul(v,I)|0,t=t+Math.imul(f,F)|0,e=(e+Math.imul(f,_)|0)+Math.imul(l,F)|0,B=B+Math.imul(l,_)|0,t=t+Math.imul(d,j)|0,e=(e+Math.imul(d,T)|0)+Math.imul(p,j)|0,B=B+Math.imul(p,T)|0,t=t+Math.imul(c,K)|0,e=(e+Math.imul(c,O)|0)+Math.imul(u,K)|0,B=B+Math.imul(u,O)|0,t=t+Math.imul(h,H)|0,e=(e+Math.imul(h,k)|0)+Math.imul(a,H)|0,B=B+Math.imul(a,k)|0,(D+(t+Math.imul(s,W)|0)|0)+((8191&(e=(e+Math.imul(s,x)|0)+Math.imul(o,W)|0))<<13)|0),R=(D=((B+Math.imul(o,x)|0)+(e>>>13)|0)+(ee>>>26)|0,ee&=67108863,t=Math.imul(U,R),e=Math.imul(U,C)+Math.imul(i,R)|0,B=Math.imul(i,C),t=t+Math.imul(N,E)|0,e=(e+Math.imul(N,M)|0)+Math.imul(b,E)|0,B=B+Math.imul(b,M)|0,t=t+Math.imul(w,A)|0,e=(e+Math.imul(w,P)|0)+Math.imul(S,A)|0,B=B+Math.imul(S,P)|0,t=t+Math.imul(y,q)|0,e=(e+Math.imul(y,I)|0)+Math.imul(m,q)|0,B=B+Math.imul(m,I)|0,t=t+Math.imul(g,F)|0,e=(e+Math.imul(g,_)|0)+Math.imul(v,F)|0,B=B+Math.imul(v,_)|0,t=t+Math.imul(f,j)|0,e=(e+Math.imul(f,T)|0)+Math.imul(l,j)|0,B=B+Math.imul(l,T)|0,t=t+Math.imul(d,K)|0,e=(e+Math.imul(d,O)|0)+Math.imul(p,K)|0,B=B+Math.imul(p,O)|0,t=t+Math.imul(c,H)|0,e=(e+Math.imul(c,k)|0)+Math.imul(u,H)|0,B=B+Math.imul(u,k)|0,t=t+Math.imul(h,W)|0,e=(e+Math.imul(h,x)|0)+Math.imul(a,W)|0,B=B+Math.imul(a,x)|0,(D+(t+Math.imul(s,V)|0)|0)+((8191&(e=(e+Math.imul(s,r)|0)+Math.imul(o,V)|0))<<13)|0),C=(D=((B+Math.imul(o,r)|0)+(e>>>13)|0)+(R>>>26)|0,R&=67108863,t=Math.imul(U,E),e=Math.imul(U,M)+Math.imul(i,E)|0,B=Math.imul(i,M),t=t+Math.imul(N,A)|0,e=(e+Math.imul(N,P)|0)+Math.imul(b,A)|0,B=B+Math.imul(b,P)|0,t=t+Math.imul(w,q)|0,e=(e+Math.imul(w,I)|0)+Math.imul(S,q)|0,B=B+Math.imul(S,I)|0,t=t+Math.imul(y,F)|0,e=(e+Math.imul(y,_)|0)+Math.imul(m,F)|0,B=B+Math.imul(m,_)|0,t=t+Math.imul(g,j)|0,e=(e+Math.imul(g,T)|0)+Math.imul(v,j)|0,B=B+Math.imul(v,T)|0,t=t+Math.imul(f,K)|0,e=(e+Math.imul(f,O)|0)+Math.imul(l,K)|0,B=B+Math.imul(l,O)|0,t=t+Math.imul(d,H)|0,e=(e+Math.imul(d,k)|0)+Math.imul(p,H)|0,B=B+Math.imul(p,k)|0,t=t+Math.imul(c,W)|0,e=(e+Math.imul(c,x)|0)+Math.imul(u,W)|0,B=B+Math.imul(u,x)|0,(D+(t+Math.imul(h,V)|0)|0)+((8191&(e=(e+Math.imul(h,r)|0)+Math.imul(a,V)|0))<<13)|0),s=(D=((B+Math.imul(a,r)|0)+(e>>>13)|0)+(C>>>26)|0,C&=67108863,t=Math.imul(U,A),e=Math.imul(U,P)+Math.imul(i,A)|0,B=Math.imul(i,P),t=t+Math.imul(N,q)|0,e=(e+Math.imul(N,I)|0)+Math.imul(b,q)|0,B=B+Math.imul(b,I)|0,t=t+Math.imul(w,F)|0,e=(e+Math.imul(w,_)|0)+Math.imul(S,F)|0,B=B+Math.imul(S,_)|0,t=t+Math.imul(y,j)|0,e=(e+Math.imul(y,T)|0)+Math.imul(m,j)|0,B=B+Math.imul(m,T)|0,t=t+Math.imul(g,K)|0,e=(e+Math.imul(g,O)|0)+Math.imul(v,K)|0,B=B+Math.imul(v,O)|0,t=t+Math.imul(f,H)|0,e=(e+Math.imul(f,k)|0)+Math.imul(l,H)|0,B=B+Math.imul(l,k)|0,t=t+Math.imul(d,W)|0,e=(e+Math.imul(d,x)|0)+Math.imul(p,W)|0,B=B+Math.imul(p,x)|0,(D+(t+Math.imul(c,V)|0)|0)+((8191&(e=(e+Math.imul(c,r)|0)+Math.imul(u,V)|0))<<13)|0),o=(D=((B+Math.imul(u,r)|0)+(e>>>13)|0)+(s>>>26)|0,s&=67108863,t=Math.imul(U,q),e=Math.imul(U,I)+Math.imul(i,q)|0,B=Math.imul(i,I),t=t+Math.imul(N,F)|0,e=(e+Math.imul(N,_)|0)+Math.imul(b,F)|0,B=B+Math.imul(b,_)|0,t=t+Math.imul(w,j)|0,e=(e+Math.imul(w,T)|0)+Math.imul(S,j)|0,B=B+Math.imul(S,T)|0,t=t+Math.imul(y,K)|0,e=(e+Math.imul(y,O)|0)+Math.imul(m,K)|0,B=B+Math.imul(m,O)|0,t=t+Math.imul(g,H)|0,e=(e+Math.imul(g,k)|0)+Math.imul(v,H)|0,B=B+Math.imul(v,k)|0,t=t+Math.imul(f,W)|0,e=(e+Math.imul(f,x)|0)+Math.imul(l,W)|0,B=B+Math.imul(l,x)|0,(D+(t+Math.imul(d,V)|0)|0)+((8191&(e=(e+Math.imul(d,r)|0)+Math.imul(p,V)|0))<<13)|0),E=(D=((B+Math.imul(p,r)|0)+(e>>>13)|0)+(o>>>26)|0,o&=67108863,t=Math.imul(U,F),e=Math.imul(U,_)+Math.imul(i,F)|0,B=Math.imul(i,_),t=t+Math.imul(N,j)|0,e=(e+Math.imul(N,T)|0)+Math.imul(b,j)|0,B=B+Math.imul(b,T)|0,t=t+Math.imul(w,K)|0,e=(e+Math.imul(w,O)|0)+Math.imul(S,K)|0,B=B+Math.imul(S,O)|0,t=t+Math.imul(y,H)|0,e=(e+Math.imul(y,k)|0)+Math.imul(m,H)|0,B=B+Math.imul(m,k)|0,t=t+Math.imul(g,W)|0,e=(e+Math.imul(g,x)|0)+Math.imul(v,W)|0,B=B+Math.imul(v,x)|0,(D+(t+Math.imul(f,V)|0)|0)+((8191&(e=(e+Math.imul(f,r)|0)+Math.imul(l,V)|0))<<13)|0),M=(D=((B+Math.imul(l,r)|0)+(e>>>13)|0)+(E>>>26)|0,E&=67108863,t=Math.imul(U,j),e=Math.imul(U,T)+Math.imul(i,j)|0,B=Math.imul(i,T),t=t+Math.imul(N,K)|0,e=(e+Math.imul(N,O)|0)+Math.imul(b,K)|0,B=B+Math.imul(b,O)|0,t=t+Math.imul(w,H)|0,e=(e+Math.imul(w,k)|0)+Math.imul(S,H)|0,B=B+Math.imul(S,k)|0,t=t+Math.imul(y,W)|0,e=(e+Math.imul(y,x)|0)+Math.imul(m,W)|0,B=B+Math.imul(m,x)|0,(D+(t+Math.imul(g,V)|0)|0)+((8191&(e=(e+Math.imul(g,r)|0)+Math.imul(v,V)|0))<<13)|0),h=(D=((B+Math.imul(v,r)|0)+(e>>>13)|0)+(M>>>26)|0,M&=67108863,t=Math.imul(U,K),e=Math.imul(U,O)+Math.imul(i,K)|0,B=Math.imul(i,O),t=t+Math.imul(N,H)|0,e=(e+Math.imul(N,k)|0)+Math.imul(b,H)|0,B=B+Math.imul(b,k)|0,t=t+Math.imul(w,W)|0,e=(e+Math.imul(w,x)|0)+Math.imul(S,W)|0,B=B+Math.imul(S,x)|0,(D+(t+Math.imul(y,V)|0)|0)+((8191&(e=(e+Math.imul(y,r)|0)+Math.imul(m,V)|0))<<13)|0),a=(D=((B+Math.imul(m,r)|0)+(e>>>13)|0)+(h>>>26)|0,h&=67108863,t=Math.imul(U,H),e=Math.imul(U,k)+Math.imul(i,H)|0,B=Math.imul(i,k),t=t+Math.imul(N,W)|0,e=(e+Math.imul(N,x)|0)+Math.imul(b,W)|0,B=B+Math.imul(b,x)|0,(D+(t+Math.imul(w,V)|0)|0)+((8191&(e=(e+Math.imul(w,r)|0)+Math.imul(S,V)|0))<<13)|0),A=(D=((B+Math.imul(S,r)|0)+(e>>>13)|0)+(a>>>26)|0,a&=67108863,t=Math.imul(U,W),e=Math.imul(U,x)+Math.imul(i,W)|0,B=Math.imul(i,x),(D+(t+Math.imul(N,V)|0)|0)+((8191&(e=(e+Math.imul(N,r)|0)+Math.imul(b,V)|0))<<13)|0),P=(D=((B+Math.imul(b,r)|0)+(e>>>13)|0)+(A>>>26)|0,A&=67108863,(D+Math.imul(U,V)|0)+((8191&(e=Math.imul(U,r)+Math.imul(i,V)|0))<<13)|0);return D=(Math.imul(i,r)+(e>>>13)|0)+(P>>>26)|0,P&=67108863,n[0]=L,n[1]=G,n[2]=J,n[3]=Y,n[4]=Z,n[5]=$,n[6]=X,n[7]=Q,n[8]=ee,n[9]=R,n[10]=C,n[11]=s,n[12]=o,n[13]=E,n[14]=M,n[15]=h,n[16]=a,n[17]=A,n[18]=P,0!=D&&(n[19]=D,z.length++),z};function Js(e,t,i){return(new Ys).mulp(e,t,i)}function Ys(e,t){this.x=e,this.y=t}Math.imul||(Gs=Vs),k.prototype.mulTo=function(e,t){var i=this.length+e.length,i=(10===this.length&&10===e.length?Gs:i<63?Vs:i<1024?function(e,t,i){i.negative=t.negative^e.negative,i.length=e.length+t.length;for(var r=0,n=0,o=0;o<i.length-1;o++){for(var s=n,n=0,a=67108863&r,h=Math.min(o,t.length-1),u=Math.max(0,o-e.length+1);u<=h;u++){var c,p=(0|e.words[o-u])*(0|t.words[u]),a=67108863&(c=(67108863&p)+a|0);n+=(s=(s=s+(p/67108864|0)|0)+(c>>>26)|0)>>>26,s&=67108863}i.words[o]=a,r=s,s=n}return 0!==r?i.words[o]=r:i.length--,i.strip()}:Js)(this,e,t);return i},Ys.prototype.makeRBT=function(e){for(var t=new Array(e),i=k.prototype._countBits(e)-1,r=0;r<e;r++)t[r]=this.revBin(r,i,e);return t},Ys.prototype.revBin=function(e,t,i){if(0===e||e===i-1)return e;for(var r=0,n=0;n<t;n++)r|=(1&e)<<t-n-1,e>>=1;return r},Ys.prototype.permute=function(e,t,i,r,n,o){for(var s=0;s<o;s++)r[s]=t[e[s]],n[s]=i[e[s]]},Ys.prototype.transform=function(e,t,i,r,n,o){this.permute(o,e,t,i,r,n);for(var s=1;s<n;s<<=1)for(var a=s<<1,h=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),c=0;c<n;c+=a)for(var p=h,d=u,l=0;l<s;l++){var f=i[c+l],v=r[c+l],g=i[c+l+s],m=p*g-d*(y=r[c+l+s]),y=p*y+d*g;i[c+l]=f+(g=m),r[c+l]=v+y,i[c+l+s]=f-g,r[c+l+s]=v-y,l!==a&&(m=h*p-u*d,d=h*d+u*p,p=m)}},Ys.prototype.guessLen13b=function(e,t){for(var t=1&(r=1|Math.max(t,e)),i=0,r=r/2|0;r;r>>>=1)i++;return 1<<i+1+t},Ys.prototype.conjugate=function(e,t,i){if(!(i<=1))for(var r=0;r<i/2;r++){var n=e[r];e[r]=e[i-r-1],e[i-r-1]=n,n=t[r],t[r]=-t[i-r-1],t[i-r-1]=-n}},Ys.prototype.normalize13b=function(e,t){for(var i=0,r=0;r<t/2;r++){var n=8192*Math.round(e[2*r+1]/t)+Math.round(e[2*r]/t)+i;e[r]=67108863&n,i=n<67108864?0:n/67108864|0}return e},Ys.prototype.convert13b=function(e,t,i,r){for(var n=0,o=0;o<t;o++)n+=0|e[o],i[2*o]=8191&n,i[2*o+1]=8191&(n>>>=13),n>>>=13;for(o=2*t;o<r;++o)i[o]=0;O(0===n),O(0==(-8192&n))},Ys.prototype.stub=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t},Ys.prototype.mulp=function(e,t,i){var r=2*this.guessLen13b(e.length,t.length),n=this.makeRBT(r),o=this.stub(r),s=new Array(r),a=new Array(r),h=new Array(r),u=new Array(r),c=new Array(r),p=new Array(r),d=i.words;d.length=r,this.convert13b(e.words,e.length,s,r),this.convert13b(t.words,t.length,u,r),this.transform(s,o,a,h,r,n),this.transform(u,o,c,p,r,n);for(var l=0;l<r;l++){var f=a[l]*c[l]-h[l]*p[l];h[l]=a[l]*p[l]+h[l]*c[l],a[l]=f}return this.conjugate(a,h,r),this.transform(a,h,d,o,r,n),this.conjugate(d,o,r),this.normalize13b(d,r),i.negative=e.negative^t.negative,i.length=e.length+t.length,i.strip()},k.prototype.mul=function(e){var t=new k(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},k.prototype.mulf=function(e){var t=new k(null);return t.words=new Array(this.length+e.length),Js(this,e,t)},k.prototype.imul=function(e){return this.clone().mulTo(e,this)},k.prototype.imuln=function(e){O("number"==typeof e),O(e<67108864);for(var t=0,i=0;i<this.length;i++){var r=(0|this.words[i])*e,n=(67108863&r)+(67108863&t),t=(t>>=26)+(r/67108864|0)+(n>>>26);this.words[i]=67108863&n}return 0!==t&&(this.words[i]=t,this.length++),this},k.prototype.muln=function(e){return this.clone().imuln(e)},k.prototype.sqr=function(){return this.mul(this)},k.prototype.isqr=function(){return this.imul(this.clone())},k.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),i=0;i<t.length;i++){var r=i%26;t[i]=(e.words[i/26|0]&1<<r)>>>r}return t}(e);if(0===t.length)return new k(1);for(var i=this,r=0;r<t.length&&0===t[r];r++,i=i.sqr());if(++r<t.length)for(var n=i.sqr();r<t.length;r++,n=n.sqr())0!==t[r]&&(i=i.mul(n));return i},k.prototype.iushln=function(e){O("number"==typeof e&&0<=e);var t=e%26,i=(e-t)/26,r=67108863>>>26-t<<26-t;if(0!=t){for(var n=0,o=0;o<this.length;o++){var s=this.words[o]&r,a=(0|this.words[o])-s<<t;this.words[o]=a|n,n=s>>>26-t}n&&(this.words[o]=n,this.length++)}if(0!=i){for(o=this.length-1;0<=o;o--)this.words[o+i]=this.words[o];for(o=0;o<i;o++)this.words[o]=0;this.length+=i}return this.strip()},k.prototype.ishln=function(e){return O(0===this.negative),this.iushln(e)},k.prototype.iushrn=function(e,t,i){O("number"==typeof e&&0<=e),r=t?(t-t%26)/26:0;var r,n=e%26,o=Math.min((e-n)/26,this.length),s=67108863^67108863>>>n<<n,a=i;if(r-=o,r=Math.max(0,r),a){for(var h=0;h<o;h++)a.words[h]=this.words[h];a.length=o}if(0!==o)if(this.length>o)for(this.length-=o,h=0;h<this.length;h++)this.words[h]=this.words[h+o];else this.words[0]=0,this.length=1;for(var u=0,h=this.length-1;0<=h&&(0!==u||r<=h);h--){var c=0|this.words[h];this.words[h]=u<<26-n|c>>>n,u=c&s}return a&&0!==u&&(a.words[a.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},k.prototype.ishrn=function(e,t,i){return O(0===this.negative),this.iushrn(e,t,i)},k.prototype.shln=function(e){return this.clone().ishln(e)},k.prototype.ushln=function(e){return this.clone().iushln(e)},k.prototype.shrn=function(e){return this.clone().ishrn(e)},k.prototype.ushrn=function(e){return this.clone().iushrn(e)},k.prototype.testn=function(e){O("number"==typeof e&&0<=e);var t=e%26,e=(e-t)/26;return!(this.length<=e||!(this.words[e]&1<<t))},k.prototype.imaskn=function(e){O("number"==typeof e&&0<=e);var t=e%26,e=(e-t)/26;return O(0===this.negative,"imaskn works only with positive numbers"),this.length<=e?this:(0!=t&&e++,this.length=Math.min(e,this.length),0!=t&&(this.words[this.length-1]&=67108863^67108863>>>t<<t),this.strip())},k.prototype.maskn=function(e){return this.clone().imaskn(e)},k.prototype.iaddn=function(e){return O("number"==typeof e),O(e<67108864),e<0?this.isubn(-e):0!==this.negative?(1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0):(this.negative=0,this.isubn(e),this.negative=1),this):this._iaddn(e)},k.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&67108864<=this.words[t];t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},k.prototype.isubn=function(e){if(O("number"==typeof e),O(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,--this.words[t+1];return this.strip()},k.prototype.addn=function(e){return this.clone().iaddn(e)},k.prototype.subn=function(e){return this.clone().isubn(e)},k.prototype.iabs=function(){return this.negative=0,this},k.prototype.abs=function(){return this.clone().iabs()},k.prototype._ishlnsubmul=function(e,t,i){for(var r=e.length+i,n=(this._expand(r),0),o=0;o<e.length;o++){var s=(0|this.words[o+i])+n,a=(0|e.words[o])*t,n=((s-=67108863&a)>>26)-(a/67108864|0);this.words[o+i]=67108863&s}for(;o<this.length-i;o++)n=(s=(0|this.words[o+i])+n)>>26,this.words[o+i]=67108863&s;if(0!==n){for(O(-1===n),o=n=0;o<this.length;o++)n=(s=-(0|this.words[o])+n)>>26,this.words[o]=67108863&s;this.negative=1}return this.strip()},k.prototype._wordDiv=function(e,t){this.length,e.length;var i,r=this.clone(),n=e,o=0|n.words[n.length-1],s=(0!=(e=26-this._countBits(o))&&(n=n.ushln(e),r.iushln(e),o=0|n.words[n.length-1]),r.length-n.length);if("mod"!==t){(i=new k(null)).length=1+s,i.words=new Array(i.length);for(var a=0;a<i.length;a++)i.words[a]=0}var h=r.clone()._ishlnsubmul(n,1,s);0===h.negative&&(r=h,i)&&(i.words[s]=1);for(var u=s-1;0<=u;u--){var c=67108864*(0|r.words[n.length+u])+(0|r.words[n.length+u-1]),c=Math.min(c/o|0,67108863);for(r._ishlnsubmul(n,c,u);0!==r.negative;)c--,r.negative=0,r._ishlnsubmul(n,1,u),r.isZero()||(r.negative^=1);i&&(i.words[u]=c)}return i&&i.strip(),r.strip(),"div"!==t&&0!=e&&r.iushrn(e),{div:i||null,mod:r}},k.prototype.divmod=function(e,t,i){var r,n,o;return O(!e.isZero()),this.isZero()?{div:new k(0),mod:new k(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(r=o.div.neg()),"div"!==t&&(n=o.mod.neg(),i)&&0!==n.negative&&n.iadd(e),{div:r,mod:n}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),{div:r="mod"!==t?o.div.neg():r,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(n=o.mod.neg(),i)&&0!==n.negative&&n.isub(e),{div:o.div,mod:n}):e.length>this.length||this.cmp(e)<0?{div:new k(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new k(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new k(this.modn(e.words[0]))}:this._wordDiv(e,t)},k.prototype.div=function(e){return this.divmod(e,"div",!1).div},k.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},k.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},k.prototype.divRound=function(e){var t,i,r=this.divmod(e);return r.mod.isZero()||(i=0!==r.div.negative?r.mod.isub(e):r.mod,t=e.ushrn(1),e=e.andln(1),(i=i.cmp(t))<0)||1===e&&0===i?r.div:0!==r.div.negative?r.div.isubn(1):r.div.iaddn(1)},k.prototype.modn=function(e){O(e<=67108863);for(var t=(1<<26)%e,i=0,r=this.length-1;0<=r;r--)i=(t*i+(0|this.words[r]))%e;return i},k.prototype.idivn=function(e){O(e<=67108863);for(var t=0,i=this.length-1;0<=i;i--){var r=(0|this.words[i])+67108864*t;this.words[i]=r/e|0,t=r%e}return this.strip()},k.prototype.divn=function(e){return this.clone().idivn(e)},k.prototype.egcd=function(e){O(0===e.negative),O(!e.isZero());for(var t=this,i=e.clone(),t=0!==t.negative?t.umod(e):t.clone(),r=new k(1),n=new k(0),o=new k(0),s=new k(1),a=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++a;for(var h=i.clone(),u=t.clone();!t.isZero();){for(var c=0,p=1;0==(t.words[0]&p)&&c<26;++c,p<<=1);if(0<c)for(t.iushrn(c);0<c--;)(r.isOdd()||n.isOdd())&&(r.iadd(h),n.isub(u)),r.iushrn(1),n.iushrn(1);for(var d=0,l=1;0==(i.words[0]&l)&&d<26;++d,l<<=1);if(0<d)for(i.iushrn(d);0<d--;)(o.isOdd()||s.isOdd())&&(o.iadd(h),s.isub(u)),o.iushrn(1),s.iushrn(1);0<=t.cmp(i)?(t.isub(i),r.isub(o),n.isub(s)):(i.isub(t),o.isub(r),s.isub(n))}return{a:o,b:s,gcd:i.iushln(a)}},k.prototype._invmp=function(e){O(0===e.negative),O(!e.isZero());for(var t,i=this,r=e.clone(),i=0!==i.negative?i.umod(e):i.clone(),n=new k(1),o=new k(0),s=r.clone();0<i.cmpn(1)&&0<r.cmpn(1);){for(var a=0,h=1;0==(i.words[0]&h)&&a<26;++a,h<<=1);if(0<a)for(i.iushrn(a);0<a--;)n.isOdd()&&n.iadd(s),n.iushrn(1);for(var u=0,c=1;0==(r.words[0]&c)&&u<26;++u,c<<=1);if(0<u)for(r.iushrn(u);0<u--;)o.isOdd()&&o.iadd(s),o.iushrn(1);0<=i.cmp(r)?(i.isub(r),n.isub(o)):(r.isub(i),o.isub(n))}return(t=0===i.cmpn(1)?n:o).cmpn(0)<0&&t.iadd(e),t},k.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),i=e.clone();t.negative=0;for(var r=i.negative=0;t.isEven()&&i.isEven();r++)t.iushrn(1),i.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;i.isEven();)i.iushrn(1);var n=t.cmp(i);if(n<0)var o=t,t=i,i=o;else if(0===n||0===i.cmpn(1))break;t.isub(i)}return i.iushln(r)},k.prototype.invm=function(e){return this.egcd(e).a.umod(e)},k.prototype.isEven=function(){return 0==(1&this.words[0])},k.prototype.isOdd=function(){return 1==(1&this.words[0])},k.prototype.andln=function(e){return this.words[0]&e},k.prototype.bincn=function(e){O("number"==typeof e);var t=e%26,e=(e-t)/26,t=1<<t;if(this.length<=e)this._expand(1+e),this.words[e]|=t;else{for(var i=t,r=e;0!==i&&r<this.length;r++){var n=0|this.words[r],i=(n+=i)>>>26;n&=67108863,this.words[r]=n}0!==i&&(this.words[r]=i,this.length++)}return this},k.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},k.prototype.cmpn=function(e){var t=e<0;return 0===this.negative||t?0===this.negative&&t?1:(this.strip(),t=1<this.length?1:(O((e=t?-e:e)<=67108863,"Number is too big"),(t=0|this.words[0])===e?0:t<e?-1:1),0!==this.negative?0|-t:t):-1},k.prototype.cmp=function(e){return 0!==this.negative&&0===e.negative?-1:0===this.negative&&0!==e.negative?1:(e=this.ucmp(e),0!==this.negative?0|-e:e)},k.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,i=this.length-1;0<=i;i--){var r=0|this.words[i],n=0|e.words[i];if(r!=n){r<n?t=-1:n<r&&(t=1);break}}return t},k.prototype.gtn=function(e){return 1===this.cmpn(e)},k.prototype.gt=function(e){return 1===this.cmp(e)},k.prototype.gten=function(e){return 0<=this.cmpn(e)},k.prototype.gte=function(e){return 0<=this.cmp(e)},k.prototype.ltn=function(e){return-1===this.cmpn(e)},k.prototype.lt=function(e){return-1===this.cmp(e)},k.prototype.lten=function(e){return this.cmpn(e)<=0},k.prototype.lte=function(e){return this.cmp(e)<=0},k.prototype.eqn=function(e){return 0===this.cmpn(e)},k.prototype.eq=function(e){return 0===this.cmp(e)},k.red=function(e){return new x(e)},k.prototype.toRed=function(e){return O(!this.red,"Already a number in reduction context"),O(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},k.prototype.fromRed=function(){return O(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},k.prototype._forceRed=function(e){return this.red=e,this},k.prototype.forceRed=function(e){return O(!this.red,"Already a number in reduction context"),this._forceRed(e)},k.prototype.redAdd=function(e){return O(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},k.prototype.redIAdd=function(e){return O(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},k.prototype.redSub=function(e){return O(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},k.prototype.redISub=function(e){return O(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},k.prototype.redShl=function(e){return O(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},k.prototype.redMul=function(e){return O(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},k.prototype.redIMul=function(e){return O(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},k.prototype.redSqr=function(){return O(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},k.prototype.redISqr=function(){return O(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},k.prototype.redSqrt=function(){return O(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},k.prototype.redInvm=function(){return O(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},k.prototype.redNeg=function(){return O(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},k.prototype.redPow=function(e){return O(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var Zs={k256:null,p224:null,p192:null,p25519:null};function $s(e,t){this.name=e,this.p=new k(t,16),this.n=this.p.bitLength(),this.k=new k(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function Xs(){$s.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function Qs(){$s.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function ea(){$s.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function ta(){$s.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function x(e){var t;"string"==typeof e?(t=k._prime(e),this.m=t.p,this.prime=t):(O(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null)}function ia(e){x.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new k(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}$s.prototype._tmp=function(){var e=new k(null);return e.words=new Array(Math.ceil(this.n/13)),e},$s.prototype.ireduce=function(e){for(var t,i=e;this.split(i,this.tmp),(t=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength())>this.n;);e=t<this.n?-1:i.ucmp(this.p);return 0===e?(i.words[0]=0,i.length=1):0<e?i.isub(this.p):void 0!==i.strip?i.strip():i._strip(),i},$s.prototype.split=function(e,t){e.iushrn(this.n,0,t)},$s.prototype.imulK=function(e){return e.imul(this.k)},Us(Xs,$s),Xs.prototype.split=function(e,t){for(var i=Math.min(e.length,9),r=0;r<i;r++)t.words[r]=e.words[r];if(t.length=i,e.length<=9)e.words[0]=0,e.length=1;else{var n=e.words[9];for(t.words[t.length++]=4194303&n,r=10;r<e.length;r++){var o=0|e.words[r];e.words[r-10]=(4194303&o)<<4|n>>>22,n=o}0===(e.words[r-10]=n>>>=22)&&10<e.length?e.length-=10:e.length-=9}},Xs.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,i=0;i<e.length;i++){var r=0|e.words[i];t+=977*r,e.words[i]=67108863&t,t=64*r+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1])&&e.length--,e},Us(Qs,$s),Us(ea,$s),Us(ta,$s),ta.prototype.imulK=function(e){for(var t=0,i=0;i<e.length;i++){var r=19*(0|e.words[i])+t,n=67108863&r;r>>>=26,e.words[i]=n,t=r}return 0!==t&&(e.words[e.length++]=t),e},k._prime=function(e){if(Zs[e])return Zs[e];var t;if("k256"===e)t=new Xs;else if("p224"===e)t=new Qs;else if("p192"===e)t=new ea;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new ta}return Zs[e]=t},x.prototype._verify1=function(e){O(0===e.negative,"red works only with positives"),O(e.red,"red works only with red numbers")},x.prototype._verify2=function(e,t){O(0==(e.negative|t.negative),"red works only with positives"),O(e.red&&e.red===t.red,"red works only with red numbers")},x.prototype.imod=function(e){return(this.prime?this.prime.ireduce(e):e.umod(this.m))._forceRed(this)},x.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},x.prototype.add=function(e,t){this._verify2(e,t);e=e.add(t);return 0<=e.cmp(this.m)&&e.isub(this.m),e._forceRed(this)},x.prototype.iadd=function(e,t){this._verify2(e,t);e=e.iadd(t);return 0<=e.cmp(this.m)&&e.isub(this.m),e},x.prototype.sub=function(e,t){this._verify2(e,t);e=e.sub(t);return e.cmpn(0)<0&&e.iadd(this.m),e._forceRed(this)},x.prototype.isub=function(e,t){this._verify2(e,t);e=e.isub(t);return e.cmpn(0)<0&&e.iadd(this.m),e},x.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},x.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},x.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},x.prototype.isqr=function(e){return this.imul(e,e.clone())},x.prototype.sqr=function(e){return this.mul(e,e)},x.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(O(t%2==1),3===t)return t=this.m.add(new k(1)).iushrn(2),this.pow(e,t);for(var i=this.m.subn(1),r=0;!i.isZero()&&0===i.andln(1);)r++,i.iushrn(1);O(!i.isZero());for(var n=new k(1).toRed(this),o=n.redNeg(),s=this.m.subn(1).iushrn(1),a=new k(2*(a=this.m.bitLength())*a).toRed(this);0!==this.pow(a,s).cmp(o);)a.redIAdd(o);for(var h=this.pow(a,i),u=this.pow(e,i.addn(1).iushrn(1)),c=this.pow(e,i),p=r;0!==c.cmp(n);){for(var d=c,l=0;0!==d.cmp(n);l++)d=d.redSqr();O(l<p);var f=this.pow(h,new k(1).iushln(p-l-1)),u=u.redMul(f),h=f.redSqr(),c=c.redMul(h),p=l}return u},x.prototype.invm=function(e){e=e._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},x.prototype.pow=function(e,t){if(t.isZero())return new k(1).toRed(this);if(0===t.cmpn(1))return e.clone();var i=new Array(16);i[0]=new k(1).toRed(this),i[1]=e;for(var r=2;r<i.length;r++)i[r]=this.mul(i[r-1],e);var n=i[0],o=0,s=0,a=t.bitLength()%26;for(0===a&&(a=26),r=t.length-1;0<=r;r--){for(var h=t.words[r],u=a-1;0<=u;u--){var c=h>>u&1;n!==i[0]&&(n=this.sqr(n)),0==c&&0===o?s=0:(o=o<<1|c,(4===++s||0===r&&0===u)&&(n=this.mul(n,i[o]),o=s=0))}a=26}return n},x.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},x.prototype.convertFrom=function(e){e=e.clone();return e.red=null,e},k.mont=function(e){return new ia(e)},Us(ia,x),ia.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},ia.prototype.convertFrom=function(e){e=this.imod(e.mul(this.rinv));return e.red=null,e},ia.prototype.imul=function(e,t){return e.isZero()||t.isZero()?(e.words[0]=0,e.length=1,e):(t=(e=e.imul(t)).maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),0<=(t=e=e.isub(t).iushrn(this.shift)).cmp(this.m)?t=e.isub(this.m):e.cmpn(0)<0&&(t=e.iadd(this.m)),t._forceRed(this))},ia.prototype.mul=function(e,t){return(e.isZero()||t.isZero()?new k(0):(t=(e=e.mul(t)).maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),0<=(t=e=e.isub(t).iushrn(this.shift)).cmp(this.m)?t=e.isub(this.m):e.cmpn(0)<0&&(t=e.iadd(this.m)),t))._forceRed(this)},ia.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)};var ra,C={},Dr={},e="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e},R=e,M=Ur(Object.freeze({__proto__:null,default:R})),na=E,oa=na.Buffer,sa={};for(ra in na)na.hasOwnProperty(ra)&&"SlowBuffer"!==ra&&"Buffer"!==ra&&(sa[ra]=na[ra]);var aa=sa.Buffer={};for(ra in oa)oa.hasOwnProperty(ra)&&"allocUnsafe"!==ra&&"allocUnsafeSlow"!==ra&&(aa[ra]=oa[ra]);if(sa.Buffer.prototype=oa.prototype,aa.from&&aa.from!==Uint8Array.from||(aa.from=function(e,t,i){if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type '+typeof e);if(e&&void 0===e.length)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);return oa(e,t,i)}),aa.alloc||(aa.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError('The "size" argument must be of type number. Received type '+typeof e);if(e<0||2*(1<<30)<=e)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=oa(e);return t&&0!==t.length?"string"==typeof i?e.fill(t,i):e.fill(t):e.fill(0),e}),!sa.kStringMaxLength)try{sa.kStringMaxLength=Nr.binding("buffer").kStringMaxLength}catch(e){}sa.constants||(sa.constants={MAX_LENGTH:sa.kMaxLength},sa.kStringMaxLength&&(sa.constants.MAX_STRING_LENGTH=sa.kStringMaxLength));xr=sa,e={},R=M;function ha(e){this._reporterState={obj:null,path:[],options:e||{},errors:[]}}function ua(e,t){this.path=e,this.rethrow(t)}(e.Reporter=ha).prototype.isError=function(e){return e instanceof ua},ha.prototype.save=function(){var e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}},ha.prototype.restore=function(e){var t=this._reporterState;t.obj=e.obj,t.path=t.path.slice(0,e.pathLen)},ha.prototype.enterKey=function(e){return this._reporterState.path.push(e)},ha.prototype.exitKey=function(e){var t=this._reporterState;t.path=t.path.slice(0,e-1)},ha.prototype.leaveKey=function(e,t,i){var r=this._reporterState;this.exitKey(e),null!==r.obj&&(r.obj[t]=i)},ha.prototype.path=function(){return this._reporterState.path.join("/")},ha.prototype.enterObject=function(){var e=this._reporterState,t=e.obj;return e.obj={},t},ha.prototype.leaveObject=function(e){var t=this._reporterState,i=t.obj;return t.obj=e,i},ha.prototype.error=function(e){let t;var i=this._reporterState,r=e instanceof ua;if(t=r?e:new ua(i.path.map(function(e){return"["+JSON.stringify(e)+"]"}).join(""),e.message||e,e.stack),i.options.partial)return r||i.errors.push(t),t;throw t},ha.prototype.wrapResult=function(e){var t=this._reporterState;return t.options.partial?{result:this.isError(e)?null:e,errors:t.errors}:e},R(ua,Error),ua.prototype.rethrow=function(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,ua),!this.stack)try{throw new Error(this.message)}catch(e){this.stack=e.stack}return this};E={},R=M;const ca=e.Reporter,pa=xr.Buffer;function da(e,t){ca.call(this,t),pa.isBuffer(e)?(this.base=e,this.offset=0,this.length=e.length):this.error("Input not Buffer")}function la(e,t){if(Array.isArray(e))this.length=0,this.value=e.map(function(e){return la.isEncoderBuffer(e)||(e=new la(e,t)),this.length+=e.length,e},this);else if("number"==typeof e){if(!(0<=e&&e<=255))return t.error("non-byte EncoderBuffer value");this.value=e,this.length=1}else if("string"==typeof e)this.value=e,this.length=pa.byteLength(e);else{if(!pa.isBuffer(e))return t.error("Unsupported type: "+typeof e);this.value=e,this.length=e.length}}R(da,ca),(E.DecoderBuffer=da).isDecoderBuffer=function(e){return e instanceof da||"object"==typeof e&&pa.isBuffer(e.base)&&"DecoderBuffer"===e.constructor.name&&"number"==typeof e.offset&&"number"==typeof e.length&&"function"==typeof e.save&&"function"==typeof e.restore&&"function"==typeof e.isEmpty&&"function"==typeof e.readUInt8&&"function"==typeof e.skip&&"function"==typeof e.raw},da.prototype.save=function(){return{offset:this.offset,reporter:ca.prototype.save.call(this)}},da.prototype.restore=function(e){var t=new da(this.base);return t.offset=e.offset,t.length=this.offset,this.offset=e.offset,ca.prototype.restore.call(this,e.reporter),t},da.prototype.isEmpty=function(){return this.offset===this.length},da.prototype.readUInt8=function(e){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(e||"DecoderBuffer overrun")},da.prototype.skip=function(e,t){var i;return this.offset+e<=this.length?((i=new da(this.base))._reporterState=this._reporterState,i.offset=this.offset,i.length=this.offset+e,this.offset+=e,i):this.error(t||"DecoderBuffer overrun")},da.prototype.raw=function(e){return this.base.slice((e||this).offset,this.length)},(E.EncoderBuffer=la).isEncoderBuffer=function(e){return e instanceof la||"object"==typeof e&&"EncoderBuffer"===e.constructor.name&&"number"==typeof e.length&&"function"==typeof e.join},la.prototype.join=function(t,i){return t=t||pa.alloc(this.length),i=i||0,0!==this.length&&(Array.isArray(this.value)?this.value.forEach(function(e){e.join(t,i),i+=e.length}):("number"==typeof this.value?t[i]=this.value:"string"==typeof this.value?t.write(this.value,i):pa.isBuffer(this.value)&&this.value.copy(t,i),i+=this.length)),t};R=fa;function fa(e,t){if(!e)throw new Error(t||"Assertion failed")}fa.equal=function(e,t,i){if(e!=t)throw new Error(i||"Assertion failed: "+e+" != "+t)};const va=e.Reporter,ga=E.EncoderBuffer,ma=E.DecoderBuffer,ya=R;R=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"];const Sa=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(R);function D(e,t,i){var r={};(this._baseState=r).name=i,r.enc=e,r.parent=t||null,r.children=null,r.tag=null,r.args=null,r.reverseArgs=null,r.choice=null,r.optional=!1,r.any=!1,r.obj=!1,r.use=null,r.useDecoder=null,r.key=null,r.default=null,r.explicit=null,r.implicit=null,r.contains=null,r.parent||(r.children=[],this._wrap())}var wa=D;const ba=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];D.prototype.clone=function(){const t=this._baseState,i={};ba.forEach(function(e){i[e]=t[e]});var e=new this.constructor(i.parent);return e._baseState=i,e},D.prototype._wrap=function(){const i=this._baseState;Sa.forEach(function(t){this[t]=function(){var e=new this.constructor(this);return i.children.push(e),e[t].apply(e,arguments)}},this)},D.prototype._init=function(e){var t=this._baseState;ya(null===t.parent),e.call(this),t.children=t.children.filter(function(e){return e._baseState.parent===this},this),ya.equal(t.children.length,1,"Root node can have only one child")},D.prototype._useArgs=function(e){var t=this._baseState,i=e.filter(function(e){return e instanceof this.constructor},this);e=e.filter(function(e){return!(e instanceof this.constructor)},this),0!==i.length&&(ya(null===t.children),(t.children=i).forEach(function(e){e._baseState.parent=this},this)),0!==e.length&&(ya(null===t.args),t.args=e,t.reverseArgs=e.map(function(i){if("object"!=typeof i||i.constructor!==Object)return i;const r={};return Object.keys(i).forEach(function(e){e==(0|e)&&(e|=0);var t=i[e];r[t]=e}),r}))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach(function(t){D.prototype[t]=function(){var e=this._baseState;throw new Error(t+" not implemented for encoding: "+e.enc)}}),R.forEach(function(i){D.prototype[i]=function(){var e=this._baseState,t=Array.prototype.slice.call(arguments);return ya(null===e.tag),e.tag=i,this._useArgs(t),this}}),D.prototype.use=function(e){ya(e);var t=this._baseState;return ya(null===t.use),t.use=e,this},D.prototype.optional=function(){return this._baseState.optional=!0,this},D.prototype.def=function(e){var t=this._baseState;return ya(null===t.default),t.default=e,t.optional=!0,this},D.prototype.explicit=function(e){var t=this._baseState;return ya(null===t.explicit&&null===t.implicit),t.explicit=e,this},D.prototype.implicit=function(e){var t=this._baseState;return ya(null===t.explicit&&null===t.implicit),t.implicit=e,this},D.prototype.obj=function(){var e=this._baseState,t=Array.prototype.slice.call(arguments);return e.obj=!0,0!==t.length&&this._useArgs(t),this},D.prototype.key=function(e){var t=this._baseState;return ya(null===t.key),t.key=e,this},D.prototype.any=function(){return this._baseState.any=!0,this},D.prototype.choice=function(t){var e=this._baseState;return ya(null===e.choice),e.choice=t,this._useArgs(Object.keys(t).map(function(e){return t[e]})),this},D.prototype.contains=function(e){var t=this._baseState;return ya(null===t.use),t.contains=e,this},D.prototype._decode=function(t,i){var r=this._baseState;if(null===r.parent)return t.wrapResult(r.children[0]._decode(t,i));let n=r.default,o=!0,e=null;if(null!==r.key&&(e=t.enterKey(r.key)),r.optional){let e=null;if(null!==r.explicit?e=r.explicit:null!==r.implicit?e=r.implicit:null!==r.tag&&(e=r.tag),null!==e||r.any){if(o=this._peekTag(t,e,r.any),t.isError(o))return o}else{var s=t.save();try{null===r.choice?this._decodeGeneric(r.tag,t,i):this._decodeChoice(t,i),o=!0}catch(e){o=!1}t.restore(s)}}let a;if(r.obj&&o&&(a=t.enterObject()),o){if(null!==r.explicit){s=this._decodeTag(t,r.explicit);if(t.isError(s))return s;t=s}s=t.offset;if(null===r.use&&null===r.choice){let e;r.any&&(e=t.save());var h=this._decodeTag(t,null!==r.implicit?r.implicit:r.tag,r.any);if(t.isError(h))return h;r.any?n=t.raw(e):t=h}if(i&&i.track&&null!==r.tag&&i.track(t.path(),s,t.length,"tagged"),i&&i.track&&null!==r.tag&&i.track(t.path(),t.offset,t.length,"content"),r.any||(n=null===r.choice?this._decodeGeneric(r.tag,t,i):this._decodeChoice(t,i)),t.isError(n))return n;r.any||null!==r.choice||null===r.children||r.children.forEach(function(e){e._decode(t,i)}),!r.contains||"octstr"!==r.tag&&"bitstr"!==r.tag||(h=new ma(n),n=this._getUse(r.contains,t._reporterState.obj)._decode(h,i))}return r.obj&&o&&(n=t.leaveObject(a)),null===r.key||null===n&&!0!==o?null!==e&&t.exitKey(e):t.leaveKey(e,r.key,n),n},D.prototype._decodeGeneric=function(e,t,i){var r=this._baseState;return"seq"===e||"set"===e?null:"seqof"===e||"setof"===e?this._decodeList(t,e,r.args[0],i):/str$/.test(e)?this._decodeStr(t,e,i):"objid"===e&&r.args?this._decodeObjid(t,r.args[0],r.args[1],i):"objid"===e?this._decodeObjid(t,null,null,i):"gentime"===e||"utctime"===e?this._decodeTime(t,e,i):"null_"===e?this._decodeNull(t,i):"bool"===e?this._decodeBool(t,i):"objDesc"===e?this._decodeStr(t,e,i):"int"===e||"enum"===e?this._decodeInt(t,r.args&&r.args[0],i):null!==r.use?this._getUse(r.use,t._reporterState.obj)._decode(t,i):t.error("unknown tag: "+e)},D.prototype._getUse=function(e,t){var i=this._baseState;return i.useDecoder=this._use(e,t),ya(null===i.useDecoder._baseState.parent),i.useDecoder=i.useDecoder._baseState.children[0],i.implicit!==i.useDecoder._baseState.implicit&&(i.useDecoder=i.useDecoder.clone(),i.useDecoder._baseState.implicit=i.implicit),i.useDecoder},D.prototype._decodeChoice=function(n,o){const s=this._baseState;let a=null,h=!1;return Object.keys(s.choice).some(function(e){var t=n.save(),i=s.choice[e];try{var r=i._decode(n,o);if(n.isError(r))return!1;a={type:e,value:r},h=!0}catch(e){return n.restore(t),!1}return!0},this),h?a:n.error("Choice not matched")},D.prototype._createEncoderBuffer=function(e){return new ga(e,this.reporter)},D.prototype._encode=function(e,t,i){var r=this._baseState;if(null===r.default||r.default!==e){r=this._encodeValue(e,t,i);if(void 0!==r&&!this._skipDefault(r,t,i))return r}},D.prototype._encodeValue=function(i,r,e){var t=this._baseState;if(null===t.parent)return t.children[0]._encode(i,r||new va);let n=null;if(this.reporter=r,t.optional&&void 0===i){if(null===t.default)return;i=t.default}let o=null,s=!1;if(t.any)n=this._createEncoderBuffer(i);else if(t.choice)n=this._encodeChoice(i,r);else if(t.contains)o=this._getUse(t.contains,e)._encode(i,r),s=!0;else if(t.children)o=t.children.map(function(e){var t;return"null_"===e._baseState.tag?e._encode(null,r,i):null===e._baseState.key?r.error("Child should have a key"):(t=r.enterKey(e._baseState.key),"object"!=typeof i?r.error("Child expected, but input is not object"):(e=e._encode(i[e._baseState.key],r,i),r.leaveKey(t),e))},this).filter(function(e){return e}),o=this._createEncoderBuffer(o);else if("seqof"===t.tag||"setof"===t.tag){if(!t.args||1!==t.args.length)return r.error("Too many args for : "+t.tag);if(!Array.isArray(i))return r.error("seqof/setof, but data is not Array");var a=this.clone();a._baseState.implicit=null,o=this._createEncoderBuffer(i.map(function(e){var t=this._baseState;return this._getUse(t.args[0],i)._encode(e,r)},a))}else null!==t.use?n=this._getUse(t.use,e)._encode(i,r):(o=this._encodePrimitive(t.tag,i),s=!0);return t.any||null!==t.choice||(a=null!==t.implicit?t.implicit:t.tag,e=null===t.implicit?"universal":"context",null===a?null===t.use&&r.error("Tag could be omitted only for .use()"):null===t.use&&(n=this._encodeComposite(a,s,e,o))),n=null!==t.explicit?this._encodeComposite(t.explicit,!1,"context",n):n},D.prototype._encodeChoice=function(e,t){var i=this._baseState,r=i.choice[e.type];return r||ya(!1,e.type+" not found in "+JSON.stringify(Object.keys(i.choice))),r._encode(e.value,t)},D.prototype._encodePrimitive=function(e,t){var i=this._baseState;if(/str$/.test(e))return this._encodeStr(t,e);if("objid"===e&&i.args)return this._encodeObjid(t,i.reverseArgs[0],i.args[1]);if("objid"===e)return this._encodeObjid(t,null,null);if("gentime"===e||"utctime"===e)return this._encodeTime(t,e);if("null_"===e)return this._encodeNull();if("int"===e||"enum"===e)return this._encodeInt(t,i.args&&i.reverseArgs[0]);if("bool"===e)return this._encodeBool(t);if("objDesc"===e)return this._encodeStr(t,e);throw new Error("Unsupported tag: "+e)},D.prototype._isNumstr=function(e){return/^[0-9 ]*$/.test(e)},D.prototype._isPrintstr=function(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/.test(e)};R={};function Ca(i){const r={};return Object.keys(i).forEach(function(e){(0|e)==e&&(e|=0);var t=i[e];r[t]=e}),r}(Ra=R).tagClass={0:"universal",1:"application",2:"context",3:"private"},Ra.tagClassByName=Ca(Ra.tagClass),Ra.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},Ra.tagByName=Ca(Ra.tag);var Ra=M;const Ma=xr.Buffer,Ea=wa,Pa=R;function Aa(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new _a,this.tree._init(e.body)}var Ia=Aa;function _a(e){Ea.call(this,"der",e)}function Ta(e){return e<10?"0"+e:e}Aa.prototype.encode=function(e,t){return this.tree._encode(e,t).join()},Ra(_a,Ea),_a.prototype._encodeComposite=function(e,t,i,r){e=function(e,t,i,r){let n;"seqof"===e?e="seq":"setof"===e&&(e="set");if(Pa.tagByName.hasOwnProperty(e))n=Pa.tagByName[e];else{if("number"!=typeof e||(0|e)!==e)return r.error("Unknown tag: "+e);n=e}if(31<=n)return r.error("Multi-octet tag encoding unsupported");t||(n|=32);return n|=Pa.tagClassByName[i||"universal"]<<6}(e,t,i,this.reporter);if(r.length<128){const o=Ma.alloc(2);return o[0]=e,o[1]=r.length,this._createEncoderBuffer([o,r])}let n=1;for(let e=r.length;256<=e;e>>=8)n++;const o=Ma.alloc(2+n);o[0]=e,o[1]=128|n;for(let e=1+n,t=r.length;0<t;e--,t>>=8)o[e]=255&t;return this._createEncoderBuffer([o,r])},_a.prototype._encodeStr=function(t,e){if("bitstr"===e)return this._createEncoderBuffer([0|t.unused,t.data]);if("bmpstr"!==e)return"numstr"===e?this._isNumstr(t)?this._createEncoderBuffer(t):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===e?this._isPrintstr(t)?this._createEncoderBuffer(t):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(e)||"objDesc"===e?this._createEncoderBuffer(t):this.reporter.error("Encoding of string type: "+e+" unsupported");var i=Ma.alloc(2*t.length);for(let e=0;e<t.length;e++)i.writeUInt16BE(t.charCodeAt(e),2*e);return this._createEncoderBuffer(i)},_a.prototype._encodeObjid=function(i,e,t){if("string"==typeof i){if(!e)return this.reporter.error("string objid given, but no values map found");if(!e.hasOwnProperty(i))return this.reporter.error("objid not found in values map");i=e[i].split(/[\s.]+/g);for(let e=0;e<i.length;e++)i[e]|=0}else if(Array.isArray(i)){i=i.slice();for(let e=0;e<i.length;e++)i[e]|=0}if(!Array.isArray(i))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(i));if(!t){if(40<=i[1])return this.reporter.error("Second objid identifier OOB");i.splice(0,2,40*i[0]+i[1])}let r=0;for(let t=0;t<i.length;t++){let e=i[t];for(r++;128<=e;e>>=7)r++}var n=Ma.alloc(r);let o=n.length-1;for(let t=i.length-1;0<=t;t--){let e=i[t];for(n[o--]=127&e;0<(e>>=7);)n[o--]=128|127&e}return this._createEncoderBuffer(n)},_a.prototype._encodeTime=function(e,t){let i;e=new Date(e);return"gentime"===t?i=[Ta(e.getUTCFullYear()),Ta(e.getUTCMonth()+1),Ta(e.getUTCDate()),Ta(e.getUTCHours()),Ta(e.getUTCMinutes()),Ta(e.getUTCSeconds()),"Z"].join(""):"utctime"===t?i=[Ta(e.getUTCFullYear()%100),Ta(e.getUTCMonth()+1),Ta(e.getUTCDate()),Ta(e.getUTCHours()),Ta(e.getUTCMinutes()),Ta(e.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+t+" time is not supported yet"),this._encodeStr(i,"octstr")},_a.prototype._encodeNull=function(){return this._createEncoderBuffer("")},_a.prototype._encodeInt=function(t,e){if("string"==typeof t){if(!e)return this.reporter.error("String int or enum given, but no values map");if(!e.hasOwnProperty(t))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(t));t=e[t]}if("number"==typeof t||Ma.isBuffer(t)||(e=t.toArray(),!t.sign&&128&e[0]&&e.unshift(0),t=Ma.from(e)),Ma.isBuffer(t)){let e=t.length;0===t.length&&e++;const r=Ma.alloc(e);return t.copy(r),0===t.length&&(r[0]=0),this._createEncoderBuffer(r)}if(t<128)return this._createEncoderBuffer(t);if(t<256)return this._createEncoderBuffer([0,t]);let i=1;for(let e=t;256<=e;e>>=8)i++;const r=new Array(i);for(let e=r.length-1;0<=e;e--)r[e]=255&t,t>>=8;return 128&r[0]&&r.unshift(0),this._createEncoderBuffer(Ma.from(r))},_a.prototype._encodeBool=function(e){return this._createEncoderBuffer(e?255:0)},_a.prototype._use=function(e,t){return(e="function"==typeof e?e(t):e)._getEncoder("der").tree},_a.prototype._skipDefault=function(e,t,i){var r=this._baseState;let n;if(null===r.default)return!1;var o=e.join();if(void 0===r.defaultBuffer&&(r.defaultBuffer=this._encodeValue(r.default,t,i).join()),o.length!==r.defaultBuffer.length)return!1;for(n=0;n<o.length;n++)if(o[n]!==r.defaultBuffer[n])return!1;return!0};const Oa=Ia;function ka(e){Oa.call(this,e),this.enc="pem"}M(ka,Oa);var Ra=ka,Ia=(ka.prototype.encode=function(e,t){var i=Oa.prototype.encode.call(this,e).toString("base64"),r=["-----BEGIN "+t.label+"-----"];for(let e=0;e<i.length;e+=64)r.push(i.slice(e,e+64));return r.push("-----END "+t.label+"-----"),r.join("\n")},(xa=Dr).der=Ia,xa.pem=Ra,{}),xa=M;const Da=Or.exports,Ba=E.DecoderBuffer,La=wa,za=R;function Na(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new Ua,this.tree._init(e.body)}Ra=Na;function Ua(e){La.call(this,"der",e)}function qa(t,i){let r=t.readUInt8(i);if(t.isError(r))return r;var e=za.tagClass[r>>6],n=0==(32&r);if(31==(31&r)){let e=r;for(r=0;128==(128&e);){if(e=t.readUInt8(i),t.isError(e))return e;r=(r<<=7)|127&e}}else r&=31;var o=za.tag[r];return{cls:e,primitive:n,tag:r,tagStr:o}}function Fa(t,e,i){let r=t.readUInt8(i);if(!t.isError(r)){if(!e&&128===r)return null;if(0!=(128&r)){var n=127&r;if(4<n)return t.error("length octect is too long");for(let e=r=0;e<n;e++){r<<=8;var o=t.readUInt8(i);if(t.isError(o))return o;r|=o}}}return r}Na.prototype.decode=function(e,t){return Ba.isDecoderBuffer(e)||(e=new Ba(e,t)),this.tree._decode(e,t)},xa(Ua,La),Ua.prototype._peekTag=function(e,t,i){var r,n;return!e.isEmpty()&&(r=e.save(),n=qa(e,'Failed to peek tag: "'+t+'"'),e.isError(n)?n:(e.restore(r),n.tag===t||n.tagStr===t||n.tagStr+"of"===t||i))},Ua.prototype._decodeTag=function(e,t,i){var r=qa(e,'Failed to decode tag of "'+t+'"');if(e.isError(r))return r;var n=Fa(e,r.primitive,'Failed to get length of "'+t+'"');if(e.isError(n))return n;if(!i&&r.tag!==t&&r.tagStr!==t&&r.tagStr+"of"!==t)return e.error('Failed to match tag: "'+t+'"');if(!r.primitive&&null===n){i=e.save(),r=this._skipUntilEnd(e,'Failed to skip indefinite length body: "'+this.tag+'"');if(e.isError(r))return r;n=e.offset-i.offset,e.restore(i)}return e.skip(n,'Failed to match body of: "'+t+'"')},Ua.prototype._skipUntilEnd=function(t,i){for(;;){var r=qa(t,i);if(t.isError(r))return r;var n=Fa(t,r.primitive,i);if(t.isError(n))return n;let e;if(e=r.primitive||null!==n?t.skip(n):this._skipUntilEnd(t,i),t.isError(e))return e;if("end"===r.tagStr)break}},Ua.prototype._decodeList=function(e,t,i,r){for(var n=[];!e.isEmpty();){var o=this._peekTag(e,"end");if(e.isError(o))return o;var s=i.decode(e,"der",r);if(e.isError(s)&&o)break;n.push(s)}return n},Ua.prototype._decodeStr=function(e,t){var i;if("bitstr"===t)return i=e.readUInt8(),e.isError(i)?i:{unused:i,data:e.raw()};if("bmpstr"!==t)return"numstr"===t?(i=e.raw().toString("ascii"),this._isNumstr(i)?i:e.error("Decoding of string type: numstr unsupported characters")):"octstr"===t||"objDesc"===t?e.raw():"printstr"===t?(i=e.raw().toString("ascii"),this._isPrintstr(i)?i:e.error("Decoding of string type: printstr unsupported characters")):/str$/.test(t)?e.raw().toString():e.error("Decoding of string type: "+t+" unsupported");{var r=e.raw();if(r.length%2==1)return e.error("Decoding of string type: bmpstr length mismatch");let t="";for(let e=0;e<r.length/2;e++)t+=String.fromCharCode(r.readUInt16BE(2*e));return t}},Ua.prototype._decodeObjid=function(e,t,i){let r;var n=[];let o=0,s=0;for(;!e.isEmpty();)s=e.readUInt8(),o=(o<<=7)|127&s,0==(128&s)&&(n.push(o),o=0);if(128&s&&n.push(o),r=i?n:[n[0]/40|0,n[0]%40].concat(n.slice(1)),t){let e=t[r.join(" ")];void 0!==(e=void 0===e?t[r.join(".")]:e)&&(r=e)}return r},Ua.prototype._decodeTime=function(e,t){var i=e.raw().toString();let r,n,o,s,a,h;if("gentime"===t)r=0|i.slice(0,4),n=0|i.slice(4,6),o=0|i.slice(6,8),s=0|i.slice(8,10),a=0|i.slice(10,12),h=0|i.slice(12,14);else{if("utctime"!==t)return e.error("Decoding "+t+" time is not supported yet");r=0|i.slice(0,2),n=0|i.slice(2,4),o=0|i.slice(4,6),s=0|i.slice(6,8),a=0|i.slice(8,10),h=0|i.slice(10,12),r=r<70?2e3+r:1900+r}return Date.UTC(r,n-1,o,s,a,h,0)},Ua.prototype._decodeNull=function(){return null},Ua.prototype._decodeBool=function(e){var t=e.readUInt8();return e.isError(t)?t:0!==t},Ua.prototype._decodeInt=function(e,t){e=e.raw();let i=new Da(e);return i=t?t[i.toString(10)]||i:i},Ua.prototype._use=function(e,t){return(e="function"==typeof e?e(t):e)._getDecoder("der").tree};xa=M;const ja=xr.Buffer,Ka=Ra;function Ha(e){Ka.call(this,e),this.enc="pem"}xa(Ha,Ka);xr=Ha;Ha.prototype.decode=function(e,t){var i=e.toString().split(/[\r\n]+/g),r=t.label.toUpperCase(),n=/^-----(BEGIN|END) ([^-]+)-----$/;let o=-1,s=-1;for(let e=0;e<i.length;e++){var a=i[e].match(n);if(null!==a&&a[2]===r){if(-1!==o){if("END"!==a[1])break;s=e;break}if("BEGIN"!==a[1])break;o=e}}if(-1===o||-1===s)throw new Error("PEM section not found for: "+r);e=i.slice(o+1,s).join(""),e.replace(/[^a-z0-9+/=]+/gi,""),e=ja.from(e,"base64");return Ka.prototype.decode.call(this,e,t)},(xa=Ia).der=Ra,xa.pem=xr;{const gh=Dr,mh=Ia,yh=M;function Wa(e,t){this.name=e,this.body=t,this.decoders={},this.encoders={}}C.define=function(e,t){return new Wa(e,t)},Wa.prototype._createNamed=function(i){const t=this.name;function e(e){this._initNamed(e,t)}return yh(e,i),e.prototype._initNamed=function(e,t){i.call(this,e,t)},new e(this)},Wa.prototype._getDecoder=function(e){return this.decoders.hasOwnProperty(e=e||"der")||(this.decoders[e]=this._createNamed(mh[e])),this.decoders[e]},Wa.prototype.decode=function(e,t,i){return this._getDecoder(t).decode(e,i)},Wa.prototype._getEncoder=function(e){return this.encoders.hasOwnProperty(e=e||"der")||(this.encoders[e]=this._createNamed(gh[e])),this.encoders[e]},Wa.prototype.encode=function(e,t,i){return this._getEncoder(t).encode(e,i)}}var Va,Ga,Ja,Ya,Za,$a,Ra={},xr=((xa=Ra).Reporter=e.Reporter,xa.DecoderBuffer=E.DecoderBuffer,xa.EncoderBuffer=E.EncoderBuffer,xa.Node=wa,{});function Xa(){var a,r,n,o,s,h,u,c,p,d,l,t;return $a||($a=1,jr.Cache=(Fr||(Fr=1,a=Xa(),(qr=e).prototype.filter=function(e,t){t(null)},e.prototype.probe=function(e,t){this.cache.hasOwnProperty(e)?t(null,this.cache[e]):t(null,!1)},e.prototype.store=function(e,t,i,r){this.cache.hasOwnProperty(e)&&clearTimeout(this.cache[e].timer);var n=this;this.cache[e]={response:t,timer:setTimeout(function(){delete n.cache[e]},i)},r(null,null)},e.prototype.request=function(r,t,i){var n=this;function o(e,t){i&&i(e,t),i=null}function s(e,i){if(e)return o(e);o(null,i),n.getMaxStoreTime(i,function(e,t){e||n.store(r,i,t,function(){})})}this.filter(t.url,function(e){if(e)return o(e,null);a.utils.getResponse(t.url,t.ocsp,s)})},e.prototype.getMaxStoreTime=function(e,t){var i;try{i=a.utils.parseResponse(e).value}catch(e){return t(e)}if(0===i.tbsResponseData.responses.length)return t(new Error("No OCSP responses"));var r=i.tbsResponseData.responses;if(!r.every(function(e){return"good"===e.certStatus.type}))return t(new Error("Some OCSP responses are not good"));for(var n=0,o=0;o<r.length;o++){var s=(e=r[o]).nextUpdate;s&&(0===n||s<n)&&(n=s)}return t(null,Math.max(0,n-new Date))}),qr),jr.Agent=Es(),jr.getOCSPURI=(Ps||(Ps=1,r=Xa(),o=n=Ms,As.getOCSPURI=function(e,t){var i=n["id-pkix-ocsp"].join("."),e=r.utils.toDER(e,"CERTIFICATE"),e=o.Certificate.decode(e,"der");r.utils.getAuthorityInfo(e,i,t)}),As.getOCSPURI),jr.request=(Is||(Is=1,s=Xa(),h=Ts,c=u=Ms,_s.generate=function(e,t){var e=e.tbsCertificate?e:c.Certificate.decode(s.utils.toDER(e,"CERTIFICATE"),"der"),t=t.tbsCertificate?t:c.Certificate.decode(s.utils.toDER(t,"CERTIFICATE"),"der"),i=e.tbsCertificate,r=t.tbsCertificate,r={hashAlgorithm:{algorithm:[1,3,14,3,2,26]},issuerNameHash:f(c.Name.encode(i.issuer,"der")),issuerKeyHash:f(r.subjectPublicKeyInfo.subjectPublicKey.data),serialNumber:i.serialNumber},i={tbsRequest:{version:"v1",requestList:[{reqCert:r}],requestExtensions:[{extnID:u["id-pkix-ocsp-nonce"],critical:!1,extnValue:u.Nonce.encode(h.randomBytes(16),"der")}]}};return{id:f(u.CertID.encode(r,"der")),certID:r,data:u.OCSPRequest.encode(i,"der"),cert:e,issuer:t}}),_s),jr.check=(ks||(ks=1,p=Xa(),d=En,l=Bs,t=Ms,Os=function(i,r){var n,o=!0;function s(e,t){o?(o=!1,Nr.nextTick(function(){r(e,t)})):r(e,t)}try{n=p.request.generate(i.cert,i.issuer)}catch(e){return s(e)}var e=t["id-pkix-ocsp"].join(".");p.utils.getAuthorityInfo(n.cert,e,function(e,t){if(e)return s(e);e=void 0!==i.httpOptions?d._extend(i.httpOptions,l.parse(t)):t;p.utils.getResponse(e,n.data,function(e,t){if(e)return s(e);p.verify({request:n,response:t},s)})}),o=!1}),Os),jr.verify=Ls(),jr.utils=Ns),jr;function e(e){this.options=e||{},this.cache={},this.options.probe&&(this.probe=this.options.probe),this.options.store&&(this.store=this.options.store),this.options.filter&&(this.filter=this.options.filter)}function f(e){return h.createHash("sha1").update(e).digest()}}(M=xr)._reverse=function(i){const r={};return Object.keys(i).forEach(function(e){(0|e)==e&&(e|=0);var t=i[e];r[t]=e}),r},M.der=R,(e=kr).bignum=Or.exports,e.define=C.define,e.base=Ra,e.constants=xr,e.decoders=Ia,e.encoders=Dr,Ga=ms,Ja=En,Ya=Bs,E=kr,Za=Ms,(Va=Ns)["id-ad-caIssuers"]=[1,3,6,1,5,5,7,48,2],Va["id-kp-OCSPSigning"]=[1,3,6,1,5,5,7,3,9],Va.getResponse=function(e,t,i){"object"!=typeof e&&(e=Ya.parse(e));e=Ja._extend({method:"POST",headers:{"Content-Type":"application/ocsp-request","Content-Length":t.length}},e);function r(e,t){i&&i(e,t),i=null}Ga.request(e,function(t){if(t.statusCode<200||400<=t.statusCode)return r(new Error("Failed to obtain OCSP response: "+t.statusCode));var i=[];t.on("readable",function(){var e=t.read();e&&i.push(e)}),t.on("end",function(){r(null,v.concat(i))})}).on("error",r).end(t)},Va.parseResponse=function(e){var n={start:0,end:e.length},e=Za.OCSPResponse.decode(e,"der",{track:function(e,t,i,r){"content"===r&&"responseBytes/response"===e&&(n.start=t,n.end=i)}}),t=e.responseStatus;if("successful"!==t)throw new Error("Bad OCSP response status: "+t);t=e.responseBytes.responseType;if("id-pkix-ocsp-basic"!==t)throw new Error("Unknown OCSP response type: "+t);var t=e.responseBytes.response,o={start:n.start,end:n.end},s=[],e=Za.BasicOCSPResponse.decode(t,"der",{track:function(e,t,i,r){"tagged"===r&&("tbsResponseData"===e?(o.start=n.start+t,o.end=n.start+i):"certs/tbsCertificate"===e&&s.push({start:n.start+t,end:n.start+i}))}}),i=Va["id-kp-OCSPSigning"].join("."),t=(e.certs||[]).filter(function(e){return e.tbsCertificate.extensions.some(function(e){return"extendedKeyUsage"===e.extnID&&e.extnValue.some(function(e){return e.join(".")===i})})});return{start:o.start,end:o.end,value:e,certs:t,certsTbs:s}},Va.digest={"1.3.14.3.2.26":"sha1","2.16.840.1.101.3.4.2.1":"sha256"},Va.digestRev={sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1"},Va.sign={"1.2.840.113549.1.1.5":"sha1WithRSAEncryption","1.2.840.113549.1.1.11":"sha256WithRSAEncryption","1.2.840.113549.1.1.12":"sha384WithRSAEncryption","1.2.840.113549.1.1.13":"sha512WithRSAEncryption"},Va.signRev={sha1WithRSAEncryption:[1,2,840,113549,1,1,5],sha256WithRSAEncryption:[1,2,840,113549,1,1,11],sha384WithRSAEncryption:[1,2,840,113549,1,1,12],sha512WithRSAEncryption:[1,2,840,113549,1,1,13]},Va.toPEM=function(e,t){for(var i=e.toString("base64"),r=["-----BEGIN "+t+"-----"],n=0;n<i.length;n+=64)r.push(i.slice(n,n+64));return r.push("-----END "+t+"-----"),r.join("\n")},Va.toDER=function(e,t){t=e.toString().match(new RegExp("-----BEGIN "+t+"-----([^-]*)-----END "+t+"-----"));return t=t?new v(t[1].replace(/[\r\n]/g,""),"base64"):"string"==typeof e?new v(e):e},Va.getAuthorityInfo=function(e,t,i){var r,e=(e.tbsCertificate.extensions||[]).filter(function(e){return"authorityInformationAccess"===e.extnID});return 0===e.length?i(new Error("AuthorityInfoAccess not found in extensions")):(r=null,e.some(function(e){return e.extnValue.some(function(e){return e.accessMethod.join(".")===t&&"uniformResourceIdentifier"===(e=e.accessLocation).type&&(r=e.value+"",!0)})})?i(null,r):i(new Error(t+" not found in AuthorityInfoAccess")))},E=E.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())}),Va.RSAPrivateKey=E;var Qa=Xa(),eh=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class B{constructor(e){e&&(this.privProxyInfo=e),B.privDiskCache||(B.privDiskCache=new gr("microsoft-cognitiveservices-speech-sdk-cache",{supportBuffer:!0,location:void 0!==Nr&&Nr.env.SPEECH_OCSP_CACHE_ROOT?Nr.env.SPEECH_OCSP_CACHE_ROOT:void 0}))}static forceReinitDiskCache(){B.privDiskCache=void 0,B.privMemCache={}}GetAgent(e){var t=new gr.Agent(this.CreateConnection);return void 0!==this.privProxyInfo&&void 0!==this.privProxyInfo.HostName&&0<this.privProxyInfo.Port&&(t.privProxyInfo=this.privProxyInfo),t}static GetProxyAgent(e){var t={host:e.HostName,port:e.Port},e=(e.UserName?t.headers={"Proxy-Authentication":"Basic "+new v(e.UserName+":"+(void 0===e.Password?"":e.Password)).toString("base64")}:t.headers={},t.headers.requestOCSP="true",new gr(t));return e}static OCSPCheck(e,p){return eh(this,void 0,void 0,function*(){let s,a,h=!1;const u=yield e,c=(u.cork(),u);return new Promise((n,o)=>{u.on("OCSPResponse",e=>{e&&(this.onEvent(new ke),a=e)}),u.on("error",e=>{h||(h=!0,u.destroy(),o(e))}),c.on("secure",()=>eh(this,void 0,void 0,function*(){var e=c.getPeerCertificate(!0);try{var t,i=yield this.GetIssuer(e),r=(s=Qa.request.generate(e.raw,i.raw)).id.toString("hex");a||(t=yield B.GetResponseFromCache(r,s,p),a=t),yield this.VerifyOCSPResponse(a,s,p),u.uncork(),h=!0,n(u)}catch(e){u.destroy(),h=!0,o(e)}}))})})}static GetIssuer(e){return e.issuerCertificate?Promise.resolve(e.issuerCertificate):new Promise((i,r)=>{new Qa.Agent({}).fetchIssuer(e,null,(e,t)=>{e?r(e):i(t)})})}static GetResponseFromCache(s,a,h){return eh(this,void 0,void 0,function*(){let t=B.privMemCache[s];if(t&&this.onEvent(new Ee(s)),!t)try{var e=yield B.privDiskCache.get(s);e.isCached&&(B.onEvent(new Ae(s)),B.StoreMemoryCacheEntry(s,e.value),t=e.value)}catch(e){t=null}if(t){try{var i=Qa.utils.parseResponse(t).value.tbsResponseData;if(i.responses.length<1)return void this.onEvent(new ze(s,"Not enough data in cached response"));var r,n=i.responses[0].thisUpdate,o=i.responses[0].nextUpdate;o<Date.now()+this.testTimeOffset-6e4?(this.onEvent(new xe(s,o)),t=null):(r=Math.min(864e5,(o-n)/2),o-(Date.now()+this.testTimeOffset)<r?(this.onEvent(new De(s,n,o)),this.UpdateCache(a,h).catch(e=>{this.onEvent(new Ue(s,e.toString()))})):this.onEvent(new Be(s,n,o)))}catch(e){this.onEvent(new ze(s,e)),t=null}t||this.onEvent(new Pe(s))}return t})}static VerifyOCSPResponse(n,o,s){return eh(this,void 0,void 0,function*(){let r=n;return r=r||(yield B.GetOCSPResponse(o,s)),new Promise((t,i)=>{Qa.verify({request:o,response:r},e=>{e?(B.onEvent(new Le(o.id.toString("hex"),e)),n?this.VerifyOCSPResponse(null,o,s).then(()=>{t()},e=>{i(e)}):i(e)):(n||B.StoreCacheEntry(o.id.toString("hex"),r),t())})})})}static UpdateCache(i,r){return eh(this,void 0,void 0,function*(){var e=i.id.toString("hex"),t=(this.onEvent(new Ie(e)),yield this.GetOCSPResponse(i,r));this.StoreCacheEntry(e,t),this.onEvent(new Oe(i.id.toString("hex")))})}static StoreCacheEntry(e,t){this.StoreMemoryCacheEntry(e,t),this.StoreDiskCacheEntry(e,t)}static StoreMemoryCacheEntry(e,t){this.privMemCache[e]=t,this.onEvent(new _e(e))}static StoreDiskCacheEntry(e,t){this.privDiskCache.set(e,t).then(()=>{this.onEvent(new Te(e))})}static GetOCSPResponse(n,e){let o={};return e&&(e=B.GetProxyAgent(e),o.agent=e),new Promise((i,r)=>{Qa.utils.getAuthorityInfo(n.cert,"1.3.6.1.5.5.7.48.1",(e,t)=>{e?r(e):(e=new URL(t),o=Object.assign(Object.assign({},o),{host:e.host,protocol:e.protocol,port:e.port,path:e.pathname,hostname:e.host}),Qa.utils.getResponse(o,n.data,(e,t)=>{e?r(e):(e=n.certID,this.onEvent(new Ne(e.toString("hex"))),i(t))}))})})}static onEvent(e){o.instance.onEvent(e)}CreateConnection(e,t){var i=void 0!==Nr&&"0"!==Nr.env.NODE_TLS_REJECT_UNAUTHORIZED&&"0"!==Nr.env.SPEECH_CONDUCT_OCSP_CHECK&&t.secureEndpoint;let r;if(t=Object.assign(Object.assign({},t),{requestOCSP:!B.forceDisableOCSPStapling,servername:t.host}),this.privProxyInfo){const n=B.GetProxyAgent(this.privProxyInfo);r=new Promise((i,r)=>{n.callback(e,t,(e,t)=>{e?r(e):i(t)})})}else r=(t.secureEndpoint,Promise.resolve((void 0)(t)));return i?B.OCSPCheck(r,this.privProxyInfo):r}}B.testTimeOffset=0,B.forceDisableOCSPStapling=!1,B.privMemCache={};var th=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class ih{constructor(e,t,i,r,n,o){if(!e)throw new f("uri");if(!i)throw new f("messageFormatter");this.proxyInfo=r,this.privConnectionEvents=new de,this.privConnectionId=t,this.privMessageFormatter=i,this.privConnectionState=s.None,this.privUri=e,this.privHeaders=n,this.privEnableCompression=o,this.privHeaders[c.ConnectionId]=this.privConnectionId,this.privLastErrorReceived=""}get state(){return this.privConnectionState}open(){if(this.privConnectionState===s.Disconnected)return Promise.reject(`Cannot open a connection that is in ${this.privConnectionState} state`);if(!this.privConnectionEstablishDeferral){this.privConnectionEstablishDeferral=new d,this.privCertificateValidatedDeferral=new d,this.privConnectionState=s.Connecting;try{if("undefined"==typeof WebSocket||ih.forceNpmWebSocket){var t={headers:this.privHeaders,perMessageDeflate:this.privEnableCompression},i=(this.privCertificateValidatedDeferral.resolve(),new B(this.proxyInfo)),r=(t.agent=i.GetAgent(),new URL(this.privUri));let e=r.protocol;"wss:"===(null===e||void 0===e?void 0:e.toLocaleLowerCase())?e="https:":"ws:"===(null===e||void 0===e?void 0:e.toLocaleLowerCase())&&(e="http:"),t.agent.protocol=e,this.privWebsocketClient=new gr(this.privUri,t)}else this.privCertificateValidatedDeferral.resolve(),this.privWebsocketClient=new WebSocket(this.privUri);this.privWebsocketClient.binaryType="arraybuffer",this.privReceivingMessageQueue=new me,this.privDisconnectDeferral=new d,this.privSendMessageQueue=new me,this.processSendQueue().catch(e=>{o.instance.onEvent(new qe(e))})}catch(e){return this.privConnectionEstablishDeferral.resolve(new pe(500,e)),this.privConnectionEstablishDeferral.promise}this.onEvent(new ie(this.privConnectionId,this.privUri)),this.privWebsocketClient.onopen=()=>{this.privCertificateValidatedDeferral.promise.then(()=>{this.privConnectionState=s.Connected,this.onEvent(new re(this.privConnectionId)),this.privConnectionEstablishDeferral.resolve(new pe(200,""))},e=>{this.privConnectionEstablishDeferral.reject(e)})},this.privWebsocketClient.onerror=e=>{this.onEvent(new oe(this.privConnectionId,e.message,e.type)),this.privLastErrorReceived=e.message},this.privWebsocketClient.onclose=e=>{this.privConnectionState===s.Connecting?(this.privConnectionState=s.Disconnected,this.privConnectionEstablishDeferral.resolve(new pe(e.code,e.reason+" "+this.privLastErrorReceived))):(this.privConnectionState=s.Disconnected,this.privWebsocketClient=null,this.onEvent(new ne(this.privConnectionId,e.code,e.reason))),this.onClose(e.code,e.reason).catch(e=>{o.instance.onEvent(new qe(e))})},this.privWebsocketClient.onmessage=e=>{const t=(new Date).toISOString();if(this.privConnectionState===s.Connected){const r=new d;var i;this.privReceivingMessageQueue.enqueueFromPromise(r.promise),e.data instanceof ArrayBuffer?(i=new ye(p.Binary,e.data),this.privMessageFormatter.toConnectionMessage(i).then(e=>{this.onEvent(new se(this.privConnectionId,t,e)),r.resolve(e)},e=>{r.reject("Invalid binary message format. Error: "+e)})):(i=new ye(p.Text,e.data),this.privMessageFormatter.toConnectionMessage(i).then(e=>{this.onEvent(new se(this.privConnectionId,t,e)),r.resolve(e)},e=>{r.reject("Invalid text message format. Error: "+e)}))}}}return this.privConnectionEstablishDeferral.promise}send(t){if(this.privConnectionState!==s.Connected)return Promise.reject(`Cannot send on connection that is in ${s[this.privConnectionState]} state`);const i=new d,r=new d;return this.privSendMessageQueue.enqueueFromPromise(r.promise),this.privMessageFormatter.fromConnectionMessage(t).then(e=>{r.resolve({Message:t,RawWebsocketMessage:e,sendStatusDeferral:i})},e=>{r.reject("Error formatting the message. "+e)}),i.promise}read(){return this.privConnectionState!==s.Connected?Promise.reject(`Cannot read on connection that is in ${this.privConnectionState} state`):this.privReceivingMessageQueue.dequeue()}close(e){return this.privWebsocketClient?(this.privConnectionState!==s.Disconnected&&this.privWebsocketClient.close(1e3,e||"Normal closure by client"),this.privDisconnectDeferral.promise):Promise.resolve()}get events(){return this.privConnectionEvents}sendRawMessage(e){try{if(e){if(this.onEvent(new ae(this.privConnectionId,(new Date).toISOString(),e.Message)),!this.isWebsocketOpen)return Promise.reject("websocket send error: Websocket not ready "+this.privConnectionId+" "+e.Message.id+" "+(new Error).stack);this.privWebsocketClient.send(e.RawWebsocketMessage.payload)}return Promise.resolve()}catch(e){return Promise.reject("websocket send error: "+e)}}onClose(e,i){return th(this,void 0,void 0,function*(){const t=`Connection closed. ${e}: `+i;this.privConnectionState=s.Disconnected,this.privDisconnectDeferral.resolve(),yield this.privReceivingMessageQueue.drainAndDispose(()=>{},t),yield this.privSendMessageQueue.drainAndDispose(e=>{e.sendStatusDeferral.reject(t)},t)})}processSendQueue(){return th(this,void 0,void 0,function*(){for(;;){var t=yield this.privSendMessageQueue.dequeue();if(!t)return;try{yield this.sendRawMessage(t),t.sendStatusDeferral.resolve()}catch(e){t.sendStatusDeferral.reject(e)}}})}onEvent(e){this.privConnectionEvents.onEvent(e),o.instance.onEvent(e)}get isWebsocketOpen(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN}}ih.forceNpmWebSocket=!1;var rh=function(e,s,a,h){return new(a=a||Promise)(function(i,t){function r(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,n)}o((h=h.apply(e,s||[])).next())})};class nh{constructor(e,t,i,r,n,o=!1,s){if(this.privIsDisposed=!1,!e)throw new f("uri");if(!r)throw new f("messageFormatter");this.privMessageFormatter=r;let a="",h=0;if(t)for(const p in t){var u;p&&(a+=0===h&&-1===e.indexOf("?")?"?":"&",u=encodeURIComponent(t[p]),a+=p+"="+u,h++)}if(i)for(const d in i){var c;d&&(a+=0===h&&-1===e.indexOf("?")?"?":"&",c=encodeURIComponent(i[d]),a+=d+"="+c,h++)}this.privUri=e+a,this.privId=s||l(),this.privConnectionMessageAdapter=new ih(this.privUri,this.id,this.privMessageFormatter,n,i,o)}dispose(){return rh(this,void 0,void 0,function*(){this.privIsDisposed=!0,this.privConnectionMessageAdapter&&(yield this.privConnectionMessageAdapter.close())})}isDisposed(){return this.privIsDisposed}get id(){return this.privId}state(){return this.privConnectionMessageAdapter.state}open(){return this.privConnectionMessageAdapter.open()}send(e){return this.privConnectionMessageAdapter.send(e)}read(){return this.privConnectionMessageAdapter.read()}get events(){return this.privConnectionMessageAdapter.events}}class oh{constructor(e,t){this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.privAudioNode=e,this.privBytesPerSecond=t}id(){return this.privAudioNode.id()}read(){if(this.privReplay&&0!==this.privBuffers.length){var i=this.privReplayOffset-this.privBufferStartOffset;let e=Math.round(i*this.privBytesPerSecond*1e-7),t=(0!=e%2&&e++,0);for(;t<this.privBuffers.length&&e>=this.privBuffers[t].chunk.buffer.byteLength;)e-=this.privBuffers[t++].chunk.buffer.byteLength;if(t<this.privBuffers.length)return i=this.privBuffers[t].chunk.buffer.slice(e),this.privReplayOffset+=i.byteLength/this.privBytesPerSecond*1e7,t===this.privBuffers.length-1&&(this.privReplay=!1),Promise.resolve({buffer:i,isEnd:!1,timeReceived:this.privBuffers[t].chunk.timeReceived})}return this.privAudioNode.read().then(e=>(e&&e.buffer&&(this.privBuffers.push(new sh(e,this.privBufferSerial++,this.privBufferedBytes)),this.privBufferedBytes+=e.buffer.byteLength),e))}detach(){return this.privBuffers=void 0,this.privAudioNode.detach()}replay(){this.privBuffers&&0!==this.privBuffers.length&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)}shrinkBuffers(i){if(void 0!==this.privBuffers&&0!==this.privBuffers.length){var r=(this.privLastShrinkOffset=i)-this.privBufferStartOffset;let e=Math.round(r*this.privBytesPerSecond*1e-7),t=0;for(;t<this.privBuffers.length&&e>=this.privBuffers[t].chunk.buffer.byteLength;)e-=this.privBuffers[t++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(i-e/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(t)}}findTimeAtOffset(e){if(!(e<this.privBufferStartOffset||void 0===this.privBuffers))for(const r of this.privBuffers){var t=r.byteOffset/this.privBytesPerSecond*1e7,i=t+r.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(t<=e&&e<=i)return r.chunk.timeReceived}return 0}}class sh{constructor(e,t,i){this.chunk=e,this.serial=t,this.byteOffset=i}}class ah{constructor(e,t,i,r){this.privProxyHostName=e,this.privProxyPort=t,this.privProxyUserName=i,this.privProxyPassword=r}static fromParameters(e){return new ah(e.getProperty(m.SpeechServiceConnection_ProxyHostName),parseInt(e.getProperty(m.SpeechServiceConnection_ProxyPort),10),e.getProperty(m.SpeechServiceConnection_ProxyUserName),e.getProperty(m.SpeechServiceConnection_ProxyPassword))}static fromRecognizerConfig(e){return this.fromParameters(e.parameters)}get HostName(){return this.privProxyHostName}get Port(){return this.privProxyPort}get UserName(){return this.privProxyUserName}get Password(){return this.privProxyPassword}}class hh{constructor(i){this.mediaSource=null,this.audioConfig=Jt.fromStreamInput(i.stream),this.speechConfig=ri.fromSubscription(i.azureKey,"westus"),this.speechConfig.speechRecognitionLanguage="pt-BR",this.speechConfig.endpointId=i.endpointId,this.speechConfig.enableDictation(),this.speechConfig.enableAudioLogging(),this.recognizer=new ci(this.speechConfig,this.audioConfig),this.recognizer.recognizing=(e,t)=>{i.onTranslation(t.result.text)},this.recognizer.recognized=(e,t)=>{i.translationEnd(t.result.text)}}getRecognizer(){return this.recognizer}}class uh{constructor(e){this.recognition=null,this.azureKey=e.azureKey,this.endpoint=e.endpoint,this.speech="",this.onTranslation=e.onTranslation,this.onTranslationEnd=e.onTranslationEnd}async getMediaSource(){return this.mediaSource=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),this.mediaSource}getSpeech(){return this.speech}async initRecognition(){var e=await this.getMediaSource();this.recognition=new hh({stream:e,azureKey:this.azureKey,endpointId:this.endpoint,onTranslation:this.onTranslation,translationEnd:this.onTranslationEnd}),this.recognition.recognizer.startContinuousRecognitionAsync()}pauseRecognition(){this.recognition.recognizer.stopContinuousRecognitionAsync()}}const ch="sofya-voice-form",ph="sofya-form-logo",dh="sofya-record-button",lh="sofya-stop-button",fh="sofya-save-button";class vh{constructor(e){this.fieldsList=e.fields,this.isRecording=!1,this.isSaving=!1,this.barsCount=5,this.formTitle=e.formTitle,this.startRecognition=e.startRecognition,this.stopRecognition=e.stopRecognition,this.body=document.body,this.form=this.createForm(),this.fields=this.createFields(e.fields),this.footer=this.createFooter(),this.formName=this.createFormTitle(),this.formLogo=this.createFormLogo(),this.recordButton=this.createRecordButton(),this.saveButton=this.createSaveButton(),this.bar=this.createBars()}build(t){var e;this.form.appendChild(this.formName),this.form.appendChild(this.formLogo),this.footer.appendChild(this.recordButton),this.form.appendChild(this.footer),this.body.appendChild(this.form),this.fields.forEach(e=>{this.form.appendChild(e)}),this.handleFormSubmission(),null!=(e=this.getRecordButton())&&e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),(this.isRecording?this.stopRecognition:this.startRecognition).call(t),this.toggleRecordButton()})}createElement(e){return document.createElement(e)}createFields(e){const i=[];return e.forEach(e=>{var t=this.createElement("input");t.classList.add("sofya-form-field"),t.setAttribute("id",e.id),t.setAttribute("placeholder",e.placeholder),i.push(t)}),i}createFormTitle(){var e=this.createElement("h1");return e.classList.add("sofya-form-title"),e.innerHTML=this.formTitle,e}createFormLogo(){var e=this.createElement("div");return e.setAttribute("id",ph),e.classList.add(ph),e}createBars(){var e=this.createElement("div"),t=this.createElement("div"),i=this.createElement("span");e.classList.add("sofya-equalizer-container"),t.classList.add("sofya-equalizer"),i.classList.add("sofya-equalizer-label"),i.innerHTML="Processando...";for(let e=0;e<this.barsCount;e++){var r=this.createElement("div");r.classList.add("bar"),t.appendChild(r)}return e.appendChild(t),e.appendChild(i),e}createRecordButton(){var e=this.createElement("button");return e.setAttribute("value",""),e.setAttribute("id",dh),e.classList.add(dh),e}createSaveButton(){var e=this.createElement("button");return e.setAttribute("id",fh),e.setAttribute("type","submit"),e.classList.add(fh),e.innerHTML="Salvar",e}createFooter(){var e=this.createElement("div");return e.classList.add("sofya-form-footer"),e}fillField(e,t){null!=(e=document.getElementById(e.id))&&e.setAttribute("value",t)}cleanField(e){null!=(e=document.getElementById(e.id))&&e.setAttribute("value","")}createForm(){var e=this.createElement("form");return e.setAttribute("id",ch),e.classList.add(ch),e}getForm(){return document.querySelector("#"+ch)}getRecordButton(){return document.querySelector("#"+dh)}getSaveButton(){return document.querySelector("#"+fh)}toggleRecordButton(){var e=this.getRecordButton();this.isRecording?(null!=e&&e.classList.remove(lh),null!=e&&e.classList.add(dh),this.footer.removeChild(this.bar)):(null!=e&&e.classList.remove(dh),null!=e&&e.classList.add(lh),this.footer.appendChild(this.bar),this.footer.prepend(this.saveButton)),this.isRecording=!this.isRecording}async saveForm(){var e,t=this.getSaveButton();null!=t&&t.setAttribute("disabled","true"),t.innerHTML="salvando...";let i=!0;for(var r=null==(e=this.getForm())?void 0:e.getElementsByTagName("input"),n=0;n<r.length;n++)r[n].value||(i=!1);i&&(await window.fetch("https://5dr13143p9.execute-api.us-east-1.amazonaws.com/forms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({templateId:"123",attributes:{campo1:r[0].value},formVersion:"123",userId:"123"})}),null!=t&&t.removeAttribute("disabled"),this.footer.removeChild(this.saveButton),this.cleanField(this.fieldsList[0]))}handleFormSubmission(){var e;null!=(e=this.getForm())&&e.addEventListener("submit",e=>{e.preventDefault(),this.saveForm()})}}return class{constructor(e){this.mediaSource=null,this.recognizer=new uh({azureKey:"444a09889cb24052b0bf84eb70848304",endpoint:"e11291bc-7fb2-41b3-84a1-7b71486d4e7a",onTranslation:this.onTranslation,onTranslationEnd:this.onTranslationEnd.bind(this)}),this.formBuilder=void 0,this.isRecording=!1,this.speechText="",this.voiceForm=e.voiceForm,this.formTitle=e.formTitle,this.fields=[{id:"sofya-1234567",name:"name",placeholder:"Nome"}],this.formBuilder=new vh({formTitle:this.formTitle,fields:this.fields,startRecognition:this.startRecognition,stopRecognition:this.stopRecognition}),this.voiceForm&&this.formBuilder.build(this)}getRecognition(){return this.recognizer}async startRecognition(){await this.recognizer.initRecognition()}async stopRecognition(){await this.recognizer.pauseRecognition()}onTranslation(e){}onTranslationEnd(e){e&&this.formBuilder.fillField(this.fields[0],e)}}}();
